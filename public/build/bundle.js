var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(e,...n){if(null==e)return t;const s=e.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function a(t){let e;return o(t,(t=>e=t))(),e}function l(t,e,n){t.$$.on_destroy.push(o(e,n))}function c(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function _(){return m("")}function v(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}let b;function T(t){b=t}function C(){if(!b)throw new Error("Function called outside component initialization");return b}const k=[],A=[],S=[],O=[],M=Promise.resolve();let E=!1;function D(t){S.push(t)}let I=!1;const R=new Set;function P(){if(!I){I=!0;do{for(let t=0;t<k.length;t+=1){const e=k[t];T(e),N(e.$$)}for(T(null),k.length=0;A.length;)A.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];R.has(e)||(R.add(e),e())}S.length=0}while(k.length);for(;O.length;)O.pop()();E=!1,I=!1,R.clear()}}function N(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(D)}}const V=new Set;let $;function q(){$={r:0,c:[],p:$}}function L(){$.r||s($.c),$=$.p}function F(t,e){t&&t.i&&(V.delete(t),t.i(e))}function j(t,e,n,s){if(t&&t.o){if(V.has(t))return;V.add(t),$.c.push((()=>{V.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function B(t){t&&t.c()}function W(t,n,r,o){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(n,r),o||D((()=>{const n=l.map(e).filter(i);c?c.push(...n):s(n),t.$$.on_mount=[]})),u.forEach(D)}function U(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function z(t,e){-1===t.$$.dirty[0]&&(k.push(t),E||(E=!0,M.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(e,i,r,o,a,l,c=[-1]){const u=b;T(e);const h=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:i.context||[]),callbacks:n(),dirty:c,skip_bound:!1};let p=!1;if(h.ctx=r?r(e,i.props||{},((t,n,...s)=>{const i=s.length?s[0]:n;return h.ctx&&a(h.ctx[t],h.ctx[t]=i)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](i),p&&z(e,t)),n})):[],h.update(),p=!0,s(h.before_update),h.fragment=!!o&&o(h.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);h.fragment&&h.fragment.l(t),t.forEach(d)}else h.fragment&&h.fragment.c();i.intro&&F(e.$$.fragment),W(e,i.target,i.anchor,i.customElement),P()}T(u)}class G{$destroy(){U(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function H(e,n=t){let s;const i=[];function o(t){if(r(e,t)&&(e=t,s)){const t=!Y.length;for(let t=0;t<i.length;t+=1){const n=i[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(r,a=t){const l=[r,a];return i.push(l),1===i.length&&(s=n(o)||t),r(e),()=>{const t=i.indexOf(l);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}const Z=(()=>{const{subscribe:t,set:e,update:n}=H(null);return{subscribe:t,init:e,moveLetter:(t,e,s)=>{n((n=>(e&&!((t,e)=>0===t.filter((t=>t.board&&t.index===e)).length)(n.letters,s)||(n.letters=n.letters.map((n=>(n.id===t&&(n.index=s,n.board=e),n)))),n)))},addLetter:t=>{n((e=>(e.letters=[...e.letters,t],e)))},setJoker:(t,e)=>{n((n=>(n.letters=n.letters.map((n=>(n.id===t&&"_"===n.letter&&(n.joker=e),n))),n)))},fixLetter:t=>{n((e=>(e.letters=e.letters.map((e=>(e.id===t&&(e.free=!1),e))),e)))},setPlayers:t=>{n((e=>(e.players=t,e)))},setMolangeur:t=>{n((e=>(e.molangeur=t,e)))},setJokerPicker:(t,e=!1)=>{n((n=>(n.jocker_picker=e,n.jocker_picker_letter={...t},n)))},addNewLetterFlag:()=>{n((t=>(t.new_letters=!0,t)))},removeNewLetterFlag:()=>{n((t=>(t.new_letters=!1,t)))},setRound:t=>{n((e=>(e.round=t,e)))},setEvaluation:t=>{n((e=>(e.evaluation=t,e)))},setHistory:t=>{n((e=>(e.history=t,e)))},setGameOver:()=>{n((t=>(t.game_over=!0,t)))},setNeedForNewImagePreview:(t=!0)=>{n((e=>(e.image_preview_needed=t,e)))},setLettersLeft:t=>{n((e=>(e.letters_left=t,e)))}}})(),Q=(()=>{const{subscribe:t,set:e,update:n}=H({temp_letters:[],hover_location:null});return{subscribe:t,init:e,setTempLetters:t=>{n((e=>(e.temp_letters=t,e)))},setHoverLocation:t=>{n((e=>(e.hover_location=t,e)))}}})(),J=t=>{let e=Math.floor(t/15);return{row:t-15*e,col:e}},K=t=>{let e,n,s=t.length;for(;0!==s;)n=Math.floor(Math.random()*s),s-=1,e=t[s],t[s]=t[n],t[n]=e;return t},tt={_:{pts:0,n:2,vowel:!0,consonant:!0},A:{pts:1,n:9,vowel:!0,consonant:!1},B:{pts:3,n:2,vowel:!1,consonant:!0},C:{pts:3,n:2,vowel:!1,consonant:!0},D:{pts:2,n:3,vowel:!1,consonant:!0},E:{pts:1,n:15,vowel:!0,consonant:!1},F:{pts:4,n:2,vowel:!1,consonant:!0},G:{pts:2,n:2,vowel:!1,consonant:!0},H:{pts:4,n:2,vowel:!1,consonant:!0},I:{pts:1,n:8,vowel:!0,consonant:!1},J:{pts:8,n:1,vowel:!1,consonant:!0},K:{pts:10,n:1,vowel:!1,consonant:!0},L:{pts:1,n:5,vowel:!1,consonant:!0},M:{pts:2,n:3,vowel:!1,consonant:!0},N:{pts:1,n:6,vowel:!1,consonant:!0},O:{pts:1,n:6,vowel:!0,consonant:!1},P:{pts:3,n:2,vowel:!1,consonant:!0},Q:{pts:8,n:1,vowel:!1,consonant:!0},R:{pts:1,n:6,vowel:!1,consonant:!0},S:{pts:1,n:6,vowel:!1,consonant:!0},T:{pts:1,n:6,vowel:!1,consonant:!0},U:{pts:1,n:6,vowel:!0,consonant:!1},V:{pts:4,n:2,vowel:!1,consonant:!0},W:{pts:10,n:1,vowel:!1,consonant:!0},X:{pts:10,n:1,vowel:!1,consonant:!0},Y:{pts:10,n:1,vowel:!0,consonant:!1},Z:{pts:10,n:1,vowel:!1,consonant:!0}};const et=Object.keys(tt).filter((t=>"_"!==t)),nt={letter_double:[3,11,36,38,45,52,59,92,96,98,102,108,116,122,126,128,132,165,172,179,186,188,213,221],letter_triple:[20,24,76,80,84,88,136,140,144,148,200,204],word_double:[16,28,32,42,48,56,64,70,112,154,160,168,176,182,192,196,208],word_triple:[0,7,14,105,119,210,217,224]},st=Array(225).fill(0).map(((t,e)=>({letter_mutliplier:(-1===nt.letter_double.indexOf(e)?1:2)*(-1===nt.letter_triple.indexOf(e)?1:3),word_multiplier:(-1===nt.word_double.indexOf(e)?1:2)*(-1===nt.word_triple.indexOf(e)?1:3)})));const it=Array(15).fill(0).map(((t,e)=>Array(15).fill(0).map(((t,n)=>n+15*e))));const rt=Array(15).fill(0).map(((t,e)=>Array(15).fill(0).map(((t,n)=>15*n+e))));const ot=(()=>{const t={V:Array(225),H:Array(225)};return it.map((e=>{for(let n=0;n<15;n++){t.V[e[n]]=[];for(let s=1;s<=15-n;s++)t.V[e[n]].push(e.slice(n,n+s))}})),rt.map((e=>{for(let n=0;n<15;n++){t.H[e[n]]=[];for(let s=1;s<=15-n;s++)t.H[e[n]].push(e.slice(n,n+s))}})),t})(),at=(()=>{const t=Array(15).fill(0).map((t=>Array(15).fill(0))),e=Array(225).fill(0),n=Array(225).fill(0),s=(t,e)=>15*e+t;let i=0;for(let r=0;r<15;r++)for(let o=0;o<15;o++)t[o][r]=i,e[i]={row:o,col:r},n[i]={top:o>0?s(o-1,r):null,bottom:o<14?s(o+1,r):null,left:r>0?s(o,r-1):null,right:r<14?s(o,r+1):null},i++;return{FROM_INDEX:e,TO_INDEX:t,NEIGHBORS:n}})();let lt;const ct=()=>Math.random().toString().slice(2),ut={};let ht;const dt=t=>{window.Worker?lt=new Worker("molangeur.js"):(alert('Ce site necessite la technologie "Worker" que votre navigateur ne possède pas.\n        Certaines fonctionnalités importantes ne fonctionneront.\n        Cela inclue le maître MoLangeur, l\'algorithme permettant de trouver le meilleur mot dans une situation donnée.'),lt={addEventListener:()=>{},postMessage:()=>{}}),lt.addEventListener("message",(t=>{const e=t.data;e.id&&ut[e.id]&&(ut[e.id](e.content),e.all_words&&console.log("cheating! don't do it! => ",e.all_words),delete ut[e.id])}));let e=ct();ut[e]=t,fetch("./ALL_WORDS.txt").then((t=>t.text())).then((t=>{let n=t.split("\r\n");ht={};const s=(t,e,n=0)=>(t[n]?(void 0===e[t[n]]&&(e[t[n]]={}),e[t[n]]=s(t,e[t[n]],n+1)):e.$=t,e);n.map((t=>{ht=s(t,ht)})),lt.postMessage({code:"init",id:e,content:{LETTERS:tt,LTRS:et,POINTS:st,MAPPING:at,WORD_POSITIONS:ot,DICO:ht}})}))},pt=t=>{const e=(t,n=0,s=ht)=>void 0===t[n]?void 0!==s.$:void 0!==s[t[n]]&&e(t,n+1,s[t[n]]);return e(t)},ft=(t,e)=>{let n=ct();ut[n]=e,lt.postMessage({code:"molangeur",id:n,content:t})},mt=t=>{console.log(" ******************* checkBoard ******************** ");const e=t.filter((t=>t.board&&t.free));if(0===e.length)return!1;console.log("check 0");const n=e.map((t=>at.FROM_INDEX[t.index])),s=gt(n.map((t=>t.row)));if(1!=gt(n.map((t=>t.col))).length&&1!=s.length)return!1;console.log("check 1"),e.sort(((t,e)=>t.index-e.index));const i=_t(t.filter((t=>t.board))),r=[vt(i,e[0],"h"),vt(i,e[0],"v")];if(0===r.length)return!1;if(r.filter((t=>t.filter((t=>""===t.letter)).length>0)).length>0)return!1;console.log("check 2");const o=r.map((t=>t.length)),a=r.map((t=>t.filter((t=>t.free)).length)),l=1===e.length?0===o.indexOf(Math.max(...o)):0===a.indexOf(Math.max(...a)),c=r[l?0:1].filter((t=>t.free)).length;if(c!==e.length)return!1;console.log("check 3");const u=e.slice(1).map((t=>vt(i,t,l?"v":"h"))),h=[r[l?0:1],r[l?1:0],...u].filter((t=>t.length>0));if(0===h.map((t=>t.filter((t=>!t.free)).length)).reduce(((t,e)=>t+e))&&0===e.filter((t=>112===t.index)).length)return!1;console.log("check 4");const d=h.map((t=>t.map((t=>t.letter)).reduce(((t,e)=>t+e)))),p=d.map((t=>pt(t))),f=0===p.filter((t=>!t)).length;if(!f)return{is_horizontal:l,all_words:h,words:d,validities:p,validity:f};console.log("check 5");const m=h.map((t=>t.map((t=>t.points*t.multi_L)).reduce(((t,e)=>t+e))*t.map((t=>t.multi_W)).reduce(((t,e)=>t*e)))),g=m.reduce(((t,e)=>t+e))+(7===c?50:0);return console.log("#########################"),console.log("##  BOARD CHECK VALID  ##"),console.log("is_horizontal",l),console.log("all_words",h),console.log("words",d),console.log("validities",p),console.log("scores",m),console.log("score",g),console.log("#########################"),{is_horizontal:l,all_words:h,words:d,validities:p,validity:f,scores:m,score:g}},gt=t=>[...new Set(t)],_t=t=>{let e=Array(225).fill(null);return t.map((t=>e[t.index]=t)),e},vt=(t,e,n="h")=>{const s=t=>{let e,n,s,i;return t.free?(s=st[t.index].letter_mutliplier,i=st[t.index].word_multiplier):(s=1,i=1),"_"!==t.letter?(e=t.letter,n=tt[t.letter].pts):(e=t.joker,n=0),{letter:e,points:n,multi_L:s,multi_W:i,free:t.free,index:t.index}},i=(e,n=[],r="left")=>{let o=at.NEIGHBORS[e][r];return null!==o&&null!==t[o]&&(n.push(s(t[o])),i(o,n,r)),n},r=s(e);let o=["left","right"];"h"!==n&&(o=["top","bottom"]);const a=i(e.index,[],o[0]),l=i(e.index,[],o[1]),c=[...a.reverse(),r,...l];return 1===c.length?[]:c};let yt;const wt=(t,e=(()=>{}))=>{let n=yt.transaction("games","readwrite").objectStore("games").add(t);n.addEventListener("success",(()=>{console.log("DB game added"),e()})),n.addEventListener("error",(()=>{console.error("DB Error: ",n.error)}))},xt=t=>{let e=yt.transaction("games","readwrite").objectStore("games").put(t);e.addEventListener("success",(()=>{console.log("DB game updated")})),e.addEventListener("error",(()=>{console.error("DB Error: ",e.error)}))},bt=(t,e)=>{let n=yt.transaction("games","readonly").objectStore("games").get(t);n.addEventListener("success",(()=>{console.log("DB game retrieved"),e(n.result)}))},Tt=t=>{Et(),bt(t,(t=>{(t=>{t.history||(t.history=[],xt(t))})(t);const e=t.players[0].id,n=t.players.map((t=>t.id)).indexOf(e);Dt(t.id,e,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),t.board,t.players[n].rack,t.history),t.gameover?Vt():ft([...t.board,...t.players[n].rack],(e=>{0!==e.length?It(e):(console.error("should no happen"),kt(t))}))}))},Ct=(t,e,n,s)=>{let i=0,r=1/0,o=0,a=0,l=null,c=null,u=s.next_words.map((t=>(t.pts<r&&(i++,o=a,r=t.pts),t.rank=i,t.n_better_words=o,a++,t))),h=u.filter((t=>t.word===n.words[0]&&t.pts===n.score&&t.dir===(n.is_horizontal?"H":"V")&&t.index===n.all_words[0][0].index));0===h.length?(console.warn("The word submitted was not found by master molangeur!"),console.warn("new_letters",e),console.warn("evaluation",n),console.warn("molangeur",s),console.warn("ranks",u),console.warn("current_rank",h),h=u.filter((t=>t.pts===n.score)),h[0]&&(c=h[0].rank,l=h[0].n_better_words)):(c=h[0].rank,l=h[0].n_better_words);return{player_id:t,letters:e,evaluation:n,rank:c,n_better_words:l,molangeur:s.next_score}},kt=t=>{Vt(),t.gameover=!0,xt(t)},At=()=>{let t=Object.keys(tt).map((t=>t.repeat(tt[t].n).split(""))).flat().map((t=>({id:Math.random().toString().slice(2),letter:t,joker:"",board:!1,free:!0})));return t=K(t),t},St=(t,e,n)=>{const s=()=>t.slice(0,i),i=7-e.length;let r=s(),o=n<15?2:1,a=e.filter((t=>tt[t.letter].vowel)).length,l=e.filter((t=>tt[t.letter].consonant)).length,c=r.filter((t=>tt[t.letter].vowel)).length,u=r.filter((t=>tt[t.letter].consonant)).length,h=a+c<o||l+u<o,d=0;for(;h&&d<10;)t=K(t),r=s(),c=r.filter((t=>tt[t.letter].vowel)).length,u=r.filter((t=>tt[t.letter].consonant)).length,h=a+c<o||l+u<o,d++;return{letters:r,bag:t.slice(i)}},Ot=t=>{const e=t.letters.filter((t=>!t.board)).map((t=>t.index));return Array(7).fill(0).map(((t,e)=>e)).filter((t=>-1===e.indexOf(t)))},Mt=()=>{const t=a(Z),e=Ot(t);let n=-1;t.letters.filter((t=>t.board&&t.free)).sort(((t,e)=>t.index-e.index)).map((t=>{n++,Z.moveLetter(t.id,!1,e[n]),Z.setJoker(t.id,"")})),Z.setEvaluation(!1)},Et=()=>Z.init(null),Dt=(t,e,n,s,i,r,o,l)=>{const c=a(Z);if(null===c)o=o.map(((t,e)=>(t.index=e,t))),Z.init({id:t,player_id:e,round:n,letters_left:s,players:i,letters:[...r,...o],molangeur:{next_score:0,current_words:null,next_words:null},history:l}),Z.setNeedForNewImagePreview();else{const t=Ot(c),e=r.map((t=>t.index));r.map((t=>{if(1!==c.letters.filter((e=>e.id===t.id)).length)throw"A letter that should exist, doesn't...";Z.fixLetter(t.id),Z.moveLetter(t.id,!0,t.index)}));let a=0;o.map((n=>{1===c.letters.filter((t=>t.id===n.id)).length?n.board&&-1!==e.indexOf(n.index)&&(Z.moveLetter(n.id,!1,t[a]),Z.setJoker(n.id,""),a++):(n.index=t[a],n.board=!1,n.free=!0,Z.addLetter(n),a++)})),Z.setPlayers(i),Z.setHistory(l),Z.setEvaluation(!1),Z.setRound(n),Z.setNeedForNewImagePreview(),Z.setLettersLeft(s)}},It=(t=null)=>{const e=a(Z);t?Z.setMolangeur({next_score:t[0].pts,current_words:e.molangeur.next_words,next_words:t,searching:!1}):Z.setMolangeur({next_score:null,current_words:null,next_words:e.molangeur.next_words,searching:!0})},Rt=t=>{t?Tt(t):(()=>{Et();let t={bag:At(),board:[],players:[{id:Math.random().toString().slice(2),rack:[],score:0,molangeur:0}],round:0,type:"solo-duplicate",id:Math.random().toString().slice(2),update_date:Date.now(),create_date:Date.now(),history:[]};const e=St(t.bag,t.players[0].rack,t.round);t.players[0].rack=e.letters,t.bag=e.bag,wt(t),Dt(t.id,t.players[0].id,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),t.board,t.players[0].rack),It(),ft([...t.board,...t.players[0].rack],(t=>{It(t)}))})()},Pt=(t,e)=>{const n=a(Z);((t,e,n,s)=>{bt(t,(t=>{const i=t.players.map((t=>t.id)).indexOf(e),r=mt([...t.board,...n]);if(r&&r.validity){const o=n.map((t=>(t.free=!1,t)));t.board=[...t.board,...o];const a=t.players[i].rack.filter((t=>0===n.filter((e=>e.id===t.id)).length)),l=St(t.bag,a,t.round);t.bag=l.bag,t.players[i].rack=[...a,...l.letters],t.players[i].score+=r.score,t.players[i].molangeur+=s.next_score,t.round++,t.history||(t.history=[]),t.history=[...t.history,Ct(e,o,r,s)],t.update_date=Date.now(),xt(t),Dt(t.id,e,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),[...t.board],[...t.players[i].rack],t.history),ft([...t.board,...t.players[i].rack],(e=>{0!==e.length?It(e):kt(t)}))}}))})(t,e,n.letters.filter((t=>t.board&&t.free)),n.molangeur)},Nt=(t,e)=>{((t,e)=>{bt(t,(t=>{t.img=e,xt(t)}))})(t,e)},Vt=()=>{Z.setNeedForNewImagePreview(),Z.setGameOver()};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function $t(t){var e={exports:{}};return t(e,e.exports),e.exports}var qt=$t((function(t){!function(e){var n=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(s="application/font-woff",i="image/jpeg",{woff:s,woff2:s,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i,jpeg:i,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var s,i},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),s=n.length,i=new Uint8Array(s),r=0;r<s;r++)i[r]=n.charCodeAt(r);e(new Blob([i],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),s=n.createElement("base");n.head.appendChild(s);var i=n.createElement("a");return n.body.appendChild(i),s.href=e,i.href=t,i.href},getAndEncode:function(t){var e=3e4;a.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(n){var s,i=new XMLHttpRequest;if(i.onreadystatechange=o,i.ontimeout=l,i.responseType="blob",i.timeout=e,i.open("GET",t,!0),i.send(),a.impl.options.imagePlaceholder){var r=a.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(s=r[1])}function o(){if(4===i.readyState)if(200===i.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(i.response)}else s?n(s):c("cannot fetch resource: "+t+", status: "+i.status)}function l(){s?n(s):c("timeout of "+e+"ms occured while fetching resource: "+t)}function c(t){console.error(t),n("")}}))},uid:(t=0,function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return new Promise((function(e,n){var s=new Image;s.onload=function(){e(s)},s.onerror=n,s.src=t}))},width:function(t){var e=n(t,"border-left-width"),s=n(t,"border-right-width");return t.scrollWidth+e+s},height:function(t){var e=n(t,"border-top-width"),s=n(t,"border-bottom-width");return t.scrollHeight+e+s}};var t;function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}(),s=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,r){return o()?Promise.resolve(t):Promise.resolve(t).then(s).then((function(e){var s=Promise.resolve(t);return e.forEach((function(t){s=s.then((function(e){return i(e,t,n,r)}))})),s}));function o(){return!e(t)}},shouldProcess:e,impl:{readUrls:s,inline:i}};function e(e){return-1!==e.search(t)}function s(e){for(var s,i=[];null!==(s=t.exec(e));)i.push(s[1]);return i.filter((function(t){return!n.isDataUrl(t)}))}function i(t,e,s,i){return Promise.resolve(e).then((function(t){return s?n.resolveUrl(t,s):t})).then(i||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e))})).then((function(s){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+n.escape(t)+")(['\"]?\\))","g")}(e),"$1"+s+"$3")}))}}(),i=function(){return{resolveAll:function(){return t().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return s.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return s.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),r=function(){return{inlineAll:function e(i){return i instanceof Element?r(i).then((function(){return i instanceof HTMLImageElement?t(i).inline():Promise.all(n.asArray(i.childNodes).map((function(t){return e(t)})))})):Promise.resolve(i);function r(t){var e=t.style.getPropertyValue("background");return e?s.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}},impl:{newImage:t}};function t(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t.src))})).then((function(e){return new Promise((function(n,s){t.onload=n,t.onerror=s,t.src=e}))}))}}}}(),o={imagePlaceholder:void 0,cacheBust:!1},a={toSvg:l,toPng:function(t,e){return c(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return c(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return c(t,e||{}).then(n.canvasToBlob)},toPixelData:function(t,e){return c(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},impl:{fontFaces:i,images:r,util:n,inliner:s,options:{}}};function l(t,e){return function(t){void 0===t.imagePlaceholder?a.impl.options.imagePlaceholder=o.imagePlaceholder:a.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?a.impl.options.cacheBust=o.cacheBust:a.impl.options.cacheBust=t.cacheBust}(e=e||{}),Promise.resolve(t).then((function(t){return u(t,e.filter,!0)})).then(h).then(d).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));return t})).then((function(s){return function(t,e,s){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+s+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(s,e.width||n.width(t),e.height||n.height(t))}))}function c(t,e){return l(t,e).then(n.makeImage).then(n.delay(100)).then((function(s){var i=function(t){var s=document.createElement("canvas");if(s.width=e.width||n.width(t),s.height=e.height||n.height(t),e.bgcolor){var i=s.getContext("2d");i.fillStyle=e.bgcolor,i.fillRect(0,0,s.width,s.height)}return s}(t);return i.getContext("2d").drawImage(s,0,0),i}))}function u(t,e,s){return s||!e||e(t)?Promise.resolve(t).then((function(t){return t instanceof HTMLCanvasElement?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(s){return function(t,e,s){var i=t.childNodes;return 0===i.length?Promise.resolve(e):r(e,n.asArray(i),s).then((function(){return e}));function r(t,e,n){var s=Promise.resolve();return e.forEach((function(e){s=s.then((function(){return u(e,n)})).then((function(e){e&&t.appendChild(e)}))})),s}}(t,s,e)})).then((function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(s).then(i).then(r).then(o).then((function(){return e})):e;function s(){function s(t,e){function s(t,e){n.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}t.cssText?e.cssText=t.cssText:s(t,e)}s(window.getComputedStyle(t),e.style)}function i(){function s(s){var i=window.getComputedStyle(t,s),r=i.getPropertyValue("content");if(""!==r&&"none"!==r){var o=n.uid();e.className=e.className+" "+o;var a=document.createElement("style");a.appendChild(l(o,s,i)),e.appendChild(a)}function l(t,e,s){var i="."+t+":"+e,r=s.cssText?o(s):a(s);return document.createTextNode(i+"{"+r+"}");function o(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function a(t){return n.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){s(t)}))}function r(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function o(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(t,e)})):Promise.resolve()}function h(t){return i.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function d(t){return r.inlineAll(t).then((function(){return t}))}t.exports=a}()}));let Lt,Ft,jt=Array(7).fill(null);const Bt=t=>{if(Lt[t]){let e=1;for(;t-e>=0||t+e<7;){if(t-e>=0&&null===Lt[t-e])return{left:!0,k:e};if(t+e<7&&null===Lt[t+e])return{left:!1,k:e};if(e>100)return console.log("inifinit loop"),null;e+=1}return null}return{left:!0,k:0}},Wt=(t,e)=>{let n,s;if(e.left){n=t-e.k+1,s=t+1;const i=Lt.slice(n,s);Lt=[...Lt.slice(0,n-1),...i,...Lt.slice(n-1,n),...Lt.slice(s,7)].flat()}else{n=t,s=t+e.k;const i=Lt.slice(n,s);Lt=[...Lt.slice(0,n),...Lt.slice(s,s+1),...i,,...Lt.slice(s+1,7)].flat()}},Ut=()=>{jt.map(((t,e)=>{for(let n=0;n<7;n++){if(t===Lt[e-n])return-n;if(t===Lt[e+n])return n}})).map(((t,e)=>{jt[e]&&(jt[e].dom.style.transform=`translateX(${105.5*t}%)`)}))};var zt=(t,e)=>{const n=document.querySelector(".rack-letters"),s=document.querySelector(".game");Ft={...e},Ft.dom=s.querySelector(`div[cui="${e.id}"]`),jt=Array(7).fill(null),t.filter((t=>t.id!==e.id)).map((t=>{let e={...t};return e.dom=n.querySelector(`div[cui="${e.id}"]`),jt[e.index]=e,t})),Lt=[...jt]},Xt=t=>{void 0!==t&&(Wt(t,Bt(t)),Ut())},Gt=()=>{Lt=[...jt],Ut()},Yt=()=>Lt.map(((t,e)=>t?{id:t.id,index:e}:void 0)).filter((t=>t));function Ht(e){let n,r,o,a,l,p,_,x,b,T=(0===e[2]?"":e[2])+"";return{c(){n=f("div"),r=f("span"),o=m(e[1]),a=g(),l=f("span"),p=m(T),y(r,"class","value svelte-b4in5q"),y(l,"class","score svelte-b4in5q"),y(n,"class",_=c("letter "+e[4])+" svelte-b4in5q"),y(n,"style",e[5]),y(n,"cui",e[3])},m(t,s){h(t,n,s),u(n,r),u(r,o),u(n,a),u(n,l),u(l,p),e[8](n),x||(b=[v(n,"mousedown",(function(){i(e[6])&&e[6].apply(this,arguments)})),v(n,"touchstart",(function(){i(e[6])&&e[6].apply(this,arguments)})),v(n,"click",(function(){i(e[7])&&e[7].apply(this,arguments)}))],x=!0)},p(t,[s]){e=t,2&s&&w(o,e[1]),4&s&&T!==(T=(0===e[2]?"":e[2])+"")&&w(p,T),16&s&&_!==(_=c("letter "+e[4])+" svelte-b4in5q")&&y(n,"class",_),32&s&&y(n,"style",e[5]),8&s&&y(n,"cui",e[3])},i:t,o:t,d(t){t&&d(n),e[8](null),x=!1,s(b)}}}function Zt(t,e,n){let{letter:s}=e,{value:i}=e,{id:r}=e,{classes:o}=e,{styles:a=""}=e,{self:l=null}=e,{on_mousedown:c=null}=e,{on_click:u=null}=e;return t.$$set=t=>{"letter"in t&&n(1,s=t.letter),"value"in t&&n(2,i=t.value),"id"in t&&n(3,r=t.id),"classes"in t&&n(4,o=t.classes),"styles"in t&&n(5,a=t.styles),"self"in t&&n(0,l=t.self),"on_mousedown"in t&&n(6,c=t.on_mousedown),"on_click"in t&&n(7,u=t.on_click)},[l,s,i,r,o,a,c,u,function(t){A[t?"unshift":"push"]((()=>{l=t,n(0,l)}))}]}class Qt extends G{constructor(t){super(),X(this,t,Zt,Ht,r,{letter:1,value:2,id:3,classes:4,styles:5,self:0,on_mousedown:6,on_click:7})}}const Jt="14.7.77";var Kt=$t((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0})),te=$t((function(t){t.exports=function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var s,i,r=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(r.push(s.value),!e||r.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return r}},t.exports.default=t.exports,t.exports.__esModule=!0})),ee=$t((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s},t.exports.default=t.exports,t.exports.__esModule=!0})),ne=$t((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return ee(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0})),se=$t((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0})),ie=$t((function(t){t.exports=function(t,e){return Kt(t)||te(t,e)||ne(t,e)||se()},t.exports.default=t.exports,t.exports.__esModule=!0})),re=$t((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0})),oe=$t((function(t){function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t},t.exports.default=t.exports,t.exports.__esModule=!0})),ae=$t((function(t,e){!function(t,e,n,s){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),o=i(n),a=i(s),l=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},c=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},u=function(t,e){return{startTime:e,type:"setValue",value:t}},h=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},d=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},p=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return p(t)||f(t)},g=function(t){return"setValue"===t.type},_=function(t){return"setValueCurve"===t.type},v=function t(e,n,s,i){var r=e[n];return void 0===r?i:m(r)||g(r)?r.value:_(r)?r.values[r.values.length-1]:d(s,t(e,n-1,r.startTime,i),r)},y=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:m(n)?[n.endTime,n.value]:g(n)?[n.startTime,n.value]:_(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,v(t,e-1,n.startTime,i)]},w=function(t){return"cancelAndHold"===t.type},x=function(t){return"cancelScheduledValues"===t.type},b=function(t){return w(t)||x(t)?t.cancelTime:p(t)||f(t)?t.endTime:t.startTime},T=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},C=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},k=function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]},A=function(t,e){var n=e.duration,s=e.startTime,i=e.values,r=(t-s)/n*(i.length-1);return k(i,r)},S=function(t){return"setTarget"===t.type},O=function(){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return a.default(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=b(t);if(w(t)||x(t)){var n=this._automationEvents.findIndex((function(n){return x(t)&&_(n)?n.startTime+n.duration>=e:b(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&m(s)){if(S(i))throw new Error("The internal list is malformed.");var r=_(i)?i.startTime+i.duration:b(i),o=_(i)?i.values[i.values.length-1]:i.value,a=p(s)?T(e,r,o,s):C(e,r,o,s),d=p(s)?l(a,e,this._currenTime):c(a,e,this._currenTime);this._automationEvents.push(d)}void 0!==i&&S(i)&&this._automationEvents.push(u(this.getValue(e),e)),void 0!==i&&_(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var g=this._automationEvents.findIndex((function(t){return b(t)>e})),v=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==v&&_(v)&&b(v)+v.duration>e)return!1;var y=p(t)?l(t.value,t.endTime,this._currenTime):f(t)?c(t.value,e,this._currenTime):t;if(-1===g)this._automationEvents.push(y);else{if(_(t)&&e+t.duration>b(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,y)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return b(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];S(s)&&n.unshift(u(v(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return b(e)>t})),n=this._automationEvents[e],s=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[s];if(void 0!==i&&S(i)&&(void 0===n||!m(n)||n.insertTime>t))return d(t,v(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==i&&_(i)&&(void 0===n||!m(n)||i.startTime+i.duration>t))return t<i.startTime+i.duration?A(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==n&&p(n)){var o=y(this._automationEvents,s,i,n,this._defaultValue),a=r.default(o,2),l=a[0],c=a[1];return T(t,l,c,n)}if(void 0!==n&&f(n)){var u=y(this._automationEvents,s,i,n,this._defaultValue),h=r.default(u,2),w=h[0],x=h[1];return C(t,w,x,n)}return this._defaultValue}}]),t}(),M=function(t){return{cancelTime:t,type:"cancelAndHold"}},E=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},D=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},I=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},R=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}};t.AutomationEventList=O,t.createCancelAndHoldAutomationEvent=M,t.createCancelScheduledValuesAutomationEvent=E,t.createExponentialRampToValueAutomationEvent=D,t.createLinearRampToValueAutomationEvent=I,t.createSetTargetAutomationEvent=R,t.createSetValueAutomationEvent=u,t.createSetValueCurveAutomationEvent=h,Object.defineProperty(t,"__esModule",{value:!0})}(e,ie,re,oe)}));const le=new WeakSet,ce=new WeakMap,ue=new WeakMap,he=new WeakMap,de=new WeakMap,pe=new WeakMap,fe=new WeakMap,me=new WeakMap,ge=new WeakMap,_e=new WeakMap,ve={construct:()=>ve},ye=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,we=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(ye);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(ye)}return[n.join(";"),s]},xe=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},be=t=>{if(!(t=>{try{new new Proxy(t,ve)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Te=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},Ce=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},ke=(t,e,n,s)=>{const i=Te(t,e),r=Ce(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},Ae=t=>Te(fe,t),Se=t=>{if(le.has(t))throw new Error("The AudioNode is already stored.");le.add(t),Ae(t).forEach((t=>t(!0)))},Oe=t=>"port"in t,Me=t=>{if(!le.has(t))throw new Error("The AudioNode is not stored.");le.delete(t),Ae(t).forEach((t=>t(!1)))},Ee=(t,e)=>{!Oe(t)&&e.every((t=>0===t.size))&&Me(t)},De={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Ie=(t,e)=>t.context===e,Re=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Pe=()=>new DOMException("","IndexSizeError"),Ne=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw Pe();throw t}})},Ve={numberOfChannels:1},$e=-34028234663852886e22,qe=-$e,Le=t=>le.has(t),Fe={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},je=t=>Te(ce,t),Be=t=>Te(he,t),We=(t,e)=>{const{activeInputs:n}=je(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||We(n,[...e,t])}))));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:Oe(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=Be(t);void 0!==n&&n.activeInputs.forEach((([t])=>We(t,e)))}Le(t)&&Me(t)},Ue=t=>{We(t.destination,[])},ze=t=>"context"in t,Xe=t=>ze(t[0]),Ge=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Ye=(t,e,[n,s],i)=>{Ge(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},He=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):Ge(r,[n,s],(t=>t[0]===n),i)},Ze=t=>"inputs"in t,Qe=(t,e,n,s)=>{if(Ze(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},Je=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},Ke=(t,e)=>{if(!Ae(t).delete(e))throw new Error("Missing the expected event listener.")},tn=(t,e,n)=>{const s=Te(t,e),i=Ce(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},en=(t,e,n,s)=>{Ze(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},nn=t=>Te(ue,t),sn=t=>Te(de,t),rn=t=>me.has(t),on=t=>!le.has(t),an=t=>new Promise((e=>{const n=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(n).connect(t.destination),o.connect(s),o.disconnect(s),n.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()})),ln=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},cn=t=>"context"in t,un=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=Be(e),{outputs:o}=je(t),a=Ae(t),l=o=>{const a=nn(t),l=sn(e);if(o){const e=tn(r,t,n);Ye(i,t,e,!1),s||rn(t)||a.connect(l,n)}else{const e=((t,e,n)=>Ce(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);He(r,e,!1),s||rn(t)||a.disconnect(l,n)}};return!!Ge(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(l),Le(t)?Ye(i,t,[n,l],!0):He(r,[t,n,l],!0),!0)},hn=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=je(e),o=Je(i[s],t,n);if(null===o)return[ke(r,t,n,s)[2],!1];return[o[2],!0]})(t,n,s,i);if(null!==r&&(Ke(t,r),!o||e||rn(t)||en(nn(t),nn(n),s,i)),Le(n)){const{activeInputs:t}=je(n);Ee(n,t)}},dn=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=Be(e),r=Je(s,t,n);if(null===r)return[tn(i,t,n)[1],!1];return[r[2],!0]})(t,n,s);null!==i&&(Ke(t,i),!r||e||rn(t)||nn(t).disconnect(sn(n),s))};class pn{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const fn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function mn(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const gn=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},_n=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},vn=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,l=s.channelCount*s.numberOfInputs,c=i.reduce(((t,e)=>t+e),0),u=0===c?null:n.createBuffer(c,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=je(t),d=await((t,e)=>{const n=Te(_e,t),s=nn(e);return Te(n,s)})(n,t),p=_n(s.numberOfInputs,s.channelCount),f=_n(s.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let c=0;c<a;c+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)mn(e,p[t],n,n,c);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{mn(e,m,t,l+n,c)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=p.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(c/n.sampleRate,n.sampleRate,(()=>d.process(t,f,m)));if(null!==u)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)gn(u,f[t],n,e+n,c);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return u},yn={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},wn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},xn={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},bn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Tn={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Cn=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((s=>{n.onmessage=()=>{e.close(),n.close(),s()},e.postMessage(t,[t])}))},kn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},An=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},Sn={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},On={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Mn=()=>new DOMException("","InvalidStateError"),En=()=>new DOMException("","InvalidAccessError"),Dn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},In=(t,e,n,s,i,r,o,a,l,c,u)=>{const h=c.length;let d=a;for(let a=0;a<h;a+=1){let h=n[0]*c[a];for(let e=1;e<i;e+=1){const s=d-e&l-1;h+=n[e]*r[s],h-=t[e]*o[s]}for(let t=i;t<s;t+=1)h+=n[t]*r[d-t&l-1];for(let n=i;n<e;n+=1)h-=t[n]*o[d-n&l-1];r[d]=c[a],o[d]=h,d=d+1&l-1,u[a]=h}return d},Rn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Pn=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Nn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},Vn=(t,e)=>{Nn(t,e,"channelCount"),Nn(t,e,"channelCountMode"),Nn(t,e,"channelInterpretation")},$n=t=>"function"==typeof t.getFloatTimeDomainData,qn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},Ln=t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})},Fn=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},jn=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Bn=async(t,e)=>new t(await(t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})))(e)),Wn=(t,e)=>{const n=t.createBiquadFilter();return Vn(n,e),qn(n,e,"Q"),qn(n,e,"detune"),qn(n,e,"frequency"),qn(n,e,"gain"),Nn(n,e,"type"),n},Un=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Vn(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Mn()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw Mn()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw Mn()}})})(n),n},zn=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Xn=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Vn(n,e),qn(n,e,"delayTime"),n},Gn=(t,e)=>{const n=t.createGain();return Vn(n,e),qn(n,e,"gain"),n};function Yn(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function Hn(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const Zn=(t,e,n,s)=>t.createScriptProcessor(e,n,s),Qn=()=>new DOMException("","NotSupportedError"),Jn={numberOfChannels:1},Kn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ts={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},es={disableNormalization:!1},ns={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},ss={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},is=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},rs=(t,e,n,s)=>{let i=Object.getPrototypeOf(t);for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},os=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;os(t,e,n+1e-7)}},as=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},ls=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},cs=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},us=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),zn(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},hs=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},ds=(t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],(t=>t[0]===n&&t[1]===s),o)})(Ge),ps=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)})(Ge),fs=(t=>(e,n,s,i)=>t(e[i],(t=>t[0]===n&&t[1]===s)))(Ce),ms=new WeakMap,gs=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(ms),_s=(vs=new Map,ys=new WeakMap,(t,e)=>{const n=ys.get(t);if(void 0!==n)return n;const s=vs.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(vs.set(t,n),n.catch((()=>!1)).then((e=>(vs.delete(t),ys.set(t,e),e)))):(ys.set(t,n),n)}catch{return ys.set(t,!1),!1}});var vs,ys;const ws="undefined"==typeof window?null:window,xs=((t,e)=>(n,s)=>{const i=n.createAnalyser();if(Vn(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Nn(i,s,"fftSize"),Nn(i,s,"maxDecibels"),Nn(i,s,"minDecibels"),Nn(i,s,"smoothingTimeConstant"),t($n,(()=>$n(i)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(i),i})(_s,Pe),bs=(t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(je),Ts=((t,e,n)=>async(s,i,r,o)=>{const a=t(s),l=[...o,s];await Promise.all(a.activeInputs.map(((t,o)=>Array.from(t).filter((([t])=>!l.includes(t))).map((async([t,a])=>{const c=e(t),u=await c.render(t,i,l),h=s.context.destination;n(t)||s===h&&n(s)||u.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(je,bs,rn),Cs=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Ie(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(xs,nn,Ts),ks=(As=pe,t=>{const e=As.get(t);if(void 0===e)throw Mn();return e});var As;const Ss=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ws),Os=(t=>e=>null!==t&&e instanceof t)(Ss),Ms=new WeakMap,Es=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}})(hs),Ds=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ws),Is=(t=>e=>null!==t&&e instanceof t)(Ds),Rs=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ws),Ps=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ws),Ns=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f)=>class extends c{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=u(e);h(o)&&!0!==n(an,(()=>an(o)))&&(t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=cn(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"==typeof s)for(const[t,n]of e){const i=n.filter((t=>t.output!==s));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,s]of e)s.forEach((e=>{cn(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})(t.disconnect)})(i),ue.set(this,i),fe.set(this,new Set),"closed"!==e.state&&s&&Se(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=u(this._context),h=f(c);if(d(t)||p(t))throw r();if(ze(t)){const i=nn(t);try{const e=Qe(this._nativeAudioNode,i,n,a),s=on(this);(h||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&on(t)&&Se(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,h)){const e=l([this],t);ln(e,s(h))}return t}const m=sn(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||on(this))&&this._nativeAudioNode.disconnect(m,n)}catch(t){if(12===t.code)throw r();throw t}if(un(this,t,n,h)){const e=l([this],t);ln(e,s(h))}}disconnect(t,e,n){let s;const o=u(this._context),c=f(o);if(void 0===t)s=((t,e)=>{const n=je(t),s=[];for(const i of n.outputs)Xe(i)?hn(t,e,...i):dn(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=je(t),i=[];for(const r of s.outputs)r[1]===n&&(Xe(r)?hn(t,e,...r):dn(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(ze(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=je(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i))).map((n=>(Xe(n)?hn(t,e,...n):dn(t,e,...n),r.outputs.delete(n),n[0])))})(this,c,t,e,n),0===s.length)throw r()}for(const t of s){const e=l([this],t);ln(e,a)}}})((Vs=ce,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Vs.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,l,c,u,h,d)=>{const p=new WeakMap;return(f,m,g,_,v)=>{const{activeInputs:y,passiveInputs:w}=r(m),{outputs:x}=r(f),b=a(f),T=r=>{const a=l(m),c=l(f);if(r){const e=ke(w,f,g,_);t(y,f,e,!1),v||h(f)||n(c,a,g,_),d(m)&&Se(m)}else{const t=s(y,f,g,_);e(w,_,t,!1),v||h(f)||i(c,a,g,_);const n=o(m);if(0===n)u(m)&&Ee(m,y);else{const t=p.get(m);void 0!==t&&clearTimeout(t),p.set(m,setTimeout((()=>{u(m)&&Ee(m,y)}),1e3*n))}}};return!!c(x,[m,g,_],(t=>t[0]===m&&t[1]===g&&t[2]===_),!0)&&(b.add(T),u(f)?t(y,f,[g,_,T],!0):e(w,_,[f,g,T],!0),!0)}})(ds,ps,Qe,fs,en,je,gs,Ae,nn,Ge,Le,rn,on),_s,((t,e,n,s,i,r)=>o=>(a,l)=>{const c=t.get(a);if(void 0===c){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(Xe(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,l)}else t.set(a,c+l)})(me,en,je,nn,sn,Le),Pe,En,Qn,((t,e,n,s,i,r,o,a)=>(l,c)=>{const u=e.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(l.context),d=a(h);if(u===c){if(e.delete(l),!d&&o(l)){const e=s(l),{outputs:r}=n(l);for(const n of r)if(Xe(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(l,u-c)})(Qe,me,je,nn,sn,ks,Le,Os),((t,e,n)=>function s(i,r){const o=ze(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(Ms,je,Te),Es,ks,Is,Rs,Ps,Os);var Vs;const $s=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...De,...n},l=s(o,a);super(t,!1,l,r(o)?e():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ns,Cs,Pe,xs,ks,Os),qs=new WeakSet,Ls=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ws),Fs=(js=new Uint32Array(1),t=>(js[0]=t,js[0]));var js;const Bs=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=s.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)s[t]=c[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=s.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)c[t+o]=s[t]}})(Fs,Pe),Ws=(t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)})(Fs),Us=((t,e,n,s,i,r,o,a)=>{let l=null;return class c{constructor(c){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:d}={...Ve,...c};null===l&&(l=new i(1,1,44100));const p=null!==s&&e(r,r)?new s({length:u,numberOfChannels:h,sampleRate:d}):l.createBuffer(h,u,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(o(p),Ne(p)):e(Re,(()=>Re(p)))||a(p),t.add(p),p}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===c.prototype||t.has(e)}}})(qs,_s,Qn,Ls,Ss,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Ls),Bs,Ws),zs=(t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(Gn),Xs=((t,e,n)=>async(s,i,r,o)=>{const a=e(s);await Promise.all(Array.from(a.activeInputs).map((async([e,s])=>{const a=t(e),l=await a.render(e,i,o);n(e)||l.connect(r,s)})))})(bs,Be,rn),Gs=(t=>(e,n,s,i)=>t(n,e,s,i))(Xs),Ys=((t,e,n,s,i,r,o,a,l,c,u)=>(h,d)=>{const p=h.createBufferSource();return Vn(p,d),qn(p,d,"playbackRate"),Nn(p,d,"buffer"),Nn(p,d,"loop"),Nn(p,d,"loopEnd"),Nn(p,d,"loopStart"),e(n,(()=>n(h)))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw Mn();e.call(t,s,i,r),n=!0}})(t.start)})(p),e(s,(()=>s(h)))||l(p),e(i,(()=>i(h)))||c(p,h),e(r,(()=>r(h)))||Ln(p),e(o,(()=>o(h)))||u(p,h),e(a,(()=>a(h)))||Fn(p),t(h,p),p})(zs,_s,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),as,ls,cs,(t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})}),(t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",(t=>()=>{const n=t.call(e);return n===s?null:n}),(t=>n=>t.call(e,null===n?s:n)))})(rs),us),Hs=((t,e)=>(n,s,i,r)=>(t(s).replay(i),e(s,n,i,r)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(Be),Xs),Zs=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c,u){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(l,c,u)=>{let h=n(l);const d=Ie(h,c);if(!d){const t={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(c,t),null!==o&&h.start(...o),null!==a&&h.stop(a)}return r.set(c,h),d?await t(c,l.playbackRate,h.playbackRate,u):await s(c,l.playbackRate,h.playbackRate,u),await i(l,c,h,u),h})(l,c,u)}}})(Gs,Ys,nn,Hs,Ts),Qs=((t,e,n,s,i,r,o,a,l,c,u,h,d)=>(p,f,m,g=null,_=null)=>{const v=new ae.AutomationEventList(m.defaultValue),y=f?s(v):null,w={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,w.setValueAtTime(t,p.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===y&&v.flush(p.context.currentTime),v.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(v).pop();null===y&&v.flush(p.context.currentTime),v.add(i(t));const n=Array.from(v).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return w},cancelScheduledValues:t=>(null===y&&v.flush(p.context.currentTime),v.add(r(t)),m.cancelScheduledValues(t),w),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===y&&v.flush(p.context.currentTime),v.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),w},linearRampToValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(a(t,e)),m.linearRampToValueAtTime(t,e),w),setTargetAtTime:(t,e,n)=>(null===y&&v.flush(p.context.currentTime),v.add(l(t,e,n)),m.setTargetAtTime(t,e,n),w),setValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(c(t,e)),m.setValueAtTime(t,e),w),setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,i=p.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,l=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(s.length-1)/n*((r+t)/i-e),a=Math.floor(o),c=Math.ceil(o);l[t]=a===c?s[a]:(1-(o-a))*s[a]+(1-(c-o))*s[c]}null===y&&v.flush(p.context.currentTime),v.add(u(l,e,n)),m.setValueCurveAtTime(l,e,n);const c=o/i;c<t&&d(w,l[l.length-1],c),d(w,s[s.length-1],t)}else null===y&&v.flush(p.context.currentTime),v.add(u(s,e,n)),m.setValueCurveAtTime(s,e,n);return w}};return n.set(w,m),e.set(w,p),t(w,y),w})((Js=he,(t,e)=>{Js.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),Ms,de,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}})),ae.createCancelAndHoldAutomationEvent,ae.createCancelScheduledValuesAutomationEvent,ae.createExponentialRampToValueAutomationEvent,ae.createLinearRampToValueAutomationEvent,ae.createSetTargetAutomationEvent,ae.createSetValueAutomationEvent,ae.createSetValueCurveAutomationEvent,Ds,os);var Js;const Ks=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),l={...Fe,...s},c=i(a,l),u=o(a),h=u?e():null;super(t,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,u,c.playbackRate,qe,$e)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){Se(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),Le(this)&&Me(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ns,Zs,Qs,Mn,Ys,ks,Os,hs),ti=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),l=o(s),c=i(s,n,l);super(t,!1,c,l?e(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ns,(t=>{let e=null;return{render:(n,s,i)=>(null===e&&(e=(async(e,n,s)=>{const i=n.destination;return await t(e,n,i,s),i})(n,s,i)),e)}}),Pe,Mn,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(Gn,rs),ks,Os,Ts),ei=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Ie(c,a);if(!u){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return r.set(a,c),u?(await t(a,o.Q,c.Q,l),await t(a,o.detune,c.detune,l),await t(a,o.frequency,c.frequency,l),await t(a,o.gain,c.gain,l)):(await s(a,o.Q,c.Q,l),await s(a,o.detune,c.detune,l),await s(a,o.frequency,c.frequency,l),await s(a,o.gain,c.gain,l)),await i(o,a,c,l),c})(o,a,l)}}})(Gs,Wn,nn,Hs,Ts),ni=(t=>(e,n)=>t.set(e,n))(ms),si=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const l=r(t),c={...yn,...s},u=i(l,c),h=o(l);super(t,!1,u,h?n():null),this._Q=e(this,h,u.Q,qe,$e),this._detune=e(this,h,u.detune,1200*Math.log2(qe),-1200*Math.log2(qe)),this._frequency=e(this,h,u.frequency,t.sampleRate/2,0),this._gain=e(this,h,u.gain,40*Math.log10(qe),$e),this._nativeBiquadFilterNode=u,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw s();throw t}if(t.length!==e.length||e.length!==n.length)throw s()}})(Ns,Qs,ei,En,Wn,ks,Os,ni),ii=((t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,l=0)=>{const c=0===r.size;if(e(o))return i.call(n,o,a,l),t(r,[o,a,l],(t=>t[0]===o&&t[1]===a&&t[2]===l),!0),c&&s(),o;i.call(n,o,a),t(r,[o,a],(t=>t[0]===o&&t[1]===a),!0),c&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const l=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"==typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const c=0===r.size;l&&c&&i()})(n.disconnect),n})(Ge,Rs),ri=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),Vn(i,s),i})(Ds,((t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(s,(()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)}),(()=>i.disconnect(s)))})(Mn,ii)),oi=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={...wn,...r};super(t,!1,n(o,a),i(o)?e():null)}})(Ns,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Ie(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(ri,nn,Ts),ri,ks,Os),ai=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l=r({...xn,...o});super(t,!1,n(a,l),i(a)?e():null)}})(Ns,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Ie(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(Un,nn,Ts),Un,ks,Os,(t=>({...t,channelCount:t.numberOfOutputs}))),li=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),l=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(t){l.onended=t},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2]),start(t=0){l.start.call(l,t)},stop(t=0){l.stop.call(l,t)}};return t(i,l),s(zn(h,c),(()=>l.connect(c)),(()=>l.disconnect(c)))})(zs,Ys,Gn,ii),ci=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Vn(a,o),qn(a,o,"offset"),e(s,(()=>s(r)))||Ln(a),e(i,(()=>i(r)))||Fn(a),t(r,a),a})(zs,_s,li,as,cs),ui=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),l={...bn,...o},c=s(a,l),u=r(a),h=u?n():null;super(t,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=e(this,u,c.offset,qe,$e),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){Se(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),Le(this)&&Me(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ns,Qs,((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c,u){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(l,c,u)=>{let h=n(l);const d=Ie(h,c);if(!d){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(c,t),null!==o&&h.start(o),null!==a&&h.stop(a)}return r.set(c,h),d?await t(c,l.offset,h.offset,u):await s(c,l.offset,h.offset,u),await i(l,c,h,u),h})(l,c,u)}}})(Gs,ci,nn,Hs,Ts),ci,ks,Os,hs),hi=((t,e)=>(n,s)=>{const i=n.createConvolver();if(Vn(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Nn(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(Qn,rs),di=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l={...Tn,...o},c=n(a,l);super(t,!1,c,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&r(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ns,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Ie(a,r)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(r,e)}return s.set(r,a),Ze(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(hi,nn,Ts),hi,ks,Os,ni),pi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const l=i(t),c={...kn,...a},u=s(l,c),h=r(l);super(t,!1,u,h?n(c.maxDelayTime):null),this._delayTime=e(this,h,u.delayTime),o(this,c.maxDelayTime)}get delayTime(){return this._delayTime}})(Ns,Qs,((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,l,c){const u=o.get(l);return void 0!==u?Promise.resolve(u):(async(a,l,c)=>{let u=n(a);const h=Ie(u,l);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,t)}return o.set(l,u),h?await t(l,a.delayTime,u.delayTime,c):await s(l,a.delayTime,u.delayTime,c),await i(a,l,u,c),u})(a,l,c)}}})(Gs,Xn,nn,Hs,Ts),Xn,ks,Os,ni),fi=(t=>(e,n)=>{const s=e.createDynamicsCompressor();if(Vn(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return qn(s,n,"attack"),qn(s,n,"knee"),qn(s,n,"ratio"),qn(s,n,"release"),qn(s,n,"threshold"),s})(Qn),mi=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const l=r(t),c={...Sn,...i},u=s(l,c),h=o(l);super(t,!1,u,h?n():null),this._attack=e(this,h,u.attack),this._knee=e(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,h,u.ratio),this._release=e(this,h,u.release),this._threshold=e(this,h,u.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ns,Qs,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Ie(c,a);if(!u){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return r.set(a,c),u?(await t(a,o.attack,c.attack,l),await t(a,o.knee,c.knee,l),await t(a,o.ratio,c.ratio,l),await t(a,o.release,c.release,l),await t(a,o.threshold,c.threshold,l)):(await s(a,o.attack,c.attack,l),await s(a,o.knee,c.knee,l),await s(a,o.ratio,c.ratio,l),await s(a,o.release,c.release,l),await s(a,o.threshold,c.threshold,l)),await i(o,a,c,l),c})(o,a,l)}}})(Gs,fi,nn,Hs,Ts),fi,Qn,ks,Os,ni),gi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),l={...On,...o},c=s(a,l),u=r(a);super(t,!1,c,u?n():null),this._gain=e(this,u,c.gain,qe,$e)}get gain(){return this._gain}})(Ns,Qs,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Ie(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.gain,c.gain,l):await s(a,o.gain,c.gain,l),await i(o,a,c,l),c})(o,a,l)}}})(Gs,Gn,nn,Hs,Ts),Gn,ks,Os),_i=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=jn(r,i.sampleRate),d=c instanceof Float64Array?c:new Float64Array(c),p=u instanceof Float64Array?u:new Float64Array(u),f=d.length,m=p.length,g=Math.min(f,m);if(0===f||f>20)throw s();if(0===d[0])throw e();if(0===m||m>20)throw s();if(0===p[0])throw e();if(1!==d[0]){for(let t=0;t<m;t+=1)p[t]/=d[0];for(let t=1;t<f;t+=1)d[t]/=d[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=l;const v=[],y=[],w=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),w.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);v[t]=In(d,f,p,m,g,y[t],w[t],v[t],32,s,i)}};const x=i.sampleRate/2;return zn({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/x),r=[Math.cos(i),Math.sin(i)],o=Yn(Hn(p,r),Hn(d,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(En,Mn,Zn,Qn),vi=((t,e,n,s)=>i=>t(Pn,(()=>Pn(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(_s,Gn,Zn,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(Gn,Ss)),yi=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let l=null;const c=async(c,u,h)=>{let d=null,p=e(c);const f=Ie(p,u);if(void 0===u.createIIRFilter?d=t(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=u.createIIRFilter(o,r)),a.set(u,null===d?p:d),null!==d){if(null===l){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,u.sampleRate);l=(async()=>{await s(c,t,t.destination,h);return((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,l=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const c=new Float32Array(32),u=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let e=0;e<d;e+=1){const n=t.getChannelData(e),s=h.getChannelData(e);c.fill(0),u.fill(0),In(i,o,r,a,l,c,u,0,32,n,s)}return h})(await i(t),u,r,o)})()}const t=await l;return d.buffer=t,d.start(0),d}return await s(c,u,p,h),p};return{render(t,e,n){const s=a.get(e);return void 0!==s?Promise.resolve(s):c(t,e,n)}}})(Ys,nn,Ss,Ts,vi),wi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l=i(a),c={...Dn,...o},u=e(a,l?null:t.baseLatency,c);super(t,!1,u,l?n(c.feedback,c.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw En();return e.call(t,n,s,i)})})(u),this._nativeIIRFilterNode=u,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Ns,(t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Vn(i,s),i})(_i),yi,ks,Os,ni),xi=((t,e,n,s,i)=>(r,o)=>{const a=o.listener,{forwardX:l,forwardY:c,forwardZ:u,positionX:h,positionY:d,positionZ:p,upX:f,upY:m,upZ:g}=void 0===a.forwardX?(()=>{const l=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),c=i(o),u=s(o,256,9,0),h=(e,s)=>{const i=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});return i.connect(l,0,e),i.start(),Object.defineProperty(i.offset,"defaultValue",{get:()=>s}),t({context:r},c,i.offset,qe,$e)};let d=[0,0,-1,0,1,0],p=[0,0,0];return u.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some(((t,e)=>t!==d[e]))&&(a.setOrientation(...e),d=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some(((t,e)=>t!==p[e]))&&(a.setPosition(...n),p=n)},l.connect(u),{forwardX:h(0,0),forwardY:h(1,0),forwardZ:h(2,-1),positionX:h(6,0),positionY:h(7,0),positionZ:h(8,0),upX:h(3,0),upY:h(4,1),upZ:h(5,0)}})():a;return{get forwardX(){return l},get forwardY(){return c},get forwardZ(){return u},get positionX(){return h},get positionY(){return d},get positionZ(){return p},get upX(){return f},get upY(){return m},get upZ(){return g}}})(Qs,ri,ci,Zn,Os),bi=new WeakMap,Ti=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,pe.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(ti,xi,Es,Os,bi,hs),Ci=((t,e,n,s,i,r)=>(o,a)=>{const l=o.createOscillator();return Vn(l,a),qn(l,a,"detune"),qn(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):Nn(l,a,"type"),e(n,(()=>n(o)))||Ln(l),e(s,(()=>s(o)))||r(l,o),e(i,(()=>i(o)))||Fn(l),t(o,l),l})(zs,_s,as,ls,cs,us),ki=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){l=t},render(c,u,h){const d=r.get(u);return void 0!==d?Promise.resolve(d):(async(c,u,h)=>{let d=n(c);const p=Ie(d,u);if(!p){const t={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:null===o?void 0:o,type:d.type};d=e(u,t),null!==a&&d.start(a),null!==l&&d.stop(l)}return r.set(u,d),p?(await t(u,c.detune,d.detune,h),await t(u,c.frequency,d.frequency,h)):(await s(u,c.detune,d.detune,h),await s(u,c.frequency,d.frequency,h)),await i(c,u,d,h),d})(c,u,h)}}})(Gs,Ci,nn,Hs,Ts),Ai=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),l={...Kn,...o},c=n(a,l),u=r(a),h=u?s():null,d=t.sampleRate/2;super(t,!1,c,h),this._detune=e(this,u,c.detune,153600,-153600),this._frequency=e(this,u,c.frequency,d,-d),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){Se(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),Le(this)&&Me(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ns,Qs,Ci,ki,ks,Os,hs),Si=(t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(Ys),Oi=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...l})=>{const c=r.createWaveShaper(),u=r.createWaveShaper();Vn(c,l),Vn(u,l);const h=n(r,{...l,gain:1}),d=n(r,{...l,gain:-1}),p=n(r,{...l,gain:1}),f=n(r,{...l,gain:-1});let m=null,g=!1,_=null;const v={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){h.channelCount=t,d.channelCount=t,c.channelCount=t,p.channelCount=t,u.channelCount=t,f.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){h.channelCountMode=t,d.channelCountMode=t,c.channelCountMode=t,p.channelCountMode=t,u.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,d.channelInterpretation=t,c.channelInterpretation=t,p.channelInterpretation=t,u.channelInterpretation=t,f.channelInterpretation=t},get context(){return c.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)c.curve=n,u.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,l=Math.floor(a),c=Math.ceil(a);e[o]=l===c?n[l]:(1-(a-l))*n[l]+(1-(c-a))*n[c],s[o]=l===c?-n[t-1-l]:-(1-(a-l))*n[t-1-l]-(1-(c-a))*n[t-1-c]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,c.curve=e,u.curve=s}_=n,g&&(s(_)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(t){c.oversample=t,u.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a);return i(zn(v,p),(()=>{h.connect(c).connect(p),h.connect(d).connect(u).connect(f).connect(p),g=!0,s(_)&&(m=t(r,h))}),(()=>{h.disconnect(c),c.disconnect(p),h.disconnect(d),d.disconnect(u),u.disconnect(f),f.disconnect(p),g=!1,null!==m&&(m(),m=null)}))})(Si,Mn,Gn,is,ii),Mi=((t,e,n,s,i,r,o)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,l);Vn(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw e();Nn(c,{curve:u},"curve"),Nn(c,l,"oversample");let h=null,d=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),d&&(s(n)&&null===h?h=t(a,c):s(n)||null===h||(h(),h=null)),n)));return i(c,(()=>{d=!0,s(c.curve)&&(h=t(a,c))}),(()=>{d=!1,null!==h&&(h(),h=null)}))})(Si,Mn,Oi,is,ii,Ds,rs),Ei=(t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(Vn(s,n),qn(s,n,"orientationX"),qn(s,n,"orientationY"),qn(s,n,"orientationZ"),qn(s,n,"positionX"),qn(s,n,"positionY"),qn(s,n,"positionZ"),Nn(s,n,"coneInnerAngle"),Nn(s,n,"coneOuterAngle"),Nn(s,n,"coneOuterGain"),Nn(s,n,"distanceModel"),Nn(s,n,"maxDistance"),Nn(s,n,"panningModel"),Nn(s,n,"refDistance"),Nn(s,n,"rolloffFactor"),s)})(((t,e,n,s,i,r,o,a,l)=>(c,{coneInnerAngle:u,coneOuterAngle:h,coneOuterGain:d,distanceModel:p,maxDistance:f,orientationX:m,orientationY:g,orientationZ:_,panningModel:v,positionX:y,positionY:w,positionZ:x,refDistance:b,rolloffFactor:T,...C})=>{const k=c.createPanner();if(C.channelCount>2)throw o();if("max"===C.channelCountMode)throw o();Vn(k,C);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},S=n(c,{...A,channelInterpretation:"speakers",numberOfInputs:6}),O=s(c,{...C,gain:1}),M=s(c,{...A,gain:1}),E=s(c,{...A,gain:0}),D=s(c,{...A,gain:0}),I=s(c,{...A,gain:0}),R=s(c,{...A,gain:0}),P=s(c,{...A,gain:0}),N=i(c,256,6,1),V=r(c,{...A,curve:new Float32Array([1,1]),oversample:"none"});let $=[m,g,_],q=[y,w,x];N.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some(((t,e)=>t!==$[e]))&&(k.setOrientation(...e),$=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some(((t,e)=>t!==q[e]))&&(k.setPosition(...n),q=n)},Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0});const L={get bufferSize(){},get channelCount(){return k.channelCount},set channelCount(t){if(t>2)throw o();O.channelCount=t,k.channelCount=t},get channelCountMode(){return k.channelCountMode},set channelCountMode(t){if("max"===t)throw o();O.channelCountMode=t,k.channelCountMode=t},get channelInterpretation(){return k.channelInterpretation},set channelInterpretation(t){O.channelInterpretation=t,k.channelInterpretation=t},get coneInnerAngle(){return k.coneInnerAngle},set coneInnerAngle(t){k.coneInnerAngle=t},get coneOuterAngle(){return k.coneOuterAngle},set coneOuterAngle(t){k.coneOuterAngle=t},get coneOuterGain(){return k.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();k.coneOuterGain=t},get context(){return k.context},get distanceModel(){return k.distanceModel},set distanceModel(t){k.distanceModel=t},get inputs(){return[O]},get maxDistance(){return k.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;k.maxDistance=t},get numberOfInputs(){return k.numberOfInputs},get numberOfOutputs(){return k.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return E.gain},get orientationZ(){return D.gain},get panningModel(){return k.panningModel},set panningModel(t){k.panningModel=t},get positionX(){return I.gain},get positionY(){return R.gain},get positionZ(){return P.gain},get refDistance(){return k.refDistance},set refDistance(t){if(t<0)throw new RangeError;k.refDistance=t},get rolloffFactor(){return k.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;k.rolloffFactor=t},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])};u!==L.coneInnerAngle&&(L.coneInnerAngle=u),h!==L.coneOuterAngle&&(L.coneOuterAngle=h),d!==L.coneOuterGain&&(L.coneOuterGain=d),p!==L.distanceModel&&(L.distanceModel=p),f!==L.maxDistance&&(L.maxDistance=f),m!==L.orientationX.value&&(L.orientationX.value=m),g!==L.orientationY.value&&(L.orientationY.value=g),_!==L.orientationZ.value&&(L.orientationZ.value=_),v!==L.panningModel&&(L.panningModel=v),y!==L.positionX.value&&(L.positionX.value=y),w!==L.positionY.value&&(L.positionY.value=w),x!==L.positionZ.value&&(L.positionZ.value=x),b!==L.refDistance&&(L.refDistance=b),T!==L.rolloffFactor&&(L.rolloffFactor=T),1===$[0]&&0===$[1]&&0===$[2]||k.setOrientation(...$),0===q[0]&&0===q[1]&&0===q[2]||k.setPosition(...q);return l(zn(L,k),(()=>{O.connect(k),t(O,V,0,0),V.connect(M).connect(S,0,0),V.connect(E).connect(S,0,1),V.connect(D).connect(S,0,2),V.connect(I).connect(S,0,3),V.connect(R).connect(S,0,4),V.connect(P).connect(S,0,5),S.connect(N).connect(c.destination)}),(()=>{O.disconnect(k),a(O,V,0,0),V.disconnect(M),M.disconnect(S),V.disconnect(E),E.disconnect(S),V.disconnect(D),D.disconnect(S),V.disconnect(I),I.disconnect(S),V.disconnect(R),R.disconnect(S),V.disconnect(P),P.disconnect(S),S.disconnect(N),N.disconnect(c.destination)}))})(Qe,Mn,ri,Gn,Zn,Mi,Qn,en,ii)),Di=((t,e,n,s,i,r,o,a,l,c)=>()=>{const u=new WeakMap;let h=null;return{render(d,p,f){const m=u.get(p);return void 0!==m?Promise.resolve(m):(async(d,p,f)=>{let m=null,g=r(d);const _={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},v={..._,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=Ie(g,p);if("bufferSize"in g)m=s(p,{..._,gain:1});else if(!y){const t={...v,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,t)}if(u.set(p,null===m?g:m),null!==m){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,d.context.length,p.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),h=(async()=>{const e=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset,f),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return c(t)})()}const t=await h,r=s(p,{..._,gain:1});await l(d,p,r,f);const u=[];for(let e=0;e<t.numberOfChannels;e+=1)u.push(t.getChannelData(e));let g=[u[0][0],u[1][0],u[2][0]],y=[u[3][0],u[4][0],u[5][0]],w=s(p,{..._,gain:1}),x=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]});r.connect(w).connect(x.inputs[0]),x.connect(m);for(let e=128;e<t.length;e+=128){const t=[u[0][e],u[1][e],u[2][e]],n=[u[3][e],u[4][e],u[5][e]];if(t.some(((t,e)=>t!==g[e]))||n.some(((t,e)=>t!==y[e]))){g=t,y=n;const o=e/p.sampleRate;w.gain.setValueAtTime(0,o),w=s(p,{..._,gain:0}),x=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),w.gain.setValueAtTime(1,o),r.connect(w).connect(x.inputs[0]),x.connect(m)}}return m}return y?(await t(p,d.orientationX,g.orientationX,f),await t(p,d.orientationY,g.orientationY,f),await t(p,d.orientationZ,g.orientationZ,f),await t(p,d.positionX,g.positionX,f),await t(p,d.positionY,g.positionY,f),await t(p,d.positionZ,g.positionZ,f)):(await a(p,d.orientationX,g.orientationX,f),await a(p,d.orientationY,g.orientationY,f),await a(p,d.orientationZ,g.orientationZ,f),await a(p,d.positionX,g.positionX,f),await a(p,d.positionY,g.positionY,f),await a(p,d.positionZ,g.positionZ,f)),Ze(g)?await l(d,p,g.inputs[0],f):await l(d,p,g,f),g})(d,p,f)}}})(Gs,ri,ci,Gn,Ei,nn,Ss,Hs,Ts,vi),Ii=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const l=i(t),c={...ts,...a},u=n(l,c),h=r(l);super(t,!1,u,h?s():null),this._nativePannerNode=u,this._orientationX=e(this,h,u.orientationX,qe,$e),this._orientationY=e(this,h,u.orientationY,qe,$e),this._orientationZ=e(this,h,u.orientationZ,qe,$e),this._positionX=e(this,h,u.positionX,qe,$e),this._positionY=e(this,h,u.positionY,qe,$e),this._positionZ=e(this,h,u.positionZ,qe,$e),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ns,Qs,Ei,Di,ks,Os,ni),Ri=((t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...es,...r}),l=t(o,a);return n.add(l),l}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(Pe),ks,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),Pi=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return Vn(r,s),qn(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(((t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},h=(t,r,h,d,p)=>{if(1===r)return((t,e,i,r)=>{const h=new Float32Array(o),d=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*l;h[t]=Math.cos(e),d[t]=Math.sin(e)}const p=n(t,{...c,gain:0}),f=s(t,{...u,curve:h}),m=s(t,{...u,curve:a}),g=n(t,{...c,gain:0}),_=s(t,{...u,curve:d});return{connectGraph(){e.connect(p),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(g),m.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===_.inputs?_:_.inputs[0]),f.connect(p.gain),_.connect(g.gain),p.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){e.disconnect(p),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(g),m.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===_.inputs?_:_.inputs[0]),f.disconnect(p.gain),_.disconnect(g.gain),p.disconnect(r,0,0),g.disconnect(r,0,1)}}})(t,h,d,p);if(2===r)return((t,i,r,h)=>{const d=new Float32Array(o),p=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),g=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>g){const e=(t-g)/(16384-g)*l;d[t]=Math.cos(e),p[t]=Math.sin(e),f[t]=0,m[t]=1}else{const e=t/(16384-g)*l;d[t]=1,p[t]=0,f[t]=Math.cos(e),m[t]=Math.sin(e)}const _=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(t,{...c,gain:0}),y=s(t,{...u,curve:d}),w=n(t,{...c,gain:0}),x=s(t,{...u,curve:p}),b=s(t,{...u,curve:a}),T=n(t,{...c,gain:0}),C=s(t,{...u,curve:f}),k=n(t,{...c,gain:0}),A=s(t,{...u,curve:m});return{connectGraph(){i.connect(_),i.connect(void 0===b.inputs?b:b.inputs[0]),_.connect(v,0),_.connect(w,0),_.connect(T,1),_.connect(k,1),b.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===x.inputs?x:x.inputs[0]),r.connect(void 0===C.inputs?C:C.inputs[0]),r.connect(void 0===A.inputs?A:A.inputs[0]),y.connect(v.gain),x.connect(w.gain),C.connect(T.gain),A.connect(k.gain),v.connect(h,0,0),T.connect(h,0,0),w.connect(h,0,1),k.connect(h,0,1)},disconnectGraph(){i.disconnect(_),i.disconnect(void 0===b.inputs?b:b.inputs[0]),_.disconnect(v,0),_.disconnect(w,0),_.disconnect(T,1),_.disconnect(k,1),b.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===x.inputs?x:x.inputs[0]),r.disconnect(void 0===C.inputs?C:C.inputs[0]),r.disconnect(void 0===A.inputs?A:A.inputs[0]),y.disconnect(v.gain),x.disconnect(w.gain),C.disconnect(T.gain),A.disconnect(k.gain),v.disconnect(h,0,0),T.disconnect(h,0,0),w.disconnect(h,0,1),k.disconnect(h,0,1)}}})(t,h,d,p);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...l})=>{if("max"===o)throw i();const c=t(e,{...l,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=n(e,{...l,channelCount:s,channelCountMode:o,gain:1}),d=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:f}=h(e,s,u,d,c);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount!==t&&(g&&f(),({connectGraph:p,disconnectGraph:f}=h(e,t,u,d,c)),g&&p()),u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return d.gain},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};let g=!1;return r(zn(m,c),(()=>{p(),g=!0}),(()=>{f(),g=!1}))}})(ri,Un,Gn,Mi,Qn,ii),Qn),Ni=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Ie(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.pan,c.pan,l):await s(a,o.pan,c.pan,l),Ze(c)?await i(o,a,c.inputs[0],l):await i(o,a,c,l),c})(o,a,l)}}})(Gs,Pi,nn,Hs,Ts),Vi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),l={...ns,...o},c=n(a,l),u=r(a);super(t,!1,c,u?s():null),this._pan=e(this,u,c.pan)}get pan(){return this._pan}})(Ns,Qs,Pi,Ni,ks,Os),$i=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Ie(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(r,e)}return s.set(r,a),Ze(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(Mi,nn,Ts),qi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),l={...ss,...e},c=n(a,l);super(t,!0,c,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ns,Mn,Mi,$i,ks,Os,ni),Li=(t=>null!==t&&t.isSecureContext)(ws),Fi=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ws),ji=new WeakMap,Bi=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),t.set(n,s),s})(ji,Ss),Wi=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ws),Ui=Li?((t,e,n,s,i,r,o,a,l,c,u,h)=>(d,p,f={credentials:"omit"})=>{const m=r(d);if(void 0!==m.audioWorklet)return Promise.all([i(p),Promise.resolve(t(u,u))]).then((([[t,e],n])=>{const[s,i]=we(t,e),r=new Blob([`${s};((AudioWorkletProcessor,registerProcessor)=>{${i}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(r);return m.audioWorklet.addModule(l,f).then((()=>{if(a(m))return m;const t=o(m);return t.audioWorklet.addModule(l,f).then((()=>t))})).then((t=>{try{new AudioWorkletNode(t,"__sac")}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));const g=c.get(d);if(void 0!==g&&g.has(p))return Promise.resolve();const _=l.get(d);if(void 0!==_){const t=_.get(p);if(void 0!==t)return t}const v=i(p).then((([t,e])=>{const[s,i]=we(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=h._AWGS.pop();if(void 0===t)throw new SyntaxError;s(m.currentTime,m.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=ge.get(m);if(void 0!==s){if(s.has(t))throw e();be(n),xe(n.parameterDescriptors),s.set(t,n)}else be(n),xe(n.parameterDescriptors),ge.set(m,new Map([[t,n]]))}),m.sampleRate,void 0,void 0)))}));return void 0===_?l.set(d,new Map([[p,v]])):_.set(p,v),v.then((()=>{const t=c.get(d);void 0===t?c.set(d,new Set([p])):t.add(p)})).finally((()=>{const t=l.get(d);void 0!==t&&t.delete(p)})),v})(_s,Qn,(t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=t.onerror,c=()=>{t.onerror=l,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(c(),s(o),!1):null!==l?l(e,n,i,r,o):void 0,r.onerror=()=>{c(),s(new SyntaxError)},r.onload=()=>{c(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(ws),Fi,(t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()})((()=>new DOMException("","AbortError"))),ks,Bi,Os,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Wi,Ss),ws):void 0,zi=((t,e)=>n=>t(n)||e(n))(Is,Os),Xi=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f,m,g,_,v,y)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(t=1){return new u(this,{maxDelayTime:t})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(t,e){return new p(this,{feedback:e,feedforward:t})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new _(this,{...n,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return c(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}})(Ui,$s,Us,Ks,si,oi,ai,ui,di,((t,e,n,s,i,r,o,a,l,c,u)=>(h,d)=>{const p=o(h)?h:r(h);if(i.has(d)){const t=n();return Promise.reject(t)}try{i.add(d)}catch{}return e(l,(()=>l(p)))?p.decodeAudioData(d).then((n=>(Cn(d).catch((()=>{})),e(a,(()=>a(n)))||u(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await Cn(d)}catch{}},r=t=>{n(t),i()};try{p.decodeAudioData(d,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),Ne(n)),t.add(n),i().then((()=>e(n)))}),(t=>{r(null===t?s():t)}))}catch(t){r(t)}}))})(qs,_s,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,ks,zi,Re,Pn,Bs,Ws),pi,mi,gi,wi,Ti,Ai,Ii,Ri,Vi,qi),Gi=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ns,((t,e)=>t.createMediaElementSource(e.mediaElement)),ks,Os),Yi=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...Rn,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ns,((t,e)=>{const n=t.createMediaStreamDestination();return Vn(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),ks,Os),Hi=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ns,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i}),ks,Os),Zi=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(Ns,((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(Mn,Os),ks),Qi=((t,e,n,s,i,r,o,a,l)=>class extends t{constructor(t={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new l(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw n();throw t}if(null===e)throw s();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===l.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ue(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(Xi,Mn,Qn,(()=>new DOMException("","UnknownError")),Gi,Yi,Hi,Zi,Ds),Ji=(t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(bi),Ki=(t=>(e,n)=>{t(e).add(n)})(Ji),tr=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return cn(n)?r.connect(n,0,i):r.connect(n,0)})(Pe),er=(t=>(e,n)=>{t(e).delete(n)})(Ji),nr=(t=>(e,n,s,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?An(t,e,n).disconnect():cn(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?An(t,e,s).disconnect(n,0):An(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):An(t,e,s).disconnect(n,0))(Pe),sr=new WeakMap,ir=((t,e)=>n=>e(t,n))(sr,Te),rr=((t,e,n,s,i,r,o,a,l,c,u,h,d)=>(p,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw l();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some((t=>t<1)))throw l();if(_.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw l();const v=g.channelCount*g.numberOfInputs,y=_.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(v+w>6||y>6)throw l();const x=new MessageChannel,b=[],T=[];for(let t=0;t<g.numberOfInputs;t+=1)b.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const C=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of m.parameterDescriptors){const i=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?qe:e},minValue:{get:()=>void 0===n?$e:n}}),C.push(i)}const k=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+w)}),A=jn(f,p.sampleRate),S=a(p,A,v+w,Math.max(1,y)),O=i(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),M=[];for(let t=0;t<g.numberOfOutputs;t+=1)M.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[t]}));for(let t=0;t<g.numberOfInputs;t+=1){b[t].connect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[t].connect(k,e,t*g.channelCount+e)}const E=new pn(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=C[e];return n.connect(k,0,v+e),n.start(0),[t,n.offset]})));k.connect(S);let D=g.channelInterpretation,I=null;const R=0===g.numberOfOutputs?[S]:M,P={get bufferSize(){return A},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of b)e.channelInterpretation=t;D=t},get context(){return S.context},get inputs(){return b},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return I},set onprocessorerror(t){"function"==typeof I&&P.removeEventListener("processorerror",I),I="function"==typeof t?t:null,"function"==typeof I&&P.addEventListener("processorerror",I)},get parameters(){return E},get port(){return x.port2},addEventListener:(...t)=>S.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,R),disconnect:c.bind(null,R),dispatchEvent:(...t)=>S.dispatchEvent(t[0]),removeEventListener:(...t)=>S.removeEventListener(t[0],t[1],t[2])},N=new Map;var V,$;x.port1.addEventListener=(V=x.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=N.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(p.currentTime,p.sampleRate,(()=>e(t)))},N.set(e,t[1]))}}return V.call(x.port1,t[0],t[1],t[2])}),x.port1.removeEventListener=($=x.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=N.get(t[1]);void 0!==e&&(N.delete(t[1]),t[1]=e)}return $.call(x.port1,t[0],t[1],t[2])});let q=null;Object.defineProperty(x.port1,"onmessage",{get:()=>q,set:t=>{"function"==typeof q&&x.port1.removeEventListener("message",q),q="function"==typeof t?t:null,"function"==typeof q&&(x.port1.addEventListener("message",q),x.port1.start())}}),m.prototype.port=x.port1;let L=null;((t,e,n,s)=>{let i=_e.get(t);void 0===i&&(i=new WeakMap,_e.set(t,i));const r=Bn(n,s);return i.set(e,r),r})(p,P,m,g).then((t=>L=t));const F=_n(g.numberOfInputs,g.channelCount),j=_n(g.numberOfOutputs,_),B=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let W=!0;const U=()=>{g.numberOfOutputs>0&&S.disconnect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.disconnect(n,e+s,s);e+=_[t]}},z=new Map;S.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==L){const n=h(P);for(let s=0;s<A;s+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)mn(t,F[e],n,n,s);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{mn(t,B,e,v+n,s)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<_[t];e+=1)0===j[t][e].byteLength&&(j[t][e]=new Float32Array(128));try{const t=F.map(((t,e)=>{if(n[e].size>0)return z.set(e,A/128),t;const s=z.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?z.delete(e):z.set(e,s-1)),t)})),i=u(p.currentTime+s/p.sampleRate,p.sampleRate,(()=>L.process(t,j,B)));W=i;for(let t=0,n=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<_[t];i+=1)gn(e,j[t],i,n+i,s);n+=_[t]}}catch(t){W=!1,P.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!W){for(let t=0;t<g.numberOfInputs;t+=1){b[t].disconnect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[s].disconnect(k,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=C[e];t.disconnect(k,0,v+e),t.stop()}}k.disconnect(S),S.onaudioprocess=null,X?U():H();break}}}};let X=!1;const G=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Y=()=>S.connect(G).connect(p.destination),H=()=>{S.disconnect(G),G.disconnect()};return Y(),d(P,(()=>{if(W){H(),g.numberOfOutputs>0&&S.connect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.connect(n,e+s,s);e+=_[t]}}X=!0}),(()=>{W&&(Y(),U()),X=!1}))})(tr,Pe,Mn,ri,Un,ci,Gn,Zn,Qn,nr,Fi,ir,ii),or=((t,e,n,s,i)=>(r,o,a,l,c,u)=>{if(null!==a)try{const e=new a(r,l,u),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(d=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return d.call(e,"error",t[1],t[2]),d.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==u.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return i(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw s();throw t}var h,d;if(void 0===c)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(u),e(r,o,c,u)})(Mn,rr,Gn,Qn,ii),ar=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f,m)=>(g,_,v)=>{const y=new WeakMap;let w=null;return{render(x,b,T){a(b,x);const C=y.get(b);return void 0!==C?Promise.resolve(C):(async(a,x,b)=>{let T=u(a),C=null;const k=Ie(T,x),A=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=A.reduce(((t,e)=>t+e),0),n=i(x,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[t]}));const c=o(x,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=e.bind(null,r),c.disconnect=l.bind(null,r),C=[n,r,c]}else k||(T=new h(x,g));if(y.set(x,null===C?T:C[2]),null!==C){if(null===w){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,l=async()=>{const l=new d(n,128*Math.ceil(a.context.length/128),x.sampleRate),c=[],u=[];for(let t=0;t<_.numberOfInputs;t+=1)c.push(o(l,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(i(l,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await p(l,t,e.offset,b),e}))),g=s(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){c[t].connect(u[t]);for(let e=0;e<_.channelCount;e+=1)u[t].connect(g,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(l.destination),await Promise.all(c.map((t=>f(a,l,t,b)))),m(l)};w=vn(a,0===n?null:await l(),x,_,A,v,c)}const t=await w,e=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,h]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(l);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=u[t];for(let s=0;s<A[t];s+=1)l.connect(n,e+s,s);e+=A[t]}return h}if(k)for(const[e,n]of a.parameters.entries())await t(x,n,T.parameters.get(e),b);else for(const[t,e]of a.parameters.entries())await p(x,e,T.parameters.get(t),b);return await f(a,x,T,b),T})(x,b,T)}}})(Gs,tr,Ys,ri,Un,ci,Gn,er,nr,Fi,nn,Wi,Ss,Hs,Ts,vi),lr=(t=>e=>t.get(e))(ji),cr=(t=>(e,n)=>{t.set(e,n)})(sr),ur=Li?((t,e,n,s,i,r,o,a,l,c,u,h,d,p)=>class extends e{constructor(e,p,f){var m;const g=a(e),_=l(g),v=u({...fn,...f});d(v);const y=ge.get(g),w=null==y?void 0:y.get(p),x=_||"closed"!==g.state?g:null!==(m=o(g))&&void 0!==m?m:g,b=i(x,_?null:e.baseLatency,c,p,w,v);super(e,!0,b,_?s(p,v,w):null);const T=[];b.parameters.forEach(((t,e)=>{const s=n(this,_,t);T.push([e,s])})),this._nativeAudioWorkletNode=b,this._onprocessorerror=null,this._parameters=new pn(T),_&&t(g,this);const{activeInputs:C}=r(this);h(b,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?p(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Ki,Ns,Qs,ar,or,je,lr,ks,Os,Wi,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),cr,(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}}),hs):void 0,hr=((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Qn,Ss),dr=((t,e,n,s,i,r,o,a)=>{const l=[];return(c,u)=>n(c).render(c,u,l).then((()=>Promise.all(Array.from(s(u)).map((t=>n(t).render(t,u,l)))))).then((()=>i(u))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),Ne(n)):e(r,(()=>r(n)))||a(n),t.add(n),n)))})(qs,_s,bs,Ji,vi,Re,Bs,Ws),pr=((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:l}={...Jn,...r},c=s(a,o,l);e(Pn,(()=>Pn(c)))||c.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(c.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(c,a),this._length=o,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,Ue(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(Xi,_s,Mn,hr,dr),fr=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(pe,Is),mr=((t,e)=>n=>t.has(n)||e(n))(ue,Rs),gr=((t,e)=>n=>t.has(n)||e(n))(de,Ps),_r=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(pe,Os);function vr(t,e){if(!t)throw new Error(e)}function yr(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function wr(t){t.isOffline||"running"===t.state||br('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let xr=console;function br(...t){xr.warn(...t)}function Tr(t){return void 0===t}function Cr(t){return!Tr(t)}function kr(t){return"number"==typeof t}function Ar(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Sr(t){return Array.isArray(t)}function Or(t){return"string"==typeof t}function Mr(t){return Or(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Er="object"==typeof self?self:null,Dr=Er&&(Er.hasOwnProperty("AudioContext")||Er.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function Ir(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function Rr(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))}class Pr{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Nr(t){return gr(t)}function Vr(t){return mr(t)}function $r(t){return _r(t)}function qr(t){return fr(t)}function Lr(t){return t instanceof AudioBuffer}function Fr(t,e){return"value"===t||Nr(e)||Vr(e)||Lr(e)}function jr(t,...e){if(!e.length)return t;const n=e.shift();if(Ar(t)&&Ar(n))for(const e in n)Fr(e,n[e])?t[e]=n[e]:Ar(n[e])?(t[e]||Object.assign(t,{[e]:{}}),jr(t[e],n[e])):Object.assign(t,{[e]:n[e]});return jr(t,...e)}function Br(t,e,n=[],s){const i={},r=Array.from(e);if(Ar(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(jr(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&Ar(r[0]))jr(i,r[0]);else for(let t=0;t<n.length;t++)Cr(r[t])&&(i[n[t]]=r[t]);return jr(t,i)}function Wr(t,e){return Tr(t)?e:t}function Ur(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}
/**
     * Tone.js
     * @author Yotam Mann
     * @license http://opensource.org/licenses/MIT MIT License
     * @copyright 2014-2019 Yotam Mann
     */class zr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Er&&this.toString()===Er.TONE_DEBUG_CLASS)&&function(...t){xr.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}zr.version=Jt;const Xr=1e-6;function Gr(t,e){return t>e+Xr}function Yr(t,e){return Gr(t,e)||Zr(t,e)}function Hr(t,e){return t+Xr<e}function Zr(t,e){return Math.abs(t-e)<Xr}class Qr extends zr{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Br(Qr.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(vr(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];vr(Yr(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Zr(this._timeline[e].time,t)){for(let n=e;n>=0&&Zr(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&Yr(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(Zr(r[e],t)){for(let n=s;n<this._timeline.length;n++){if(!Zr(this._timeline[n][e],t))break;s=n}return s}if(Hr(r[e],t)&&Gr(o[e],t))return s;Gr(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&Zr(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&Zr(this._timeline[e].time,t);e--)s=e;this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Jr=[];function Kr(t){Jr.push(t)}const to=[];function eo(t){to.push(t)}class no extends zr{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Tr(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Tr(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Tr(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(no.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class so extends no{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class io extends so{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Qr,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=Br(io.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new Qi(t)}({latencyHint:t.latencyHint}),this._ticker=new Pr(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,Jr.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){vr(qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){vr(qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){vr(qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){vr(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){vr(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){vr(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){vr(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return vr(Cr(ur),"This node only works in a secure context (https or localhost)"),new ur(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return Rr(this,void 0,void 0,(function*(){vr(Cr(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return Rr(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Or(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return qr(this._context)?this._context.resume():Promise.resolve()}close(){return Rr(this,void 0,void 0,(function*(){var t;qr(this._context)&&(yield this._context.close()),this._initialized&&(t=this,to.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function ro(t,e){Sr(e)?e.forEach((e=>ro(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function oo(t,e){Sr(e)?e.forEach((e=>oo(t,e))):Object.defineProperty(t,e,{writable:!0})}const ao=()=>{};class lo extends zr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ao;const t=Br(lo.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Lr(t.url)||t.url instanceof lo?this.set(t.url):Or(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:ao,onload:ao,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:po().sampleRate}set(t){return t instanceof lo?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Rr(this,void 0,void 0,(function*(){const e=lo.load(t).then((t=>{this.set(t),this.onload(this)}));lo.downloads.push(e);try{yield e}finally{const t=lo.downloads.indexOf(e);lo.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Sr(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=po(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(kr(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(kr(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);vr(n<s,"The start time must be less than the end time");const i=s-n,r=po().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new lo(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new lo).fromArray(t)}static fromUrl(t){return Rr(this,void 0,void 0,(function*(){const e=new lo;return yield e.load(t)}))}static load(t){return Rr(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(lo.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===lo.baseUrl||lo.baseUrl.endsWith("/")?lo.baseUrl:lo.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const i=yield s.arrayBuffer();return yield po().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Rr(this,void 0,void 0,(function*(){for(yield Promise.resolve();lo.downloads.length;)yield lo.downloads[0]}))}}lo.baseUrl="",lo.downloads=[];class co extends io{constructor(){var t,e,n;super({clockSource:"offline",context:$r(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new pr(t,e,n)),lookAhead:0,updateInterval:$r(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=$r(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Rr(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return Rr(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new lo(e)}))}close(){return Promise.resolve()}}const uo=new class extends so{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return Rr(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let ho=uo;function po(){return ho===uo&&Dr&&fo(new io),ho}function fo(t){ho=qr(t)?new io(t):$r(t)?new co(t):t}if(Er&&!Er.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${t}`,"background: #000; color: #fff")}function mo(t){return Math.pow(2,t/12)}let go=440;function _o(t){return Math.round(vo(t))}function vo(t){return 69+12*Math.log2(t/go)}class yo extends zr{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof yo&&this.fromType(this._val),Tr(this._val))return this._noArg();if(Or(this._val)&&Tr(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Ar(this._val)){let t=0;for(const e in this._val)if(Cr(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Cr(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Or(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class wo extends yo{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new wo(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new wo(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new wo(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return _o(this.toFrequency())}_now(){return this.context.now()}}class xo extends wo{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return go}static set A4(t){!function(t){go=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:xo.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=bo[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:xo.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new xo(this.context,this.valueOf()*mo(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return _o(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/xo.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return To[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return function(t){return go*Math.pow(2,(t-69)/12)}(t)}static ftom(t){return _o(t)}}const bo={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},To=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Co extends wo{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ko extends zr{constructor(){super();const t=Br(ko.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:po()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new wo(this.context,t).toSeconds()}toFrequency(t){return new xo(this.context,t).toFrequency()}toTicks(t){return new Co(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Tr(t[n])&&delete e[n]})),e}get(){const t=function(t){return t.constructor.getDefaults()}(this);return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Cr(n)&&Cr(n.value)&&Cr(n.setValueAtTime)?t[e]=n.value:n instanceof ko?t[e]=n._getPartialProperties(t[e]):Sr(n)||kr(n)||Or(n)||"boolean"==typeof n?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Cr(this[e])&&(this[e]&&Cr(this[e].value)&&Cr(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof ko?this[e].set(t[e]):this[e]=t[e])})),this}}class Ao extends Qr{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return yr(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class So extends ko{constructor(){super(Br(So.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=Br(So.getDefaults(),arguments,["param","units","convert"]);for(vr(Cr(t.param)&&(Nr(t.param)||t.param instanceof So),"param must be an AudioParam");!Nr(t.param);)t.param=t.param._param;this._swappable=!!Cr(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Qr(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Cr(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(ko.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Cr(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Cr(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Cr(this.maxValue)&&Cr(this.minValue)&&yr(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return vr(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return vr(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=Zr(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return vr(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);vr(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),vr(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return vr(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));vr(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&Zr(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){vr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class Oo extends ko{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Cr(this.input)?Nr(this.input)||this.input instanceof So?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Cr(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Cr(t)&&(t instanceof Oo||Vr(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();vr(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Eo(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return br("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return function(t,e,n=0,s=0){if(Cr(e))for(;e instanceof Oo;)e=e.input;for(;!Vr(t);)Cr(t.output)&&(t=t.output);Nr(e)?t.disconnect(e,n):Vr(e)?t.disconnect(e,n,s):t.disconnect()}(this,t,e,n),this}chain(...t){return Mo(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Cr(this.input)&&(this.input instanceof Oo?this.input.dispose():Vr(this.input)&&this.input.disconnect()),Cr(this.output)&&(this.output instanceof Oo?this.output.dispose():Vr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Mo(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Oo?t.connect(e):Vr(t)&&Eo(t,e),e)),e)}function Eo(t,e,n=0,s=0){for(vr(Cr(t),"Cannot connect from undefined node"),vr(Cr(e),"Cannot connect to undefined node"),(e instanceof Oo||Vr(e))&&vr(e.numberOfInputs>0,"Cannot connect to node with no inputs"),vr(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Oo||e instanceof So;)Cr(e.input)&&(e=e.input);for(;t instanceof Oo;)Cr(t.output)&&(t=t.output);Nr(e)?t.connect(e,n):t.connect(e,n,s)}class Do extends Oo{constructor(){super(Br(Do.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=Br(Do.getDefaults(),arguments,["gain","units"]);this.gain=new So({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),ro(this,"gain")}static getDefaults(){return Object.assign(Oo.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Io extends Oo{constructor(t){super(t),this.onended=ao,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Do({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(Oo.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ao})}_startGain(t,e=1){vr(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){vr(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ao&&(this.onended(this),this.onended=ao,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),vr(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Ro extends Io{constructor(){super(Br(Ro.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=Br(Ro.getDefaults(),arguments,["offset"]);Eo(this._source,this._gainNode),this.offset=new So({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Io.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Po extends Oo{constructor(){super(Br(Po.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=Br(Po.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Ro({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Oo.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return No(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function No(t,e,n,s){(e instanceof So||Nr(e)||e instanceof Po&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Po&&(e.overridden=!0)),Eo(t,e,n,s)}class Vo extends So{constructor(){super(Br(Vo.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Qr(1/0),this._multiplier=1;const t=Br(Vo.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(So.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Tr(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class $o extends Po{constructor(){super(Br($o.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=Br($o.getDefaults(),arguments,["value"]);this.input=this._param=new Vo({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Po.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class qo extends ko{constructor(){super(Br(qo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ao,this._tickOffset=new Qr;const t=Br(qo.getDefaults(),arguments,["frequency"]);this.frequency=new $o({context:this.context,units:t.units,value:t.frequency}),ro(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ko.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Cr(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let l=Math.ceil(a)-a;l=Zr(l,1)?0:l;let c=this.frequency.getTimeOfTick(o+l);for(;c<e;){try{n(c,Math.round(this.getTicksAtTime(c)))}catch(t){i=t;break}c+=this.frequency.getDurationOfTicks(1,c)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Lo extends ko{constructor(){super(Br(Lo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=ao,this._lastUpdate=0,this._state=new Ao("stopped"),this._boundLoop=this._loop.bind(this);const t=Br(Lo.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new qo({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ro(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ko.getDefaults(),{callback:ao,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){wr(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}no.mixin(Lo);class Fo extends zr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Br(Fo.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:ao,onload:ao,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return vr(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=ao,s=ao){return Or(e)?this._buffers.set(t.toString(),new lo(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new lo(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class jo extends Co{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Bo extends ko{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Qr,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Kr((t=>{t.draw=new Bo({context:t})})),eo((t=>{t.draw.dispose()}));class Wo extends zr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){vr(Cr(t.time),"Events must have a time property"),vr(Cr(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Uo(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class Uo{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class zo extends Oo{constructor(){super(Br(zo.getDefaults(),arguments,["volume"])),this.name="Volume";const t=Br(zo.getDefaults(),arguments,["volume"]);this.input=this.output=new Do({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,ro(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(Oo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Xo extends Oo{constructor(){super(Br(Xo.getDefaults(),arguments)),this.name="Destination",this.input=new zo({context:this.context}),this.output=new Do({context:this.context}),this.volume=this.input.volume;const t=Br(Xo.getDefaults(),arguments);Mo(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Oo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Mo(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Kr((t=>{t.destination=new Xo({context:t})})),eo((t=>{t.destination.dispose()}));class Go extends zr{constructor(t){super(),this.name="TimelineValue",this._timeline=new Qr({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Yo{constructor(t,e){this.id=Yo._eventId++;const n=Object.assign(Yo.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:ao,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Yo._eventId=0;class Ho extends Yo{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(Ho.getDefaults(),e);this.duration=new jo(t.context,n.duration).valueOf(),this._interval=new jo(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Yo.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Zo extends ko{constructor(){super(Br(Zo.getDefaults(),arguments)),this.name="Transport",this._loop=new Go(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Qr,this._repeatedEvents=new Wo,this._syncedSignals=[],this._swingAmount=0;const t=Br(Zo.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Lo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),ro(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(ko.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new jo(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new Yo(this,{callback:t,time:new Co(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new Ho(this,{callback:t,duration:new wo(this.context,s).toTicks(),interval:new wo(this.context,e).toTicks(),time:new Co(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new Yo(this,{callback:t,once:!0,time:new Co(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new jo(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Cr(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Sr(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new wo(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new wo(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new jo(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new jo(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/s}else e=0}const n=new Do(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),oo(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}no.mixin(Zo),Kr((t=>{t.transport=new Zo({context:t})})),eo((t=>{t.transport.dispose()}));class Qo extends Oo{constructor(t){super(t),this.input=void 0,this._state=new Ao("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ao,this._syncedStop=ao,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new zo({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,ro(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(Oo.getDefaults(),{mute:!1,onstop:ao,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Tr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(Wr(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else wr(this.context),this._start(s,e,n);else vr(Gr(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Tr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Cr(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ao,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Jo extends Io{constructor(){super(Br(Jo.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=Br(Jo.getDefaults(),arguments,["url","onload"]);Eo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new So({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new lo(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Io.getDefaults(),{url:new lo,loop:!1,loopEnd:0,loopStart:0,onload:ao,onerror:ao,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){vr(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?Wr(e,this.loopStart):Wr(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;Yr(r,t)&&(r=(r-e)%n+e),Zr(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Hr(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),Cr(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function Ko(t,e){return Rr(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new co(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class ta extends Io{constructor(){super(Br(ta.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=Br(ta.getDefaults(),arguments,["frequency","type"]);Eo(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new So({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new So({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),ro(this,["frequency","detune"])}static getDefaults(){return Object.assign(Io.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ea extends Qo{constructor(){super(Br(ea.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=Br(ea.getDefaults(),arguments,["frequency","type"]);this.frequency=new Po({context:this.context,units:"frequency",value:t.frequency}),ro(this,"frequency"),this.detune=new Po({context:this.context,units:"cents",value:t.detune}),ro(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Qo.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new ta({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return ea._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=ea._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Cr(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),ea._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),ea._periodicWaveCache.length>100&&ea._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){yr(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return i=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ea._periodicWaveCache=[];class na extends Oo{constructor(){super(Object.assign(Br(na.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return No(this,t,e,n),this}}class sa extends na{constructor(){super(Object.assign(Br(sa.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=Br(sa.getDefaults(),arguments,["mapping","length"]);Sr(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Po.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){vr(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ia extends na{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new sa({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ra extends Po{constructor(){super(Object.assign(Br(ra.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=Br(ra.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Do({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class oa extends Qo{constructor(){super(Br(oa.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new ia({context:this.context}),this._modulationNode=new Do({context:this.context});const t=Br(oa.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ea({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ea({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new ra({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ro(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ea.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class aa extends Qo{constructor(){super(Br(aa.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Do({context:this.context,gain:0});const t=Br(aa.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ea({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Po({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ea({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new ra({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new ra({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ro(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ea.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class la extends Qo{constructor(){super(Br(la.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Do({context:this.context,gain:0}),this._thresh=new sa({context:this.context,mapping:t=>t<=0?-1:1});const t=Br(la.getDefaults(),arguments,["frequency","width"]);this.width=new Po({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ea({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ro(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Qo.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ca extends Qo{constructor(){super(Br(ca.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=Br(ca.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Po({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Po({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,ro(this,["frequency","detune"])}static getDefaults(){return Object.assign(ea.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(yr(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new ea({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):ao});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class ua extends Qo{constructor(){super(Br(ua.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ra({context:this.context,value:2});const t=Br(ua.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new la({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ea({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ro(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Qo.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const ha={am:oa,fat:ca,fm:aa,oscillator:ea,pulse:la,pwm:ua};class da extends Qo{constructor(){super(Br(da.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=Br(da.getDefaults(),arguments,["frequency","type"]);this.frequency=new Po({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Po({context:this.context,units:"cents",value:t.detune}),ro(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ea.getDefaults(),aa.getDefaults(),oa.getDefaults(),ca.getDefaults(),la.getDefaults(),ua.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=ha[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof ha[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&kr(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&kr(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Or(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){return Ko(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function pa(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){yr(s,t,e),n.set(this,s)}})}}function fa(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){yr(this.toSeconds(s),t,e),n.set(this,s)}})}}class ma extends Qo{constructor(){super(Br(ma.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=Br(ma.getDefaults(),arguments,["url","onload"]);this._buffer=new lo({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Qo.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ao,onerror:ao,playbackRate:1,reverse:!1})}load(t){return Rr(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=ao){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Wr(e,this._loopStart):Wr(e,0);const s=this.toSeconds(e),i=n;n=Wr(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new Jo({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Tr(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&yr(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&yr(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Ir([fa(0)],ma.prototype,"fadeIn",void 0),Ir([fa(0)],ma.prototype,"fadeOut",void 0);class ga extends Oo{constructor(){super(Br(ga.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Po({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=Br(ga.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Oo.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Or(t))return t;{let n;for(n in _a)if(_a[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Or(n)&&Reflect.has(_a,n)){const s=_a[n];Ar(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!Sr(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){vr(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(vr(Sr(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return No(this,t,e,n),this}asArray(t=1024){return Rr(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new co(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Ir([fa(0)],ga.prototype,"attack",void 0),Ir([fa(0)],ga.prototype,"decay",void 0),Ir([pa(0,1)],ga.prototype,"sustain",void 0),Ir([fa(0)],ga.prototype,"release",void 0);const _a=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,s=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(s*(1-n))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:l(a),Out:a},cosine:{In:s,Out:(c=s,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:l(i)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var c})();class va extends Oo{constructor(){super(Br(va.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=Br(va.getDefaults(),arguments);this._volume=this.output=new zo({context:this.context,volume:t.volume}),this.volume=this._volume.volume,ro(this,"volume")}static getDefaults(){return Object.assign(Oo.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ya extends va{constructor(){super(Br(ya.getDefaults(),arguments));const t=Br(ya.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(va.getDefaults(),{detune:0,onsilence:ao,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof xo?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Ir([fa(0)],ya.prototype,"portamento",void 0);class wa extends ga{constructor(){super(Br(wa.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Do({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class xa extends ya{constructor(){super(Br(xa.getDefaults(),arguments)),this.name="Synth";const t=Br(xa.getDefaults(),arguments);this.oscillator=new da(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new wa(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),ro(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ya.getDefaults(),{envelope:Object.assign(Ur(ga.getDefaults(),Object.keys(Oo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Ur(da.getDefaults(),[...Object.keys(Qo.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class ba extends xa{constructor(){super(Br(ba.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=Br(ba.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,ro(this,["oscillator","envelope"])}static getDefaults(){return jr(ya.getDefaults(),xa.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof xo?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ir([pa(0)],ba.prototype,"octaves",void 0),Ir([fa(0)],ba.prototype,"pitchDecay",void 0);const Ta=new Set;function Ca(t){Ta.add(t)}function ka(t,e){const n=`registerProcessor("${t}", ${e})`;Ta.add(n)}Ca('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Ca("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Ca("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");ka("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Aa extends va{constructor(){super(Br(Aa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=Br(Aa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(vr(Mr(n)||kr(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),Mr(n)){const s=new xo(this.context,n).toMidi();e[s]=t.urls[n]}else kr(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new Fo({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(va.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ao,onerror:ao,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=vo(new xo(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,l=this._buffers.get(a),c=mo(o+r),u=new Jo({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);u.start(e,0,l.duration/c,n),Sr(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(u);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new xo(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),Sr(e)?(vr(Sr(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(vr(Mr(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Mr(t)){const s=new xo(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Ir([fa(0)],Aa.prototype,"attack",void 0),Ir([fa(0)],Aa.prototype,"release",void 0);ka("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Sa extends Oo{constructor(){super(...arguments),this.name="Listener",this.positionX=new So({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new So({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new So({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new So({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new So({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new So({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new So({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new So({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new So({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Oo.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Kr((t=>{t.listener=new Sa({context:t})})),eo((t=>{t.listener.dispose()})),po().transport,po().destination,po().destination,po().listener,po().draw,po();const Oa=new ma("../images/drop_board.wav").toDestination(),Ma=new ma("../images/drop_rack.wav").toDestination();Oa.volume.value=-10,Ma.volume.value=-20,fo(new io({latencyHint:"playback"}));const Ea=()=>{lo.loaded(),document.removeEventListener("mouseover",Ea),document.removeEventListener("scroll",Ea),document.removeEventListener("keydown",Ea)};document.addEventListener("mouseover",Ea),document.addEventListener("scroll",Ea),document.addEventListener("keydown",Ea);function Da(t){let e,n,s,i;return{c(){e=f("div"),y(e,"class",n=c("prevent-scroll "+t[4])+" svelte-1cnch2j"),y(e,"style",t[6])},m(n,r){h(n,e,r),s||(i=v(e,"touchstart",t[8]),s=!0)},p(t,s){16&s&&n!==(n=c("prevent-scroll "+t[4])+" svelte-1cnch2j")&&y(e,"class",n),64&s&&y(e,"style",t[6])},d(t){t&&d(e),s=!1,i()}}}function Ia(t){let e,n,s,i=t[1]&&!t[2]&&Da(t);return n=new Qt({props:{letter:t[3]?t[0].joker:t[0].letter,value:tt[t[0].letter].pts,id:t[0].id,classes:t[4],styles:t[6],self:t[7],on_mousedown:t[5]}}),{c(){i&&i.c(),e=g(),B(n.$$.fragment)},m(t,r){i&&i.m(t,r),h(t,e,r),W(n,t,r),s=!0},p(t,[s]){t[1]&&!t[2]?i?i.p(t,s):(i=Da(t),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null);const r={};9&s&&(r.letter=t[3]?t[0].joker:t[0].letter),1&s&&(r.value=tt[t[0].letter].pts),1&s&&(r.id=t[0].id),16&s&&(r.classes=t[4]),64&s&&(r.styles=t[6]),32&s&&(r.on_mousedown=t[5]),n.$set(r)},i(t){s||(F(n.$$.fragment,t),s=!0)},o(t){j(n.$$.fragment,t),s=!1},d(t){i&&i.d(t),t&&d(e),U(n,t)}}}function Ra(t,e,n){let s,i,r,o,a,c,u,h;l(t,Z,(t=>n(13,h=t)));let d,{game:p}=e,{letter:f}=e,m={x:null,y:null};const g=t=>t.touches?(t.preventDefault&&t.preventDefault(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.touches[0]):t,_=t=>{let e=g(t);window.addEventListener("mousemove",v),window.addEventListener("touchmove",v,{passive:!1}),window.addEventListener("mouseup",y),window.addEventListener("touchend",y),window.addEventListener("touchstart",g,{passive:!1}),n(2,r=!0),n(10,m=p.getXY(e)),d=p.getLocation(e),zt(h.letters.filter((t=>!t.board)),h.letters.filter((t=>t.id===f.id))[0]),Q.setHoverLocation(d)},v=t=>{let e=g(t);n(10,m=p.getXY(e)),d=p.getLocation(e),d.board||void 0===d.index?Gt():Xt(d.index),Q.setHoverLocation(d)},y=t=>{if(g(t),window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",v),window.removeEventListener("mouseup",y),window.removeEventListener("touchend",y),window.removeEventListener("touchstart",g),!d.board&&void 0!==d.index){Yt().map((t=>{Z.moveLetter(t.id,!1,t.index)}))}void 0!==d.index&&(o&&(d.board&&""===h.letters.filter((t=>t.id===f.id))[0].joker?Z.setJokerPicker(f,!0):d.board||Z.setJoker(f.id,"")),Z.moveLetter(f.id,d.board,d.index),d.board?Oa.start("-0.1"):Ma.start("-0.1")),n(2,r=!1),Q.setHoverLocation(null)};return t.$$set=t=>{"game"in t&&n(9,p=t.game),"letter"in t&&n(0,f=t.letter)},t.$$.update=()=>{1&t.$$.dirty&&n(1,s=f.free),1&t.$$.dirty&&n(11,i=f.board),1&t.$$.dirty&&n(3,o="_"===f.letter),2062&t.$$.dirty&&n(4,a=(r?" grab":"")+(i?" board":" rack")+(s?" free":"")+(o?" isjoker":"")),6&t.$$.dirty&&n(5,c=s&&!r?_:null),1024&t.$$.dirty&&n(6,u=`--x:${m.x}px; --y:${m.y}px;`),3589&t.$$.dirty&&n(6,u=r?`--x:${m.x}px; --y:${m.y}px;`:i?`--x:${p.getBoardXY(f.index).x}; --y:${p.getBoardXY(f.index).y};`:`--pos:${p.getRackPos(f.index)};`)},n(2,r=!1),[f,s,r,o,a,c,u,undefined,t=>{console.log("scroll_attempt"),t.preventDefault&&t.preventDefault(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation()},p,m,i]}class Pa extends G{constructor(t){super(),X(this,t,Ra,Ia,r,{game:9,letter:0})}}function Na(t,e,n){const s=t.slice();return s[8]=e[n],s[10]=n,s}function Va(t){let e,n;return e=new Qt({props:{letter:t[8],value:"",id:t[10],classes:t[2][t[10]]?"joker selected":"joker",on_click:function(){return t[5](t[10])}}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(n,s){t=n;const i={};4&s&&(i.classes=t[2][t[10]]?"joker selected":"joker"),e.$set(i)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function $a(t){let e,n,r,o,a,l,c,_,w,x,b,T,C,k,A,S,O=t[3],M=[];for(let e=0;e<O.length;e+=1)M[e]=Va(Na(t,O,e));const E=t=>j(M[t],1,1,(()=>{M[t]=null}));return{c(){e=f("div"),n=g(),r=f("div"),o=f("div"),o.textContent="Selectionne la lettre que tu souhaites attribuer à ton joker:",a=g(),l=f("div");for(let t=0;t<M.length;t+=1)M[t].c();c=g(),_=f("div"),w=f("button"),w.textContent="Annuler",x=g(),b=f("button"),T=m("Valider"),y(e,"class","overlay svelte-1iqdsh7"),y(o,"class","description svelte-1iqdsh7"),y(l,"class","letters svelte-1iqdsh7"),y(w,"class","svelte-1iqdsh7"),b.disabled=C=-1===t[2].indexOf(!0),y(b,"class","svelte-1iqdsh7"),y(_,"class","actions svelte-1iqdsh7"),y(r,"class","container svelte-1iqdsh7")},m(s,d){h(s,e,d),h(s,n,d),h(s,r,d),u(r,o),u(r,a),u(r,l);for(let t=0;t<M.length;t+=1)M[t].m(l,null);u(r,c),u(r,_),u(_,w),u(_,x),u(_,b),u(b,T),k=!0,A||(S=[v(w,"click",(function(){i(t[0])&&t[0].apply(this,arguments)})),v(b,"click",t[6])],A=!0)},p(e,[n]){if(t=e,28&n){let e;for(O=t[3],e=0;e<O.length;e+=1){const s=Na(t,O,e);M[e]?(M[e].p(s,n),F(M[e],1)):(M[e]=Va(s),M[e].c(),F(M[e],1),M[e].m(l,null))}for(q(),e=O.length;e<M.length;e+=1)E(e);L()}(!k||4&n&&C!==(C=-1===t[2].indexOf(!0)))&&(b.disabled=C)},i(t){if(!k){for(let t=0;t<O.length;t+=1)F(M[t]);k=!0}},o(t){M=M.filter(Boolean);for(let t=0;t<M.length;t+=1)j(M[t]);k=!1},d(t){t&&d(e),t&&d(n),t&&d(r),p(M,t),A=!1,s(S)}}}function qa(t,e,n){let s,{cancel:i}=e,{validate:r}=e;const o=Object.keys(tt).filter((t=>"_"!==t)),a=t=>{n(2,s=Array(o.length).fill(!1)),n(2,s[t]=!0,s)};return t.$$set=t=>{"cancel"in t&&n(0,i=t.cancel),"validate"in t&&n(1,r=t.validate)},n(2,s=Array(o.length).fill(!1)),[i,r,s,o,a,t=>a(t),()=>r(o[s.indexOf(!0)])]}class La extends G{constructor(t){super(),X(this,t,qa,$a,r,{cancel:0,validate:1})}}function Fa(t,e,n){const s=t.slice();return s[14]=e[n],s[16]=n,s}function ja(t,e,n){const s=t.slice();return s[17]=e[n],s[16]=n,s}function Ba(t,e,n){const s=t.slice();return s[19]=e[n],s[16]=n,s}function Wa(t){let e,n,s,i,r,o=t[1].score+"";return{c(){e=f("div"),n=f("span"),s=m(o),y(e,"class",i=c(t[1].vertical?"score vertical":"score")+" svelte-d4fgom"),y(e,"style",r=`--x:${t[1].score_location.x}; --y:${t[1].score_location.y}`)},m(t,i){h(t,e,i),u(e,n),u(n,s)},p(t,n){2&n&&o!==(o=t[1].score+"")&&w(s,o),2&n&&i!==(i=c(t[1].vertical?"score vertical":"score")+" svelte-d4fgom")&&y(e,"class",i),2&n&&r!==(r=`--x:${t[1].score_location.x}; --y:${t[1].score_location.y}`)&&y(e,"style",r)},d(t){t&&d(e)}}}function Ua(t){let e;return{c(){e=f("div"),e.textContent="Partie terminée!",y(e,"class","gameover svelte-d4fgom")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function za(t){let e,n,s,i,r;return{c(){e=f("div"),s=g(),i=f("div"),y(e,"class","highlight-row svelte-d4fgom"),y(e,"style",n=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`),y(i,"class","highlight-col svelte-d4fgom"),y(i,"style",r=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)},m(t,n){h(t,e,n),h(t,s,n),h(t,i,n)},p(t,s){9&s&&n!==(n=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)&&y(e,"style",n),9&s&&r!==(r=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)&&y(i,"style",r)},d(t){t&&d(e),t&&d(s),t&&d(i)}}}function Xa(e){let n,s;return n=new La({props:{cancel:e[6],validate:e[7]}}),{c(){B(n.$$.fragment)},m(t,e){W(n,t,e),s=!0},p:t,i(t){s||(F(n.$$.fragment,t),s=!0)},o(t){j(n.$$.fragment,t),s=!1},d(t){U(n,t)}}}function Ga(t){let e,n;return e=new Qt({props:{letter:t[19].letter,value:"",id:t[16],classes:"board temp",styles:`--x:${t[0].getBoardXY(t[19].index).x}; --y:${t[0].getBoardXY(t[19].index).y};`}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};4&n&&(s.letter=t[19].letter),5&n&&(s.styles=`--x:${t[0].getBoardXY(t[19].index).x}; --y:${t[0].getBoardXY(t[19].index).y};`),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Ya(e){let n,s,i=e[17]+"";return{c(){n=f("div"),s=m(i),y(n,"class","row-col-name svelte-d4fgom"),y(n,"style",`--x:-1.125; --y:${e[16]+.25};text-align: right;`)},m(t,e){h(t,n,e),u(n,s)},p:t,d(t){t&&d(n)}}}function Ha(e){let n,s,i,r=e[14]+"";return{c(){n=f("div"),s=m(r),i=g(),y(n,"class","row-col-name svelte-d4fgom"),y(n,"style",`--x:${e[16]}; --y:-0.5;text-align: center;`)},m(t,e){h(t,n,e),u(n,s),u(n,i)},p:t,d(t){t&&d(n)}}}function Za(t){let e,n,s,i,r,o,a,l,c,m=t[1].valid&&Wa(t),v=t[4]&&Ua(),w=t[3]&&t[3].board&&void 0!==t[3].index&&za(t),x=t[5]&&Xa(t),b=t[2],T=[];for(let e=0;e<b.length;e+=1)T[e]=Ga(Ba(t,b,e));const C=t=>j(T[t],1,1,(()=>{T[t]=null}));let k=t[8],A=[];for(let e=0;e<k.length;e+=1)A[e]=Ya(ja(t,k,e));let S=t[9],O=[];for(let e=0;e<S.length;e+=1)O[e]=Ha(Fa(t,S,e));return{c(){e=f("div"),m&&m.c(),n=g(),v&&v.c(),s=g(),w&&w.c(),i=g(),x&&x.c(),r=g();for(let t=0;t<T.length;t+=1)T[t].c();o=g();for(let t=0;t<A.length;t+=1)A[t].c();a=g();for(let t=0;t<O.length;t+=1)O[t].c();l=_(),y(e,"class","overlay svelte-d4fgom")},m(t,d){h(t,e,d),m&&m.m(e,null),u(e,n),v&&v.m(e,null),h(t,s,d),w&&w.m(t,d),h(t,i,d),x&&x.m(t,d),h(t,r,d);for(let e=0;e<T.length;e+=1)T[e].m(t,d);h(t,o,d);for(let e=0;e<A.length;e+=1)A[e].m(t,d);h(t,a,d);for(let e=0;e<O.length;e+=1)O[e].m(t,d);h(t,l,d),c=!0},p(t,[s]){if(t[1].valid?m?m.p(t,s):(m=Wa(t),m.c(),m.m(e,n)):m&&(m.d(1),m=null),t[4]?v||(v=Ua(),v.c(),v.m(e,null)):v&&(v.d(1),v=null),t[3]&&t[3].board&&void 0!==t[3].index?w?w.p(t,s):(w=za(t),w.c(),w.m(i.parentNode,i)):w&&(w.d(1),w=null),t[5]?x?(x.p(t,s),32&s&&F(x,1)):(x=Xa(t),x.c(),F(x,1),x.m(r.parentNode,r)):x&&(q(),j(x,1,1,(()=>{x=null})),L()),5&s){let e;for(b=t[2],e=0;e<b.length;e+=1){const n=Ba(t,b,e);T[e]?(T[e].p(n,s),F(T[e],1)):(T[e]=Ga(n),T[e].c(),F(T[e],1),T[e].m(o.parentNode,o))}for(q(),e=b.length;e<T.length;e+=1)C(e);L()}if(256&s){let e;for(k=t[8],e=0;e<k.length;e+=1){const n=ja(t,k,e);A[e]?A[e].p(n,s):(A[e]=Ya(n),A[e].c(),A[e].m(a.parentNode,a))}for(;e<A.length;e+=1)A[e].d(1);A.length=k.length}if(512&s){let e;for(S=t[9],e=0;e<S.length;e+=1){const n=Fa(t,S,e);O[e]?O[e].p(n,s):(O[e]=Ha(n),O[e].c(),O[e].m(l.parentNode,l))}for(;e<O.length;e+=1)O[e].d(1);O.length=S.length}},i(t){if(!c){F(x);for(let t=0;t<b.length;t+=1)F(T[t]);c=!0}},o(t){j(x),T=T.filter(Boolean);for(let t=0;t<T.length;t+=1)j(T[t]);c=!1},d(t){t&&d(e),m&&m.d(),v&&v.d(),t&&d(s),w&&w.d(t),t&&d(i),x&&x.d(t),t&&d(r),p(T,t),t&&d(o),p(A,t),t&&d(a),p(O,t),t&&d(l)}}}function Qa(t,e,n){let s,i,r,o,a,c,u,h;l(t,Z,(t=>n(11,u=t))),l(t,Q,(t=>n(12,h=t)));let{game:d}=e;const p={valid:!1,score:0,score_location:{x:-1,y:-1},vertical:!1},f=Array(15).fill(0).map(((t,e)=>e+1)),m=Object.keys(tt).filter((t=>"_"!==t)).filter(((t,e)=>e<15));return t.$$set=t=>{"game"in t&&n(0,d=t.game)},t.$$.update=()=>{3073&t.$$.dirty&&u&&(n(10,c=mt(u.letters)),Z.setEvaluation(c),c&&c.validity?n(1,s={valid:c.validity,score:c.score,score_location:d.getBoardXY(c.all_words[0].slice(-1)[0].index),vertical:!c.is_horizontal}):n(1,s={...p}),n(5,a=u.jocker_picker),n(4,o=u.game_over)),4096&t.$$.dirty&&h&&(n(2,i=h.temp_letters),n(3,r=h.hover_location))},n(1,s={...p}),n(2,i=[]),n(3,r=[]),n(4,o=!1),n(5,a=!1),n(10,c=null),[d,s,i,r,o,a,()=>{let t=u.jocker_picker_letter;Z.moveLetter(t.id,t.board,t.index),Z.setJokerPicker({},!1)},t=>{let e=u.jocker_picker_letter;Z.setJoker(e.id,t),Z.setJokerPicker({},!1)},f,m,c,u,h]}class Ja extends G{constructor(t){super(),X(this,t,Qa,Za,r,{game:0})}}function Ka(t,e,n){const s=t.slice();return s[20]=e[n],s}function tl(t,e,n){const s=t.slice();return s[20]=e[n],s}function el(t,e,n){const s=t.slice();return s[20]=e[n],s}function nl(t,e,n){const s=t.slice();return s[27]=e[n],s[28]=e,s[29]=n,s}function sl(t,e,n){const s=t.slice();return s[27]=e[n],s[30]=e,s[29]=n,s}function il(t){let e,n=t[30],s=t[29];const i=()=>t[11](e,n,s),r=()=>t[11](null,n,s);return{c(){e=f("div"),y(e,"class","board-cell svelte-18zu08n"),y(e,"style",`--x:${t[7](t[29]).x};--y:${t[7](t[29]).y};`),y(e,"cid",t[29])},m(t,n){h(t,e,n),i()},p(e,o){n===(t=e)[30]&&s===t[29]||(r(),n=t[30],s=t[29],i())},d(t){t&&d(e),r()}}}function rl(t){let e,n,s,i=t[28],r=t[29];const o=()=>t[12](e,i,r),a=()=>t[12](null,i,r);return{c(){e=f("div"),n=f("div"),s=g(),y(n,"class","rack-decoration svelte-18zu08n"),y(e,"class","rack-cell svelte-18zu08n"),y(e,"style",`--pos:${t[8](t[29])};`),y(e,"cid",t[29])},m(t,i){h(t,e,i),u(e,n),u(e,s),o()},p(e,n){i===(t=e)[28]&&r===t[29]||(a(),i=t[28],r=t[29],o())},d(t){t&&d(e),a()}}}function ol(t){let e,n,s,i,r,o,a=t[6].letters.filter(hl),l=[];for(let e=0;e<a.length;e+=1)l[e]=al(el(t,a,e));const c=t=>j(l[t],1,1,(()=>{l[t]=null}));let u=t[6].letters.filter(dl),m=[];for(let e=0;e<u.length;e+=1)m[e]=ll(tl(t,u,e));const _=t=>j(m[t],1,1,(()=>{m[t]=null}));let v=t[6].letters.filter(pl),w=[];for(let e=0;e<v.length;e+=1)w[e]=cl(Ka(t,v,e));const x=t=>j(w[t],1,1,(()=>{w[t]=null}));return{c(){e=f("div");for(let t=0;t<l.length;t+=1)l[t].c();n=g(),s=f("div");for(let t=0;t<m.length;t+=1)m[t].c();i=g(),r=f("div");for(let t=0;t<w.length;t+=1)w[t].c();y(e,"class","board-letters-free"),y(s,"class","board-letters-fixed"),y(r,"class","rack-letters")},m(t,a){h(t,e,a);for(let t=0;t<l.length;t+=1)l[t].m(e,null);h(t,n,a),h(t,s,a);for(let t=0;t<m.length;t+=1)m[t].m(s,null);h(t,i,a),h(t,r,a);for(let t=0;t<w.length;t+=1)w[t].m(r,null);o=!0},p(t,n){if(576&n){let s;for(a=t[6].letters.filter(hl),s=0;s<a.length;s+=1){const i=el(t,a,s);l[s]?(l[s].p(i,n),F(l[s],1)):(l[s]=al(i),l[s].c(),F(l[s],1),l[s].m(e,null))}for(q(),s=a.length;s<l.length;s+=1)c(s);L()}if(576&n){let e;for(u=t[6].letters.filter(dl),e=0;e<u.length;e+=1){const i=tl(t,u,e);m[e]?(m[e].p(i,n),F(m[e],1)):(m[e]=ll(i),m[e].c(),F(m[e],1),m[e].m(s,null))}for(q(),e=u.length;e<m.length;e+=1)_(e);L()}if(576&n){let e;for(v=t[6].letters.filter(pl),e=0;e<v.length;e+=1){const s=Ka(t,v,e);w[e]?(w[e].p(s,n),F(w[e],1)):(w[e]=cl(s),w[e].c(),F(w[e],1),w[e].m(r,null))}for(q(),e=v.length;e<w.length;e+=1)x(e);L()}},i(t){if(!o){for(let t=0;t<a.length;t+=1)F(l[t]);for(let t=0;t<u.length;t+=1)F(m[t]);for(let t=0;t<v.length;t+=1)F(w[t]);o=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)j(l[t]);m=m.filter(Boolean);for(let t=0;t<m.length;t+=1)j(m[t]);w=w.filter(Boolean);for(let t=0;t<w.length;t+=1)j(w[t]);o=!1},d(t){t&&d(e),p(l,t),t&&d(n),t&&d(s),p(m,t),t&&d(i),t&&d(r),p(w,t)}}}function al(t){let e,n;return e=new Pa({props:{game:t[9],letter:t[20]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[20]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function ll(t){let e,n;return e=new Pa({props:{game:t[9],letter:t[20]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[20]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function cl(t){let e,n;return e=new Pa({props:{game:t[9],letter:t[20]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[20]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function ul(t){let e,n,s,i,r,o,a,l,c,m;i=new Ja({props:{game:t[9]}});let _=t[4],v=[];for(let e=0;e<_.length;e+=1)v[e]=il(sl(t,_,e));let w=t[5],x=[];for(let e=0;e<w.length;e+=1)x[e]=rl(nl(t,w,e));let b=t[6]&&ol(t);return{c(){e=f("div"),n=f("div"),s=f("div"),B(i.$$.fragment),r=g();for(let t=0;t<v.length;t+=1)v[t].c();o=g(),a=f("div");for(let t=0;t<x.length;t+=1)x[t].c();l=g(),b&&b.c(),y(s,"class","board svelte-18zu08n"),y(a,"class","rack svelte-18zu08n"),y(a,"id","rack"),y(n,"class","game svelte-18zu08n"),y(e,"class","container svelte-18zu08n"),y(e,"style",c=`--REF-SIZE: ${15*t[0]/16}px;--S: ${t[0]/16}px;`)},m(c,d){h(c,e,d),u(e,n),u(n,s),W(i,s,null),u(s,r);for(let t=0;t<v.length;t+=1)v[t].m(s,null);u(n,o),u(n,a);for(let t=0;t<x.length;t+=1)x[t].m(a,null);t[13](a),u(n,l),b&&b.m(n,null),t[14](n),t[15](e),m=!0},p(t,[i]){if(144&i){let e;for(_=t[4],e=0;e<_.length;e+=1){const n=sl(t,_,e);v[e]?v[e].p(n,i):(v[e]=il(n),v[e].c(),v[e].m(s,null))}for(;e<v.length;e+=1)v[e].d(1);v.length=_.length}if(288&i){let e;for(w=t[5],e=0;e<w.length;e+=1){const n=nl(t,w,e);x[e]?x[e].p(n,i):(x[e]=rl(n),x[e].c(),x[e].m(a,null))}for(;e<x.length;e+=1)x[e].d(1);x.length=w.length}t[6]?b?(b.p(t,i),64&i&&F(b,1)):(b=ol(t),b.c(),F(b,1),b.m(n,null)):b&&(q(),j(b,1,1,(()=>{b=null})),L()),(!m||1&i&&c!==(c=`--REF-SIZE: ${15*t[0]/16}px;--S: ${t[0]/16}px;`))&&y(e,"style",c)},i(t){m||(F(i.$$.fragment,t),F(b),m=!0)},o(t){j(i.$$.fragment,t),j(b),m=!1},d(n){n&&d(e),U(i),p(v,n),p(x,n),t[13](null),b&&b.d(),t[14](null),t[15](null)}}}const hl=t=>t.board&&t.free,dl=t=>t.board&&!t.free,pl=t=>!t.board;function fl(t,e,n){let s;l(t,Z,(t=>n(6,s=t)));let i,r,o,{width:a}=e,{updateSize:c}=e;var u;u=()=>{c(),s&&s.image_preview_needed&&(Z.setNeedForNewImagePreview(!1),console.time("dom-to-image"),qt.toPng(r,{filter:t=>!0}).then((t=>{console.timeEnd("dom-to-image"),Nt(s.id,t)})))},C().$$.after_update.push(u);let h=Array(225).fill(0),d=Array(7).fill(0);const p=t=>{const e=Math.floor(t/15);return{x:e,y:t-15*e}},f=t=>t,m=t=>{const e=t.clientX,n=t.clientY,s=i.getBoundingClientRect();return{x:e-s.x,y:n-s.y}},g=(t,e)=>!(e.x<t.x||e.x>t.x+t.width||e.y<t.y||e.y>t.y+t.height),_={getLocation:t=>{const e=i.getBoundingClientRect(),n=m(t),s=t=>{const s=t.filter((t=>{const s=(i=t.getBoundingClientRect(),r=e,i.x=i.x-r.x,i.y=i.y-r.y,i);var i,r;return g(s,n)}))[0];if(s)return parseInt(s.getAttribute("cid"))},r=s(h),o=s(d);return{board:void 0!==r,index:void 0!==r?r:o}},getBoardXY:p,getRackPos:f,getXY:m,isWithinRect:g,isWithinGame:t=>g(i.getBoundingClientRect(),t)};return t.$$set=t=>{"width"in t&&n(0,a=t.width),"updateSize"in t&&n(10,c=t.updateSize)},[a,i,r,o,h,d,s,p,f,_,c,function(t,e,s){A[t?"unshift":"push"]((()=>{e[s]=t,n(4,h)}))},function(t,e,s){A[t?"unshift":"push"]((()=>{e[s]=t,n(5,d)}))},function(t){A[t?"unshift":"push"]((()=>{o=t,n(3,o)}))},function(t){A[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},function(t){A[t?"unshift":"push"]((()=>{r=t,n(2,r)}))}]}class ml extends G{constructor(t){super(),X(this,t,fl,ul,r,{width:0,updateSize:10})}}function gl(t,e,n){const s=t.slice();return s[12]=e[n],s[14]=n,s}function _l(t){let e,n,s,i,r=`Maître MoLangeur avait trouvé ${t[1].length} mots et positions valides: `,o=t[1],a=[];for(let e=0;e<o.length;e+=1)a[e]=wl(gl(t,o,e));return{c(){e=f("div"),n=m(r),s=g(),i=f("div");for(let t=0;t<a.length;t+=1)a[t].c();y(e,"class","title"),y(i,"class","best-words-list svelte-103om3j")},m(r,o){h(r,e,o),u(e,n),h(r,s,o),h(r,i,o);for(let t=0;t<a.length;t+=1)a[t].m(i,null);t[10](i)},p(t,e){if(2&e&&r!==(r=`Maître MoLangeur avait trouvé ${t[1].length} mots et positions valides: `)&&w(n,r),118&e){let n;for(o=t[1],n=0;n<o.length;n+=1){const s=gl(t,o,n);a[n]?a[n].p(s,e):(a[n]=wl(s),a[n].c(),a[n].m(i,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}},d(n){n&&d(e),n&&d(s),n&&d(i),p(a,n),t[10](null)}}}function vl(t){let e;return{c(){e=f("div"),y(e,"class","pos-h svelte-103om3j")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function yl(t){let e;return{c(){e=f("div"),y(e,"class","pos-v svelte-103om3j")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function wl(t){let e,n,i,r,o,a,l,c,p,_,x,b,T,C,k=t[4](t[12].index)+"",A=t[12].word+"",S=t[12].pts+" points";function O(t,e){return"V"===t[12].dir?yl:vl}let M=O(t),E=M(t);function D(){return t[8](t[14])}function I(){return t[9](t[14])}return{c(){e=f("div"),E.c(),n=g(),i=f("span"),r=m(k),o=g(),a=f("span"),l=m(A),c=g(),p=f("span"),_=m(S),x=g(),y(i,"class","crd"),y(a,"class","wrd svelte-103om3j"),y(p,"class","pts svelte-103om3j"),y(e,"class","word svelte-103om3j"),y(e,"tabindex","0"),y(e,"selected",b=t[14]===t[2]?"true":"false")},m(s,d){h(s,e,d),E.m(e,null),u(e,n),u(e,i),u(i,r),u(e,o),u(e,a),u(a,l),u(e,c),u(e,p),u(p,_),u(e,x),T||(C=[v(e,"mouseover",D),v(e,"mouseout",t[6]),v(e,"focus",I),v(e,"blur",t[6])],T=!0)},p(s,i){M!==(M=O(t=s))&&(E.d(1),E=M(t),E&&(E.c(),E.m(e,n))),2&i&&k!==(k=t[4](t[12].index)+"")&&w(r,k),2&i&&A!==(A=t[12].word+"")&&w(l,A),2&i&&S!==(S=t[12].pts+" points")&&w(_,S),4&i&&b!==(b=t[14]===t[2]?"true":"false")&&y(e,"selected",b)},d(t){t&&d(e),E.d(),T=!1,s(C)}}}function xl(e){let n,s=e[3]&&_l(e);return{c(){n=f("div"),s&&s.c(),y(n,"class","container svelte-103om3j")},m(t,e){h(t,n,e),s&&s.m(n,null)},p(t,[e]){t[3]?s?s.p(t,e):(s=_l(t),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:t,o:t,d(t){t&&d(n),s&&s.d()}}}function bl(t,e,n){let s,i,r,o,a;l(t,Z,(t=>n(7,o=t)));const c=t=>{const e=s[t],r=e.word.split(""),o=((t,e,n=!0)=>{let s=J(t),i=n?1:0,r=n?0:1;return Array(e).fill(t).map(((t,e)=>{return n=s.row+e*i,15*(s.col+e*r)+n;var n}))})(e.index,r.length,"V"===e.dir);Q.setTempLetters(r.map(((t,e)=>({index:o[e],letter:t})))),n(2,i=t)};return t.$$.update=()=>{128&t.$$.dirty&&o&&(n(1,s=o.molangeur.current_words),n(3,r=null!==o.molangeur.current_words))},n(1,s=[]),n(2,i=-1),n(3,r=!0),[a,s,i,r,t=>{const e=Array(15).fill(0).map(((t,e)=>e+1)),n=Object.keys(tt).filter((t=>"_"!==t)).filter(((t,e)=>e<15)),s=J(t);return e[s.row]+n[s.col]},c,()=>{Q.setTempLetters([]),n(2,i=-1)},o,t=>c(t),t=>c(t),function(t){A[t?"unshift":"push"]((()=>{a=t,n(0,a)}))}]}class Tl extends G{constructor(t){super(),X(this,t,bl,xl,r,{})}}function Cl(e){let n,i,r,o,a,l,p,m;return{c(){n=f("div"),i=f("div"),r=f("input"),a=g(),l=f("button"),l.textContent="x",y(r,"type","text"),y(r,"class",o=c(e[1])+" svelte-1hda9hb"),y(r,"placeholder","Dictionnaire"),y(r,"onkeypress","return (event.key.length === 1 && /[A-Za-zéèëêîïûôâàç]/.test(event.key))"),y(l,"class","reset-input svelte-1hda9hb"),y(i,"class","input-div svelte-1hda9hb"),y(n,"class","container svelte-1hda9hb")},m(t,s){h(t,n,s),u(n,i),u(i,r),x(r,e[2]),u(i,a),u(i,l),p||(m=[v(r,"input",e[4]),v(r,"keyup",e[3]),v(l,"click",e[5])],p=!0)},p(t,[e]){2&e&&o!==(o=c(t[1])+" svelte-1hda9hb")&&y(r,"class",o),4&e&&r.value!==t[2]&&x(r,t[2])},i:t,o:t,d(t){t&&d(n),p=!1,s(m)}}}function kl(t,e,n){let s=null,i="";let r="";return t.$$.update=()=>{3&t.$$.dirty&&(n(1,r=null===s||s?s?"valid":"":"invalid"),console.log(s),console.log(r))},[s,r,i,()=>{let t;i.length>1?(t=i.normalize("NFD").replace(/\p{Diacritic}/gu,"").toUpperCase(),n(0,s=pt(t))):n(0,s=null)},function(){i=this.value,n(2,i)},()=>{n(2,i=""),n(0,s=null)}]}class Al extends G{constructor(t){super(),X(this,t,kl,Cl,r,{})}}function Sl(e){let n,s,i;return{c(){n=f("button"),n.textContent="Soumettre",n.disabled=!0,y(n,"class","svelte-1c3yhf0")},m(t,r){h(t,n,r),s||(i=v(n,"click",e[1]),s=!0)},p:t,d(t){t&&d(n),s=!1,i()}}}function Ol(e){let n,s,i;return{c(){n=f("button"),n.textContent="Soumettre",y(n,"class","svelte-1c3yhf0")},m(t,r){h(t,n,r),s||(i=v(n,"click",e[1]),s=!0)},p:t,d(t){t&&d(n),s=!1,i()}}}function Ml(t){let e,n,s,i,r,o,a,l;function c(t,e){return t[0]?Ol:Sl}n=new Al({});let p=c(t),m=p(t);return{c(){e=f("div"),B(n.$$.fragment),s=g(),i=f("button"),i.textContent="Ramener les lettres",r=g(),m.c(),y(i,"class","svelte-1c3yhf0"),y(e,"class","action svelte-1c3yhf0")},m(t,c){h(t,e,c),W(n,e,null),u(e,s),u(e,i),u(e,r),m.m(e,null),o=!0,a||(l=v(i,"click",Mt),a=!0)},p(t,[n]){p===(p=c(t))&&m?m.p(t,n):(m.d(1),m=p(t),m&&(m.c(),m.m(e,null)))},i(t){o||(F(n.$$.fragment,t),o=!0)},o(t){j(n.$$.fragment,t),o=!1},d(t){t&&d(e),U(n),m.d(),a=!1,l()}}}function El(t,e,n){let s;l(t,Z,(t=>n(2,s=t)));let i=!1;return t.$$.update=()=>{4&t.$$.dirty&&s&&n(0,i=s.evaluation&&s.evaluation.validity)},[i,()=>{Pt(s.id,s.player_id)},s]}class Dl extends G{constructor(t){super(),X(this,t,El,Ml,r,{})}}function Il(t){let e,n,s,i,r,o,a,l,c,p,g,_=(t[7]/t[8]*100).toFixed(1)+"%";return{c(){e=f("div"),n=m("Score: "),s=f("span"),i=m(t[7]),r=m(" / "),o=f("span"),a=m(t[8]),l=m(" ("),c=f("span"),p=m(_),g=m(")"),y(s,"class","value svelte-134xakp"),y(o,"class","value svelte-134xakp"),y(c,"class","value svelte-134xakp")},m(t,d){h(t,e,d),u(e,n),u(e,s),u(s,i),u(e,r),u(e,o),u(o,a),u(e,l),u(e,c),u(c,p),u(e,g)},p(t,e){128&e&&w(i,t[7]),256&e&&w(a,t[8]),384&e&&_!==(_=(t[7]/t[8]*100).toFixed(1)+"%")&&w(p,_)},d(t){t&&d(e)}}}function Rl(t){let e,n,s,i,r=t[10].toFixed(1)+"";return{c(){e=f("div"),n=m("Classement moyen: "),s=f("span"),i=m(r),y(s,"class","value svelte-134xakp")},m(t,r){h(t,e,r),u(e,n),u(e,s),u(s,i)},p(t,e){1024&e&&r!==(r=t[10].toFixed(1)+"")&&w(i,r)},d(t){t&&d(e)}}}function Pl(t){let e,n,s,i,r,o,a,l,c,p,g;function _(t,e){return 1===t[6]?Vl:Nl}let v=_(t),x=v(t);return{c(){e=f("div"),n=m("Précédement, tu as joué "),s=f("span"),i=m(t[3]),r=m(" en position "),o=f("span"),a=m(t[2]),l=m(" pour un score de "),c=f("span"),p=m(t[4]),g=m(", \r\n                "),x.c(),y(s,"class","value svelte-134xakp"),y(o,"class","value svelte-134xakp"),y(c,"class","value svelte-134xakp"),y(e,"class","last-game svelte-134xakp")},m(t,d){h(t,e,d),u(e,n),u(e,s),u(s,i),u(e,r),u(e,o),u(o,a),u(e,l),u(e,c),u(c,p),u(e,g),x.m(e,null)},p(t,n){8&n&&w(i,t[3]),4&n&&w(a,t[2]),16&n&&w(p,t[4]),v===(v=_(t))&&x?x.p(t,n):(x.d(1),x=v(t),x&&(x.c(),x.m(e,null)))},d(t){t&&d(e),x.d()}}}function Nl(t){let e,n,s,i,r,o,a,l=t[14](t[6])+"";function c(t,e){return 1===t[5]?ql:$l}let p=c(t),g=p(t);return{c(){e=m("le "),n=f("span"),s=m(t[6]),i=f("sup"),r=m(l),o=m(" meilleur score \r\n                "),g.c(),a=_(),y(n,"class","value svelte-134xakp")},m(t,l){h(t,e,l),h(t,n,l),u(n,s),u(n,i),u(i,r),h(t,o,l),g.m(t,l),h(t,a,l)},p(t,e){64&e&&w(s,t[6]),64&e&&l!==(l=t[14](t[6])+"")&&w(r,l),p===(p=c(t))&&g?g.p(t,e):(g.d(1),g=p(t),g&&(g.c(),g.m(a.parentNode,a)))},d(t){t&&d(e),t&&d(n),t&&d(o),g.d(t),t&&d(a)}}}function Vl(e){let n;return{c(){n=m("le meilleur score possible.")},m(t,e){h(t,n,e)},p:t,d(t){t&&d(n)}}}function $l(t){let e,n,s,i;return{c(){e=m("("),n=f("span"),s=m(t[5]),i=m(" mots étaient meilleurs)"),y(n,"class","value svelte-134xakp")},m(t,r){h(t,e,r),h(t,n,r),u(n,s),h(t,i,r)},p(t,e){32&e&&w(s,t[5])},d(t){t&&d(e),t&&d(n),t&&d(i)}}}function ql(t){let e,n,s,i;return{c(){e=m("(seul "),n=f("span"),s=m(t[5]),i=m(" mot était meilleur)"),y(n,"class","value svelte-134xakp")},m(t,r){h(t,e,r),h(t,n,r),u(n,s),h(t,i,r)},p(t,e){32&e&&w(s,t[5])},d(t){t&&d(e),t&&d(n),t&&d(i)}}}function Ll(e){let n;return{c(){var t,e,s;n=f("div"),n.textContent="...",t="visibility",e="hidden",n.style.setProperty(t,e,s?"important":"")},m(t,e){h(t,n,e)},p:t,d(t){t&&d(n)}}}function Fl(t){let e,n,s,i,r,o,a=t[0]&&jl(t);return{c(){e=f("div"),a&&a.c(),n=g(),s=f("div"),i=m("Lettres restantes: "),r=f("span"),o=m(t[9]),y(r,"class","value svelte-134xakp")},m(t,l){h(t,e,l),a&&a.m(e,null),h(t,n,l),h(t,s,l),u(s,i),u(s,r),u(r,o)},p(t,n){t[0]?a?a.p(t,n):(a=jl(t),a.c(),a.m(e,null)):a&&(a.d(1),a=null),512&n&&w(o,t[9])},d(t){t&&d(e),a&&a.d(),t&&d(n),t&&d(s)}}}function jl(t){let e,n,s;return{c(){e=m("Score max au prochain coup: "),n=f("span"),s=m(t[0]),y(n,"class","value svelte-134xakp")},m(t,i){h(t,e,i),h(t,n,i),u(n,s)},p(t,e){1&e&&w(s,t[0])},d(t){t&&d(e),t&&d(n)}}}function Bl(e){let n,s,i,r,o,a,l,c,p,_,v,x,b,T,C=e[11]+" "+e[12],k=e[8]>0&&Il(e),A=e[10]&&Rl(e),S=null!=e[4]&&null!==e[6]&&null!==e[5]&&Pl(e);function O(t,e){return t[1]?Ll:Fl}let M=O(e),E=M(e);return{c(){n=f("div"),s=f("div"),i=f("div"),k&&k.c(),r=g(),A&&A.c(),o=g(),S&&S.c(),a=g(),l=f("div"),E.c(),c=g(),p=f("div"),_=f("div"),v=m(C),x=g(),b=f("div"),T=m(e[13]),y(i,"class","summary-games svelte-134xakp"),y(s,"class","score svelte-134xakp"),y(l,"class","state svelte-134xakp"),y(_,"class","word svelte-134xakp"),y(b,"class","action svelte-134xakp"),y(p,"class","communication svelte-134xakp"),y(n,"class","container svelte-134xakp")},m(t,e){h(t,n,e),u(n,s),u(s,i),k&&k.m(i,null),u(i,r),A&&A.m(i,null),u(s,o),S&&S.m(s,null),u(n,a),u(n,l),E.m(l,null),u(n,c),u(n,p),u(p,_),u(_,v),u(p,x),u(p,b),u(b,T)},p(t,[e]){t[8]>0?k?k.p(t,e):(k=Il(t),k.c(),k.m(i,r)):k&&(k.d(1),k=null),t[10]?A?A.p(t,e):(A=Rl(t),A.c(),A.m(i,null)):A&&(A.d(1),A=null),null!=t[4]&&null!==t[6]&&null!==t[5]?S?S.p(t,e):(S=Pl(t),S.c(),S.m(s,null)):S&&(S.d(1),S=null),M===(M=O(t))&&E?E.p(t,e):(E.d(1),E=M(t),E&&(E.c(),E.m(l,null))),6144&e&&C!==(C=t[11]+" "+t[12])&&w(v,C),8192&e&&w(T,t[13])},i:t,o:t,d(t){t&&d(n),k&&k.d(),A&&A.d(),S&&S.d(),E.d()}}}function Wl(t,e,n){let s,i,r,o,a,c,u,h,d,p,f,m,g,_,v,y;l(t,Z,(t=>n(16,y=t)));let w=["Le meilleur score possible! Chapeau bas!","Le meilleur score possible! Chapeau bas!","Le meilleur score possible! Chapeau bas!","Le meilleur score possible! Félicitation!","Le meilleur score possible! Félicitation!","Le meilleur score possible! Bravo!","Le meilleur score possible! Bravo!","Le meilleur score possible! Bravo!","Le meilleur score possible! Excellent!","Le meilleur score possible! Parfait!","Le meilleur score possible! Nickel!","Le meilleur score possible! Bien joué!","Le meilleur score possible! Bien joué!","Le meilleur score possible! Bien joué!","Le meilleur score possible! Impressionnant!","Le meilleur score possible! Impressionnant!"];return t.$$.update=()=>{if(98307&t.$$.dirty&&y){n(15,c=y.player_id);let t=y.players.filter((t=>t.id===c))[0],e=y.molangeur;if(n(7,u=t?t.score:0),n(8,h=t?t.molangeur:0),n(0,d=e&&e.next_score?e.next_score:null),n(9,p=y.letters_left),y.history&&y.history.length>0){let t=y.history.map((t=>t.rank));n(10,f=t.reduce(((t,e)=>t+e))/t.length);let e=y.history.slice(-1)[0];n(6,a=e.rank),n(4,r=e.evaluation.score),n(3,i=e.evaluation.words[0]),e.molangeur,n(5,o=void 0!==e.n_better_words?e.n_better_words:null),n(2,s=(t=>{const e=Array(15).fill(0).map(((t,e)=>e+1)),n=Object.keys(tt).filter((t=>"_"!==t)).filter(((t,e)=>e<15)),s=J(t);return e[s.row]+n[s.col]})(e.evaluation.all_words[0][0].index))}if(n(12,g=""),n(11,m=""),n(1,v=y.game_over),v)n(13,_="Partie terminée");else if(0===y.letters.filter((t=>t.board&&t.free)).length)n(13,_="Pose des lettres sur la grille pour former un mot valide.");else if(y.evaluation)if(y.evaluation.validity)y.evaluation.validity&&(null!==d&&d===y.evaluation.score&&n(12,g=w[Math.floor(Math.random()*w.length)]),n(11,m=`Le mot ${y.evaluation.words[0]} te rapporterai ${y.evaluation.score} points.`),n(13,_='Clique sur "Soumettre" pour le jouer'));else{let t=y.evaluation.words.filter(((t,e)=>!y.evaluation.validities[e]));1===t.length?n(11,m=`Le mot ${t[0]} n'est pas valide.`):n(11,m=`Les mots ${t.slice(0,-1).reduce(((t,e)=>t+", "+e))} et ${t.slice(-1)} ne sont pas valides.`),n(13,_="")}else n(13,_=""),n(11,m="Le positionnement des lettres sur la grille n'est pas valide.")}},n(2,s=null),n(3,i=null),n(4,r=null),n(5,o=null),n(6,a=null),n(15,c=null),n(7,u=0),n(8,h=0),n(0,d=null),n(9,p=0),n(10,f=null),n(11,m=""),n(12,g=""),n(13,_=""),n(1,v=!1),[d,v,s,i,r,o,a,u,h,p,f,m,g,_,t=>1===t?"re":t>1?"ème":void 0,c,y]}class Ul extends G{constructor(t){super(),X(this,t,Wl,Bl,r,{})}}function zl(t){let e,n,s,i,r,o,a,l,c,p,m,_,v,w,x,b;return s=new Ul({}),a=new ml({props:{width:t[0],updateSize:t[8]}}),p=new Dl({}),v=new Tl({}),{c(){e=f("div"),n=f("div"),B(s.$$.fragment),i=g(),r=f("div"),o=f("div"),B(a.$$.fragment),l=g(),c=f("div"),B(p.$$.fragment),m=g(),_=f("div"),B(v.$$.fragment),y(n,"class","info svelte-qqw57k"),y(o,"class","game svelte-qqw57k"),y(c,"class","btns svelte-qqw57k"),y(r,"class","game-btns svelte-qqw57k"),y(_,"class","mstm svelte-qqw57k"),y(_,"style",w=`--h_molangeur: ${t[6]}px`),y(e,"class","container svelte-qqw57k"),y(e,"style",x=`--padd: ${t[7]}px;`)},m(d,f){h(d,e,f),u(e,n),W(s,n,null),t[10](n),u(e,i),u(e,r),u(r,o),W(a,o,null),t[11](o),u(r,l),u(r,c),W(p,c,null),t[12](c),u(e,m),u(e,_),W(v,_,null),t[13](_),t[14](e),b=!0},p(t,[n]){const s={};1&n&&(s.width=t[0]),a.$set(s),(!b||64&n&&w!==(w=`--h_molangeur: ${t[6]}px`))&&y(_,"style",w),(!b||128&n&&x!==(x=`--padd: ${t[7]}px;`))&&y(e,"style",x)},i(t){b||(F(s.$$.fragment,t),F(a.$$.fragment,t),F(p.$$.fragment,t),F(v.$$.fragment,t),b=!0)},o(t){j(s.$$.fragment,t),j(a.$$.fragment,t),j(p.$$.fragment,t),j(v.$$.fragment,t),b=!1},d(n){n&&d(e),U(s),t[10](null),U(a),t[11](null),U(p),t[12](null),U(v),t[13](null),t[14](null)}}}function Xl(t,e,n){let s,i,r,o,a,l,c,{id:u}=e,h=500;const d=()=>{let t=r.parentElement.getBoundingClientRect(),e=a.getBoundingClientRect(),i=l.getBoundingClientRect(),o=15*(t.height-(e.height+i.height))/16,c=t.width;n(6,h=500),document.body.getBoundingClientRect().width>992&&(o=15*(t.height-i.height)/16,c=t.width-300,n(6,h=t.height-e.height)),n(0,s=Math.min(o,c)),n(0,s-=s/15),n(0,s=s*window.devicePixelRatio<700?700/window.devicePixelRatio:s)};let p=null;const f=()=>{d(),p&&clearTimeout(p),p=setTimeout(d,500)};var m;return m=()=>{window.addEventListener("resize",f),r.parentElement.scrollTo(0,0),console.log(r),console.log(r.parentElement),console.log(r.parentElement.parentElement),f()},C().$$.on_mount.push(m),function(t){C().$$.on_destroy.push(t)}((()=>{window.removeEventListener("resize",f)})),Rt(u),t.$$set=t=>{"id"in t&&n(9,u=t.id)},t.$$.update=()=>{1&t.$$.dirty&&n(7,i=s/15/2)},n(0,s=500),[s,r,o,a,l,c,h,i,f,u,function(t){A[t?"unshift":"push"]((()=>{a=t,n(3,a)}))},function(t){A[t?"unshift":"push"]((()=>{o=t,n(2,o)}))},function(t){A[t?"unshift":"push"]((()=>{l=t,n(4,l)}))},function(t){A[t?"unshift":"push"]((()=>{c=t,n(5,c)}))},function(t){A[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Gl extends G{constructor(t){super(),X(this,t,Xl,zl,r,{id:9})}}function Yl(e){let n,i,r,o,a,l,c,p,_,x,b,T,C,k,A,S,O,M,E,D,I,R,P,N,V,$,q,L,F,j,B,W,U,z,X,G,Y,H,Z,Q=e[4](e[0].create_date)+"",J=e[5](e[0].create_date)+"",K=e[4](e[0].update_date)+"",tt=e[5](e[0].update_date)+"",et=e[0].players[0].score+"",nt=e[0].players[0].molangeur+"";return{c(){n=f("div"),i=f("div"),r=f("div"),o=f("div"),a=m("Partie créée le "),l=f("span"),c=m(Q),p=m("\r\n           à "),_=f("span"),x=m(J),b=g(),T=f("div"),C=m("Dernière modification le "),k=f("span"),A=m(K),S=m("\r\n                à "),O=f("span"),M=m(tt),E=g(),D=f("div"),I=f("button"),I.textContent="Supprimer",R=g(),P=f("button"),P.textContent="Télécharger",N=g(),V=f("div"),$=m("Score: "),q=f("span"),L=m(et),F=g(),j=f("div"),B=m("Score de Maître MoLangeur: "),W=f("span"),U=m(nt),z=g(),X=f("div"),G=f("img"),y(l,"class","bold svelte-kn0rxb"),y(_,"class","bold svelte-kn0rxb"),y(k,"class","bold svelte-kn0rxb"),y(O,"class","bold svelte-kn0rxb"),y(r,"class","main"),y(I,"class","simple"),y(P,"class","simple"),y(D,"class","secondary svelte-kn0rxb"),y(i,"class","title svelte-kn0rxb"),y(q,"class","bold svelte-kn0rxb"),y(W,"class","bold svelte-kn0rxb"),G.src!==(Y=e[0].img)&&y(G,"src",Y),y(G,"alt",""),y(G,"class","svelte-kn0rxb"),y(X,"class","img svelte-kn0rxb"),y(n,"class","game svelte-kn0rxb")},m(t,s){h(t,n,s),u(n,i),u(i,r),u(r,o),u(o,a),u(o,l),u(l,c),u(o,p),u(o,_),u(_,x),u(r,b),u(r,T),u(T,C),u(T,k),u(k,A),u(T,S),u(T,O),u(O,M),u(i,E),u(i,D),u(D,I),u(D,R),u(D,P),u(n,N),u(n,V),u(V,$),u(V,q),u(q,L),u(n,F),u(n,j),u(j,B),u(j,W),u(W,U),u(n,z),u(n,X),u(X,G),H||(Z=[v(I,"click",e[2]),v(P,"click",e[3]),v(n,"click",e[7])],H=!0)},p(t,[e]){1&e&&Q!==(Q=t[4](t[0].create_date)+"")&&w(c,Q),1&e&&J!==(J=t[5](t[0].create_date)+"")&&w(x,J),1&e&&K!==(K=t[4](t[0].update_date)+"")&&w(A,K),1&e&&tt!==(tt=t[5](t[0].update_date)+"")&&w(M,tt),1&e&&et!==(et=t[0].players[0].score+"")&&w(L,et),1&e&&nt!==(nt=t[0].players[0].molangeur+"")&&w(U,nt),1&e&&G.src!==(Y=t[0].img)&&y(G,"src",Y)},i:t,o:t,d(t){t&&d(n),H=!1,s(Z)}}}function Hl(t,e,n){let{game:s}=e,{onclick:i}=e,{ondelete:r}=e;const o=t=>new Date(t).toLocaleDateString(),a=t=>{let e=new Date(t);return e=e.toLocaleTimeString().split(":"),e[0]+":"+e[1]};return t.$$set=t=>{"game"in t&&n(0,s=t.game),"onclick"in t&&n(1,i=t.onclick),"ondelete"in t&&n(6,r=t.ondelete)},[s,i,t=>{t.preventDefault(),t.stopPropagation();confirm("Etes vous sûr de vouloir supprimer la partie?")&&r(s.id)},t=>{t.preventDefault(),t.stopPropagation();let e=o(s.create_date)+"t"+a(s.create_date)+"_"+o(s.update_date)+"t"+a(s.update_date);e=e.replace(/\//g,""),e=e.replace(/\:/g,"");const n=new File([JSON.stringify(s)],e,{type:"text/plain"}),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=n.name+".molangeur",i.click()},o,a,r,()=>i(s.id)]}class Zl extends G{constructor(t){super(),X(this,t,Hl,Yl,r,{game:0,onclick:1,ondelete:6})}}function Ql(t,e,n){const s=t.slice();return s[5]=e[n],s}function Jl(t){let e;return{c(){e=f("span"),e.textContent="Aucune partie... Crée une partie ci-dessus pour commencer à jouer.\r\n         ",y(e,"class","nogame svelte-1hos7t9")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function Kl(t){let e,n;return e=new Zl({props:{game:t[5],onclick:t[0],ondelete:t[2]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.game=t[5]),1&n&&(s.onclick=t[0]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function tc(t){let e,n,r,o,a,l,c,m,_,w,x,b,T,C,k=t[1],A=[];for(let e=0;e<k.length;e+=1)A[e]=Kl(Ql(t,k,e));const S=t=>j(A[t],1,1,(()=>{A[t]=null}));let O=null;return k.length||(O=Jl()),{c(){e=f("div"),n=f("div"),n.innerHTML='<p class="bold svelte-1hos7t9">Bienvenue dans MoLangeur!</p> \n        <p>Commence une nouvelle partie ou continue une partie déjà commencée (s&#39;il y en a).\n            Tu peux à tout moment revenir à ce menu en cliquant sur le logo MoLangeur en haut à gauche de l&#39;écran.\n            Bon jeu!</p>',r=g(),o=f("div"),a=f("button"),a.textContent="Nouvelle Partie",l=g(),c=f("button"),c.textContent="Importer une partie",m=g(),_=f("div"),_.textContent="Parties existantes (clique sur un partie pour continuer à jouer):",w=g(),x=f("div");for(let t=0;t<A.length;t+=1)A[t].c();O&&O.c(),y(n,"class","intro svelte-1hos7t9"),y(a,"class","svelte-1hos7t9"),y(c,"class","svelte-1hos7t9"),y(o,"class","new-games svelte-1hos7t9"),y(_,"class","game-list-header svelte-1hos7t9"),y(x,"class","game-list svelte-1hos7t9"),y(e,"class","container svelte-1hos7t9")},m(s,d){h(s,e,d),u(e,n),u(e,r),u(e,o),u(o,a),u(o,l),u(o,c),u(e,m),u(e,_),u(e,w),u(e,x);for(let t=0;t<A.length;t+=1)A[t].m(x,null);O&&O.m(x,null),b=!0,T||(C=[v(a,"click",(function(){i(t[0](null))&&t[0](null).apply(this,arguments)})),v(c,"click",t[3])],T=!0)},p(e,[n]){if(t=e,7&n){let e;for(k=t[1],e=0;e<k.length;e+=1){const s=Ql(t,k,e);A[e]?(A[e].p(s,n),F(A[e],1)):(A[e]=Kl(s),A[e].c(),F(A[e],1),A[e].m(x,null))}for(q(),e=k.length;e<A.length;e+=1)S(e);L(),k.length?O&&(O.d(1),O=null):O||(O=Jl(),O.c(),O.m(x,null))}},i(t){if(!b){for(let t=0;t<k.length;t+=1)F(A[t]);b=!0}},o(t){A=A.filter(Boolean);for(let t=0;t<A.length;t+=1)j(A[t]);b=!1},d(t){t&&d(e),p(A,t),O&&O.d(),T=!1,s(C)}}}function ec(t,e,n){let s,{launchGame:i}=e;const r=()=>{(t=>{let e=yt.transaction("games","readonly").objectStore("games").getAll();e.addEventListener("success",(()=>{console.log("DB games retrieved"),t(e.result)}))})((t=>{n(1,s=[...t.sort(((t,e)=>e.update_date-t.update_date))])}))};return r(),t.$$set=t=>{"launchGame"in t&&n(0,i=t.launchGame)},n(1,s=[]),[i,s,t=>{((t,e)=>{let n=yt.transaction("games","readwrite").objectStore("games").delete(t);n.addEventListener("success",(()=>{console.log("DB game deleted"),e()})),n.addEventListener("error",(()=>{console.error("DB Error: ",n.error)}))})(t,(()=>{r()}))},()=>{const t=document.createElement("input");t.type="file",t.accept=".molangeur",t.multiple=!1,t.addEventListener("change",(function(){const t=this.files[0],e=new FileReader;e.readAsText(t),e.onload=()=>{const t=e.result,n=JSON.parse(t);console.log(n),n.id=Math.random().toString().slice(2),wt(n,(()=>{r()}))},e.onerror=()=>{console.error("An error occured while reading the file...")}})),t.click()}]}class nc extends G{constructor(t){super(),X(this,t,ec,tc,r,{launchGame:0})}}function sc(t){let e,n,s,i,r,o,a,l,c,p,m,_,w;const x=[oc,rc],b=[];function T(t,e){return"welcom"===t[0]?0:"game"===t[0]?1:-1}return~(c=T(t))&&(p=b[c]=x[c](t)),{c(){e=f("div"),n=f("div"),s=f("div"),i=g(),r=f("img"),a=g(),l=f("div"),p&&p.c(),y(s,"class","navigation-toggle svelte-1mo6hin"),r.src!==(o="../images/molangeur_logo.png")&&y(r,"src","../images/molangeur_logo.png"),y(r,"alt",""),y(r,"class","svelte-1mo6hin"),y(n,"class","header-navigation svelte-1mo6hin"),y(l,"class","content svelte-1mo6hin"),y(e,"class","container svelte-1mo6hin")},m(o,d){h(o,e,d),u(e,n),u(n,s),u(n,i),u(n,r),u(e,a),u(e,l),~c&&b[c].m(l,null),m=!0,_||(w=v(r,"click",t[4]),_=!0)},p(t,e){let n=c;c=T(t),c===n?~c&&b[c].p(t,e):(p&&(q(),j(b[n],1,1,(()=>{b[n]=null})),L()),~c?(p=b[c],p?p.p(t,e):(p=b[c]=x[c](t),p.c()),F(p,1),p.m(l,null)):p=null)},i(t){m||(F(p),m=!0)},o(t){j(p),m=!1},d(t){t&&d(e),~c&&b[c].d(),_=!1,w()}}}function ic(e){let n;return{c(){n=f("div"),n.innerHTML='<div class="svelte-1mo6hin"><p>Molangeur se prépare.</p> \n            <p>Veuillez patienter quelques instants...</p></div>',y(n,"class","loading svelte-1mo6hin")},m(t,e){h(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function rc(t){let e,n;return e=new Gl({props:{id:t[1]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.id=t[1]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function oc(t){let e,n;return e=new nc({props:{launchGame:t[5]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};3&n&&(s.launchGame=t[5]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function ac(t){let e,n,s,i;const r=[ic,sc],o=[];function a(t,e){return t[2]?1:0}return e=a(t),n=o[e]=r[e](t),{c(){n.c(),s=_()},m(t,n){o[e].m(t,n),h(t,s,n),i=!0},p(t,[i]){let l=e;e=a(t),e===l?o[e].p(t,i):(q(),j(o[l],1,1,(()=>{o[l]=null})),L(),n=o[e],n?n.p(t,i):(n=o[e]=r[e](t),n.c()),F(n,1),n.m(s.parentNode,s))},i(t){i||(F(n),i=!0)},o(t){j(n),i=!1},d(t){o[e].d(t),t&&d(s)}}}function lc(t,e,n){let s,i="welcom",r=null,o={dico:!0,db:!1};(t=>{let e=indexedDB.open("db",1);e.addEventListener("upgradeneeded",(()=>{yt=e.result,yt.objectStoreNames.contains("games")||yt.createObjectStore("games",{keyPath:"id"})})),e.addEventListener("error",(()=>{console.error("DB Error: ",e.error)})),e.addEventListener("success",(()=>{console.log("DB opened"),yt=e.result,t()}))})((()=>{n(3,o.db=!0,o)}));return t.$$.update=()=>{8&t.$$.dirty&&n(2,s=Object.keys(o).map((t=>o[t])).reduce(((t,e)=>t&&e)))},[i,r,s,o,()=>{var t;t=()=>{},Object.keys(ut).map((t=>delete ut[t])),lt.terminate(),dt(t),n(0,i="welcom")},t=>{n(0,i="game"),n(1,r=t)}]}dt((()=>console.log("molangeur was initialized")));return new class extends G{constructor(t){super(),X(this,t,lc,ac,r,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
