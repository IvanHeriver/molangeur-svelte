var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(e,...n){if(null==e)return t;const s=e.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function a(t){let e;return o(t,(t=>e=t))(),e}function l(t,e,n){t.$$.on_destroy.push(o(e,n))}function c(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function g(){return m(" ")}function _(){return m("")}function v(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function x(t,e){t.value=null==e?"":e}let b;function T(t){b=t}function C(){if(!b)throw new Error("Function called outside component initialization");return b}const A=[],k=[],S=[],O=[],M=Promise.resolve();let E=!1;function D(t){S.push(t)}let I=!1;const R=new Set;function N(){if(!I){I=!0;do{for(let t=0;t<A.length;t+=1){const e=A[t];T(e),P(e.$$)}for(T(null),A.length=0;k.length;)k.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];R.has(e)||(R.add(e),e())}S.length=0}while(A.length);for(;O.length;)O.pop()();E=!1,I=!1,R.clear()}}function P(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(D)}}const V=new Set;let $;function q(){$={r:0,c:[],p:$}}function L(){$.r||s($.c),$=$.p}function F(t,e){t&&t.i&&(V.delete(t),t.i(e))}function j(t,e,n,s){if(t&&t.o){if(V.has(t))return;V.add(t),$.c.push((()=>{V.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function B(t){t&&t.c()}function W(t,n,r,o){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(n,r),o||D((()=>{const n=l.map(e).filter(i);c?c.push(...n):s(n),t.$$.on_mount=[]})),u.forEach(D)}function U(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function X(t,e){-1===t.$$.dirty[0]&&(A.push(t),E||(E=!0,M.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function z(e,i,r,o,a,l,c=[-1]){const u=b;T(e);const h=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:i.context||[]),callbacks:n(),dirty:c,skip_bound:!1};let p=!1;if(h.ctx=r?r(e,i.props||{},((t,n,...s)=>{const i=s.length?s[0]:n;return h.ctx&&a(h.ctx[t],h.ctx[t]=i)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](i),p&&X(e,t)),n})):[],h.update(),p=!0,s(h.before_update),h.fragment=!!o&&o(h.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);h.fragment&&h.fragment.l(t),t.forEach(d)}else h.fragment&&h.fragment.c();i.intro&&F(e.$$.fragment),W(e,i.target,i.anchor,i.customElement),N()}T(u)}class G{$destroy(){U(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Y=[];function H(e,n=t){let s;const i=[];function o(t){if(r(e,t)&&(e=t,s)){const t=!Y.length;for(let t=0;t<i.length;t+=1){const n=i[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(r,a=t){const l=[r,a];return i.push(l),1===i.length&&(s=n(o)||t),r(e),()=>{const t=i.indexOf(l);-1!==t&&i.splice(t,1),0===i.length&&(s(),s=null)}}}}const Z=(()=>{const{subscribe:t,set:e,update:n}=H(null);return{subscribe:t,init:e,moveLetter:(t,e,s)=>{n((n=>(e&&!((t,e)=>0===t.filter((t=>t.board&&t.index===e)).length)(n.letters,s)||(n.letters=n.letters.map((n=>(n.id===t&&(n.index=s,n.board=e),n)))),n)))},addLetter:t=>{n((e=>(e.letters=[...e.letters,t],e)))},setJoker:(t,e)=>{n((n=>(n.letters=n.letters.map((n=>(n.id===t&&"_"===n.letter&&(n.joker=e),n))),n)))},fixLetter:t=>{n((e=>(e.letters=e.letters.map((e=>(e.id===t&&(e.free=!1),e))),e)))},setPlayers:t=>{n((e=>(e.players=t,e)))},setMolangeur:t=>{console.log(t),n((e=>(e.molangeur=t,e)))},setJokerPicker:(t,e=!1)=>{n((n=>(n.jocker_picker=e,n.jocker_picker_letter={...t},n)))},addNewLetterFlag:()=>{n((t=>(t.new_letters=!0,t)))},removeNewLetterFlag:()=>{n((t=>(t.new_letters=!1,t)))},setRound:t=>{n((e=>(e.round=t,e)))},setEvaluation:t=>{n((e=>(e.evaluation=t,e)))},setGameOver:()=>{n((t=>(t.game_over=!0,t)))},setNeedForNewImagePreview:(t=!0)=>{n((e=>(e.image_preview_needed=t,e)))},setLettersLeft:t=>{n((e=>(e.letters_left=t,e)))}}})(),Q=(()=>{const{subscribe:t,set:e,update:n}=H({temp_letters:[],hover_location:null});return{subscribe:t,init:e,setTempLetters:t=>{n((e=>(e.temp_letters=t,e)))},setHoverLocation:t=>{n((e=>(e.hover_location=t,e)))}}})(),J=t=>[...new Set(t)],K=t=>{let e=Math.floor(t/15);return{row:t-15*e,col:e}},tt=t=>Math.floor(t/15),et=t=>t-15*Math.floor(t/15),nt=(t,e)=>15*e+t,st=t=>{let e,n,s=t.length;for(;0!==s;)n=Math.floor(Math.random()*s),s-=1,e=t[s],t[s]=t[n],t[n]=e;return t},it=(t,e)=>0===t?-1:nt(t-1,e),rt=(t,e)=>14===t?-1:nt(t+1,e),ot=(t,e)=>0===e?-1:nt(t,e-1),at=(t,e)=>14===e?-1:nt(t,e+1),lt=(t,e,n=!0)=>{let s,i=[t],r=t;if(n){for(;r!=e&&(s=K(r),r=at(s.row,s.col),r>0);)if(i.push(r),r>224)throw"Not Supposed to happen: contact developer"}else for(;r!=e&&(s=K(r),r=rt(s.row,s.col),r>0);)if(i.push(r),r>224)throw"Not Supposed to happen: contact developer";return i},ct=t=>{let e=Array(225).fill(null);return t.map((t=>e[t.index]=t)),e},ut=t=>{const e=[];let n=null;return t.map(((s,i)=>{null!==s?(null!==n?n.push(s):n=[s],i===t.length-1&&e.push(n)):null!==n&&(e.push(n),n=null)})),e},ht=(t,e=!0)=>{const n=Array(15).fill(0).map((t=>Array(15).fill(null)));return t.map((t=>{let s=K(t.index);e?n[s.row][s.col]=t:n[s.col][s.row]=t})),n},dt={_:{pts:0,n:2,vowel:!0,consonant:!0},A:{pts:1,n:9,vowel:!0,consonant:!1},B:{pts:3,n:2,vowel:!1,consonant:!0},C:{pts:3,n:2,vowel:!1,consonant:!0},D:{pts:2,n:3,vowel:!1,consonant:!0},E:{pts:1,n:15,vowel:!0,consonant:!1},F:{pts:4,n:2,vowel:!1,consonant:!0},G:{pts:2,n:2,vowel:!1,consonant:!0},H:{pts:4,n:2,vowel:!1,consonant:!0},I:{pts:1,n:8,vowel:!0,consonant:!1},J:{pts:8,n:1,vowel:!1,consonant:!0},K:{pts:10,n:1,vowel:!1,consonant:!0},L:{pts:1,n:5,vowel:!1,consonant:!0},M:{pts:2,n:3,vowel:!1,consonant:!0},N:{pts:1,n:6,vowel:!1,consonant:!0},O:{pts:1,n:6,vowel:!0,consonant:!1},P:{pts:3,n:2,vowel:!1,consonant:!0},Q:{pts:8,n:1,vowel:!1,consonant:!0},R:{pts:1,n:6,vowel:!1,consonant:!0},S:{pts:1,n:6,vowel:!1,consonant:!0},T:{pts:1,n:6,vowel:!1,consonant:!0},U:{pts:1,n:6,vowel:!0,consonant:!1},V:{pts:4,n:2,vowel:!1,consonant:!0},W:{pts:10,n:1,vowel:!1,consonant:!0},X:{pts:10,n:1,vowel:!1,consonant:!0},Y:{pts:10,n:1,vowel:!0,consonant:!1},Z:{pts:10,n:1,vowel:!1,consonant:!0}};const pt=Object.keys(dt).filter((t=>"_"!==t)),ft={letter_double:[3,11,36,38,45,52,59,92,96,98,102,108,116,122,126,128,132,165,172,179,186,188,213,221],letter_triple:[20,24,76,80,84,88,136,140,144,148,200,204],word_double:[16,28,32,42,48,56,64,70,112,154,160,168,176,182,192,196,208],word_triple:[0,7,14,105,119,210,217,224]},mt=Array(225).fill(0).map(((t,e)=>({letter_mutliplier:(-1===ft.letter_double.indexOf(e)?1:2)*(-1===ft.letter_triple.indexOf(e)?1:3),word_multiplier:(-1===ft.word_double.indexOf(e)?1:2)*(-1===ft.word_triple.indexOf(e)?1:3)})));const gt=Array(15).fill(0).map(((t,e)=>Array(15).fill(0).map(((t,n)=>n+15*e))));const _t=Array(15).fill(0).map(((t,e)=>Array(15).fill(0).map(((t,n)=>15*n+e))));const vt=(()=>{const t={V:Array(225),H:Array(225)};return gt.map((e=>{for(let n=0;n<15;n++){t.V[e[n]]=[];for(let s=1;s<=15-n;s++)t.V[e[n]].push(e.slice(n,n+s))}})),_t.map((e=>{for(let n=0;n<15;n++){t.H[e[n]]=[];for(let s=1;s<=15-n;s++)t.H[e[n]].push(e.slice(n,n+s))}})),t})(),yt=(()=>{const t=Array(15).fill(0).map((t=>Array(15).fill(0))),e=Array(225).fill(0),n=Array(225).fill(0),s=(t,e)=>15*e+t;let i=0;for(let r=0;r<15;r++)for(let o=0;o<15;o++)t[o][r]=i,e[i]={row:o,col:r},n[i]={top:o>0?s(o-1,r):null,bottom:o<14?s(o+1,r):null,left:r>0?s(o,r-1):null,right:r<14?s(o,r+1):null},i++;return{FROM_INDEX:e,TO_INDEX:t,NEIGHBORS:n}})();let wt;window.Worker?wt=new Worker("molangeur.js"):(alert('Ce site necessite la technologie "Worker" que votre navigateur ne possède pas.\n    Certaines fonctionnalités importantes ne fonctionneront.\n    Cela inclue le maître MoLangeur, l\'algorithme permettant de trouver le meilleur mot dans une situation donnée.'),wt={addEventListener:()=>{},postMessage:()=>{}});const xt=()=>Math.random().toString().slice(2),bt={};let Tt;wt.addEventListener("message",(t=>{const e=t.data;console.log(`message received: ${e.id}`),console.log(e),e.id&&bt[e.id]&&(bt[e.id](e.content),delete bt[e.id])}));const Ct=t=>{const e=(t,n=0,s=Tt)=>void 0===t[n]?void 0!==s.$:void 0!==s[t[n]]&&e(t,n+1,s[t[n]]);return e(t)},At=(t,e)=>{let n=xt();bt[n]=e,wt.postMessage({code:"molangeur",id:n,content:t})},kt=t=>[...new Set(t)],St=t=>{let e=Array(225).fill(null);return t.map((t=>e[t.index]=t)),e},Ot=(t,e)=>-1!==t.indexOf(e),Mt={letter_double:[3,11,36,38,45,52,59,92,96,98,102,108,116,122,126,128,132,165,172,179,186,188,213,221],letter_triple:[20,24,76,80,84,88,136,140,144,148,200,204],word_double:[16,28,32,42,48,56,64,70,112,154,160,168,176,182,192,196,208],word_triple:[0,7,14,105,119,210,217,224]};let Et;const Dt=t=>{let e=Et.transaction("games","readwrite").objectStore("games").put(t);e.addEventListener("success",(()=>{console.log("DB game updated")})),e.addEventListener("error",(()=>{console.error("DB Error: ",e.error)}))},It=(t,e)=>{let n=Et.transaction("games","readonly").objectStore("games").get(t);n.addEventListener("success",(()=>{console.log("DB game retrieved"),e(n.result)}))},Rt=()=>{Bt();let t={bag:Vt(),board:[],players:[{id:Math.random().toString().slice(2),rack:[],score:0,molangeur:0}],round:0,type:"solo-duplicate",id:Math.random().toString().slice(2),update_date:Date.now(),create_date:Date.now()};const e=$t(t.bag,t.players[0].rack,t.round);t.players[0].rack=e.letters,t.bag=e.bag,(t=>{let e=Et.transaction("games","readwrite").objectStore("games").add(t);e.addEventListener("success",(()=>{console.log("DB game added")})),e.addEventListener("error",(()=>{console.error("DB Error: ",e.error)}))})(t),Wt(t.id,t.players[0].id,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),t.board,t.players[0].rack),Ut(),At([...t.board,...t.players[0].rack],(t=>{Ut(t)}))},Nt=t=>{Ht(),t.gameover=!0,Dt(t)},Pt=(t,e)=>{const n=t,s=[...n,...e];(t=>{const e=t.filter((t=>t.board&&t.free)),n=t.filter((t=>t.board&&!t.free));St(n),e.sort(((t,e)=>t.index-e.index)).map((t=>yt.FROM_INDEX[t.index]));const s=1===kt(e.sort(((t,e)=>t.index-e.index)).map((t=>yt.FROM_INDEX[t.index].row))).length;console.log("***********************************"),console.log(e),console.log(n),console.log(s)})(s);const i=ct(s),r=ct(n),o=1===e.filter((t=>112===t.index)).length,a=1===J(e.map((t=>et(t.index)))).length,l=1===J(e.map((t=>tt(t.index)))).length,c=e.map((t=>(t=>{const e=tt(t),n=et(t);return[it(n,e),rt(n,e),ot(n,e),at(n,e)]})(t.index).filter((t=>null!==r[t])))).flat().length>0;let u=!1,h=Math.min(...e.map((t=>t.index))),d=Math.max(...e.map((t=>t.index)));a?u=0===lt(h,d,!0).filter((t=>null===i[t])).length:l&&(u=0===lt(h,d,!1).filter((t=>null===i[t])).length);const p=(o||c)&&(a||l)&&u;if(!p)return!1;const f=qt(s).filter((t=>t.word.filter((t=>t.free)).length>0)),m=f.map((t=>Lt(t.word)));if(0===m.length)return!1;const g=m.map((t=>Ct(t))),_=g.reduce(((t,e)=>t&&e),!0),v=f.map((t=>t.word.filter((t=>t.free)).length)),y=v.indexOf(Math.max(...v)),w=f.map((t=>(t=>{const e=t.map((t=>{let e=dt[t.letter].pts,n=1;return t.free&&(Ot(Mt.letter_double,t.index)&&(e*=2),Ot(Mt.letter_triple,t.index)&&(e*=3),Ot(Mt.word_double,t.index)&&(n=2),Ot(Mt.word_triple,t.index)&&(n=3)),{letter_value:e,word_multiplier:n}}));return e.reduce(((t,e)=>t+e.letter_value),0)*e.reduce(((t,e)=>t*e.word_multiplier),1)+(7===t.reduce(((t,e)=>e.free?t+1:t),0)?50:0)})(t.word))),x=w.reduce(((t,e)=>t+e),0);let b=f[y].word.slice(-1)[0].index;return{is_position_valid:p,is_word_valid:_,words:m,words_validity:g,full_words:f,letters:e,main_word_index:y,word_scores:w,total_score:x,last_letter_index:b}},Vt=()=>{let t=Object.keys(dt).map((t=>t.repeat(dt[t].n).split(""))).flat().map((t=>({id:Math.random().toString().slice(2),letter:t,joker:"",board:!1,free:!0})));return t=st(t),t},$t=(t,e,n)=>{const s=()=>t.slice(0,i),i=7-e.length;let r=s(),o=n<15?2:1,a=e.filter((t=>dt[t.letter].vowel)).length,l=e.filter((t=>dt[t.letter].consonant)).length,c=r.filter((t=>dt[t.letter].vowel)).length,u=r.filter((t=>dt[t.letter].consonant)).length,h=a+c<o||l+u<o,d=0;for(;h&&d<10;)t=st(t),r=s(),c=r.filter((t=>dt[t.letter].vowel)).length,u=r.filter((t=>dt[t.letter].consonant)).length,h=a+c<o||l+u<o,d++;return{letters:r,bag:t.slice(i)}},qt=t=>{const e=ht(t,!1);return[...ht(t,!0).map((t=>ut(t).filter((t=>t.length>1)).map((t=>({vertical:!1,word:t}))))).flat(),...e.map((t=>ut(t).filter((t=>t.length>1)).map((t=>({vertical:!0,word:t}))))).flat()]},Lt=t=>t.map((t=>"_"===t.letter?t.joker:t.letter)).reduce(((t,e)=>t+e)),Ft=t=>{const e=t.letters.filter((t=>!t.board)).map((t=>t.index));return Array(7).fill(0).map(((t,e)=>e)).filter((t=>-1===e.indexOf(t)))},jt=()=>{const t=a(Z),e=Ft(t);let n=-1;t.letters.filter((t=>t.board&&t.free)).map((t=>{n++,Z.moveLetter(t.id,!1,e[n]),Z.setJoker(t.id,"")})),Z.setEvaluation(!1)},Bt=()=>Z.init(null),Wt=(t,e,n,s,i,r,o)=>{const l=a(Z);if(null===l)o=o.map(((t,e)=>(t.index=e,t))),Z.init({id:t,player_id:e,round:n,letters_left:s,players:i,letters:[...r,...o],molangeur:{next_score:0,current_words:null,next_words:null}}),Z.setNeedForNewImagePreview();else{const t=Ft(l),e=r.map((t=>t.index));r.map((t=>{if(1!==l.letters.filter((e=>e.id===t.id)).length)throw"A letter that should exist, doesn't...";Z.fixLetter(t.id),Z.moveLetter(t.id,!0,t.index)}));let a=0;o.map((n=>{1===l.letters.filter((t=>t.id===n.id)).length?n.board&&-1!==e.indexOf(n.index)&&(Z.moveLetter(n.id,!1,t[a]),Z.setJoker(n.id,""),a++):(n.index=t[a],n.board=!1,n.free=!0,Z.addLetter(n),a++)})),Z.setPlayers(i),Z.setEvaluation(!1),Z.setRound(n),Z.setNeedForNewImagePreview(),Z.setLettersLeft(s)}},Ut=(t=null)=>{const e=a(Z);t?Z.setMolangeur({next_score:t[0].pts,current_words:e.molangeur.next_words,next_words:t,searching:!1}):Z.setMolangeur({next_score:null,current_words:null,next_words:e.molangeur.next_words,searching:!0})},Xt=t=>{t?(t=>{Bt(),It(t,(t=>{const e=t.players[0].id,n=t.players.map((t=>t.id)).indexOf(e);Wt(t.id,e,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),t.board,t.players[n].rack),t.gameover?Ht():At([...t.board,...t.players[n].rack],(e=>{0!==e.length?Ut(e):(console.error("should no happen"),Nt(t))}))}))})(t):Rt()},zt=()=>{const t=a(Z),e=t.letters.filter((t=>t.board&&t.free)),n=t.letters.filter((t=>t.board&&!t.free)),s=Pt(n,e);Z.setEvaluation(s)},Gt=(t,e)=>{const n=a(Z);((t,e,n,s)=>{console.log("submitWord"),It(t,(t=>{const i=t.players.map((t=>t.id)).indexOf(e),r=Pt(t.board,n);if(r&&r.is_position_valid&&r.is_word_valid){const o=n.map((t=>(t.free=!1,t)));t.board=[...t.board,...o];const a=t.players[i].rack.filter((t=>0===n.filter((e=>e.id===t.id)).length)),l=$t(t.bag,a,t.round);t.bag=l.bag,t.players[i].rack=[...a,...l.letters],t.players[i].score+=r.total_score,t.players[i].molangeur+=s,t.round++,t.update_date=Date.now(),Dt(t),Wt(t.id,e,t.round,t.bag.length,t.players.map((t=>({id:t.id,score:t.score,molangeur:t.molangeur}))),[...t.board],[...t.players[i].rack]),At([...t.board,...t.players[i].rack],(e=>{0!==e.length?Ut(e):Nt(t)}))}}))})(t,e,n.letters.filter((t=>t.board&&t.free)),n.molangeur.next_score)},Yt=(t,e)=>{((t,e)=>{It(t,(t=>{t.img=e,Dt(t)}))})(t,e)},Ht=()=>{Z.setNeedForNewImagePreview(),Z.setGameOver()};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Zt(t){var e={exports:{}};return t(e,e.exports),e.exports}var Qt=Zt((function(t){!function(e){var n=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(s="application/font-woff",i="image/jpeg",{woff:s,woff2:s,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i,jpeg:i,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var s,i},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),s=n.length,i=new Uint8Array(s),r=0;r<s;r++)i[r]=n.charCodeAt(r);e(new Blob([i],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),s=n.createElement("base");n.head.appendChild(s);var i=n.createElement("a");return n.body.appendChild(i),s.href=e,i.href=t,i.href},getAndEncode:function(t){var e=3e4;a.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(n){var s,i=new XMLHttpRequest;if(i.onreadystatechange=o,i.ontimeout=l,i.responseType="blob",i.timeout=e,i.open("GET",t,!0),i.send(),a.impl.options.imagePlaceholder){var r=a.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(s=r[1])}function o(){if(4===i.readyState)if(200===i.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(i.response)}else s?n(s):c("cannot fetch resource: "+t+", status: "+i.status)}function l(){s?n(s):c("timeout of "+e+"ms occured while fetching resource: "+t)}function c(t){console.error(t),n("")}}))},uid:(t=0,function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return new Promise((function(e,n){var s=new Image;s.onload=function(){e(s)},s.onerror=n,s.src=t}))},width:function(t){var e=n(t,"border-left-width"),s=n(t,"border-right-width");return t.scrollWidth+e+s},height:function(t){var e=n(t,"border-top-width"),s=n(t,"border-bottom-width");return t.scrollHeight+e+s}};var t;function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}(),s=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,r){return o()?Promise.resolve(t):Promise.resolve(t).then(s).then((function(e){var s=Promise.resolve(t);return e.forEach((function(t){s=s.then((function(e){return i(e,t,n,r)}))})),s}));function o(){return!e(t)}},shouldProcess:e,impl:{readUrls:s,inline:i}};function e(e){return-1!==e.search(t)}function s(e){for(var s,i=[];null!==(s=t.exec(e));)i.push(s[1]);return i.filter((function(t){return!n.isDataUrl(t)}))}function i(t,e,s,i){return Promise.resolve(e).then((function(t){return s?n.resolveUrl(t,s):t})).then(i||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e))})).then((function(s){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+n.escape(t)+")(['\"]?\\))","g")}(e),"$1"+s+"$3")}))}}(),i=function(){return{resolveAll:function(){return t().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return s.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return s.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),r=function(){return{inlineAll:function e(i){return i instanceof Element?r(i).then((function(){return i instanceof HTMLImageElement?t(i).inline():Promise.all(n.asArray(i.childNodes).map((function(t){return e(t)})))})):Promise.resolve(i);function r(t){var e=t.style.getPropertyValue("background");return e?s.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}},impl:{newImage:t}};function t(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t.src))})).then((function(e){return new Promise((function(n,s){t.onload=n,t.onerror=s,t.src=e}))}))}}}}(),o={imagePlaceholder:void 0,cacheBust:!1},a={toSvg:l,toPng:function(t,e){return c(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return c(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return c(t,e||{}).then(n.canvasToBlob)},toPixelData:function(t,e){return c(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},impl:{fontFaces:i,images:r,util:n,inliner:s,options:{}}};function l(t,e){return function(t){void 0===t.imagePlaceholder?a.impl.options.imagePlaceholder=o.imagePlaceholder:a.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?a.impl.options.cacheBust=o.cacheBust:a.impl.options.cacheBust=t.cacheBust}(e=e||{}),Promise.resolve(t).then((function(t){return u(t,e.filter,!0)})).then(h).then(d).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));return t})).then((function(s){return function(t,e,s){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+s+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(s,e.width||n.width(t),e.height||n.height(t))}))}function c(t,e){return l(t,e).then(n.makeImage).then(n.delay(100)).then((function(s){var i=function(t){var s=document.createElement("canvas");if(s.width=e.width||n.width(t),s.height=e.height||n.height(t),e.bgcolor){var i=s.getContext("2d");i.fillStyle=e.bgcolor,i.fillRect(0,0,s.width,s.height)}return s}(t);return i.getContext("2d").drawImage(s,0,0),i}))}function u(t,e,s){return s||!e||e(t)?Promise.resolve(t).then((function(t){return t instanceof HTMLCanvasElement?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(s){return function(t,e,s){var i=t.childNodes;return 0===i.length?Promise.resolve(e):r(e,n.asArray(i),s).then((function(){return e}));function r(t,e,n){var s=Promise.resolve();return e.forEach((function(e){s=s.then((function(){return u(e,n)})).then((function(e){e&&t.appendChild(e)}))})),s}}(t,s,e)})).then((function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(s).then(i).then(r).then(o).then((function(){return e})):e;function s(){function s(t,e){function s(t,e){n.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}t.cssText?e.cssText=t.cssText:s(t,e)}s(window.getComputedStyle(t),e.style)}function i(){function s(s){var i=window.getComputedStyle(t,s),r=i.getPropertyValue("content");if(""!==r&&"none"!==r){var o=n.uid();e.className=e.className+" "+o;var a=document.createElement("style");a.appendChild(l(o,s,i)),e.appendChild(a)}function l(t,e,s){var i="."+t+":"+e,r=s.cssText?o(s):a(s);return document.createTextNode(i+"{"+r+"}");function o(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function a(t){return n.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){s(t)}))}function r(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function o(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(t,e)})):Promise.resolve()}function h(t){return i.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function d(t){return r.inlineAll(t).then((function(){return t}))}t.exports=a}()}));let Jt,Kt,te=Array(7).fill(null);const ee=t=>{if(Jt[t]){let e=1;for(;t-e>=0||t+e<7;){if(t-e>=0&&null===Jt[t-e])return{left:!0,k:e};if(t+e<7&&null===Jt[t+e])return{left:!1,k:e};if(e>100)return console.log("inifinit loop"),null;e+=1}return null}return{left:!0,k:0}},ne=(t,e)=>{let n,s;if(e.left){n=t-e.k+1,s=t+1;const i=Jt.slice(n,s);Jt=[...Jt.slice(0,n-1),...i,...Jt.slice(n-1,n),...Jt.slice(s,7)].flat()}else{n=t,s=t+e.k;const i=Jt.slice(n,s);Jt=[...Jt.slice(0,n),...Jt.slice(s,s+1),...i,,...Jt.slice(s+1,7)].flat()}},se=()=>{te.map(((t,e)=>{for(let n=0;n<7;n++){if(t===Jt[e-n])return-n;if(t===Jt[e+n])return n}})).map(((t,e)=>{te[e]&&(te[e].dom.style.transform=`translateX(${105.5*t}%)`)}))};var ie=(t,e)=>{const n=document.querySelector(".rack-letters"),s=document.querySelector(".game");Kt={...e},Kt.dom=s.querySelector(`div[cui="${e.id}"]`),te=Array(7).fill(null),t.filter((t=>t.id!==e.id)).map((t=>{let e={...t};return e.dom=n.querySelector(`div[cui="${e.id}"]`),te[e.index]=e,t})),Jt=[...te]},re=t=>{void 0!==t&&(ne(t,ee(t)),se())},oe=()=>{Jt=[...te],se()},ae=()=>Jt.map(((t,e)=>t?{id:t.id,index:e}:void 0)).filter((t=>t));function le(e){let n,r,o,a,l,p,_,x,b,T=(0===e[2]?"":e[2])+"";return{c(){n=f("div"),r=f("span"),o=m(e[1]),a=g(),l=f("span"),p=m(T),y(r,"class","value svelte-19uf9hj"),y(l,"class","score svelte-19uf9hj"),y(n,"class",_=c("letter "+e[4])+" svelte-19uf9hj"),y(n,"style",e[5]),y(n,"cui",e[3])},m(t,s){h(t,n,s),u(n,r),u(r,o),u(n,a),u(n,l),u(l,p),e[8](n),x||(b=[v(n,"mousedown",(function(){i(e[6])&&e[6].apply(this,arguments)})),v(n,"touchstart",(function(){i(e[6])&&e[6].apply(this,arguments)})),v(n,"click",(function(){i(e[7])&&e[7].apply(this,arguments)}))],x=!0)},p(t,[s]){e=t,2&s&&w(o,e[1]),4&s&&T!==(T=(0===e[2]?"":e[2])+"")&&w(p,T),16&s&&_!==(_=c("letter "+e[4])+" svelte-19uf9hj")&&y(n,"class",_),32&s&&y(n,"style",e[5]),8&s&&y(n,"cui",e[3])},i:t,o:t,d(t){t&&d(n),e[8](null),x=!1,s(b)}}}function ce(t,e,n){let{letter:s}=e,{value:i}=e,{id:r}=e,{classes:o}=e,{styles:a=""}=e,{self:l=null}=e,{on_mousedown:c=null}=e,{on_click:u=null}=e;return t.$$set=t=>{"letter"in t&&n(1,s=t.letter),"value"in t&&n(2,i=t.value),"id"in t&&n(3,r=t.id),"classes"in t&&n(4,o=t.classes),"styles"in t&&n(5,a=t.styles),"self"in t&&n(0,l=t.self),"on_mousedown"in t&&n(6,c=t.on_mousedown),"on_click"in t&&n(7,u=t.on_click)},[l,s,i,r,o,a,c,u,function(t){k[t?"unshift":"push"]((()=>{l=t,n(0,l)}))}]}class ue extends G{constructor(t){super(),z(this,t,ce,le,r,{letter:1,value:2,id:3,classes:4,styles:5,self:0,on_mousedown:6,on_click:7})}}const he="14.7.77";var de=Zt((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0})),pe=Zt((function(t){t.exports=function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var s,i,r=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(r.push(s.value),!e||r.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return r}},t.exports.default=t.exports,t.exports.__esModule=!0})),fe=Zt((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s},t.exports.default=t.exports,t.exports.__esModule=!0})),me=Zt((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return fe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0})),ge=Zt((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0})),_e=Zt((function(t){t.exports=function(t,e){return de(t)||pe(t,e)||me(t,e)||ge()},t.exports.default=t.exports,t.exports.__esModule=!0})),ve=Zt((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0})),ye=Zt((function(t){function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t},t.exports.default=t.exports,t.exports.__esModule=!0})),we=Zt((function(t,e){!function(t,e,n,s){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),o=i(n),a=i(s),l=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},c=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},u=function(t,e){return{startTime:e,type:"setValue",value:t}},h=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},d=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},p=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return p(t)||f(t)},g=function(t){return"setValue"===t.type},_=function(t){return"setValueCurve"===t.type},v=function t(e,n,s,i){var r=e[n];return void 0===r?i:m(r)||g(r)?r.value:_(r)?r.values[r.values.length-1]:d(s,t(e,n-1,r.startTime,i),r)},y=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:m(n)?[n.endTime,n.value]:g(n)?[n.startTime,n.value]:_(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,v(t,e-1,n.startTime,i)]},w=function(t){return"cancelAndHold"===t.type},x=function(t){return"cancelScheduledValues"===t.type},b=function(t){return w(t)||x(t)?t.cancelTime:p(t)||f(t)?t.endTime:t.startTime},T=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},C=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},A=function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]},k=function(t,e){var n=e.duration,s=e.startTime,i=e.values,r=(t-s)/n*(i.length-1);return A(i,r)},S=function(t){return"setTarget"===t.type},O=function(){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return a.default(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=b(t);if(w(t)||x(t)){var n=this._automationEvents.findIndex((function(n){return x(t)&&_(n)?n.startTime+n.duration>=e:b(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&m(s)){if(S(i))throw new Error("The internal list is malformed.");var r=_(i)?i.startTime+i.duration:b(i),o=_(i)?i.values[i.values.length-1]:i.value,a=p(s)?T(e,r,o,s):C(e,r,o,s),d=p(s)?l(a,e,this._currenTime):c(a,e,this._currenTime);this._automationEvents.push(d)}void 0!==i&&S(i)&&this._automationEvents.push(u(this.getValue(e),e)),void 0!==i&&_(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var g=this._automationEvents.findIndex((function(t){return b(t)>e})),v=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==v&&_(v)&&b(v)+v.duration>e)return!1;var y=p(t)?l(t.value,t.endTime,this._currenTime):f(t)?c(t.value,e,this._currenTime):t;if(-1===g)this._automationEvents.push(y);else{if(_(t)&&e+t.duration>b(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,y)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return b(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];S(s)&&n.unshift(u(v(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return b(e)>t})),n=this._automationEvents[e],s=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[s];if(void 0!==i&&S(i)&&(void 0===n||!m(n)||n.insertTime>t))return d(t,v(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==i&&_(i)&&(void 0===n||!m(n)||i.startTime+i.duration>t))return t<i.startTime+i.duration?k(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==n&&p(n)){var o=y(this._automationEvents,s,i,n,this._defaultValue),a=r.default(o,2),l=a[0],c=a[1];return T(t,l,c,n)}if(void 0!==n&&f(n)){var u=y(this._automationEvents,s,i,n,this._defaultValue),h=r.default(u,2),w=h[0],x=h[1];return C(t,w,x,n)}return this._defaultValue}}]),t}(),M=function(t){return{cancelTime:t,type:"cancelAndHold"}},E=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},D=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},I=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},R=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}};t.AutomationEventList=O,t.createCancelAndHoldAutomationEvent=M,t.createCancelScheduledValuesAutomationEvent=E,t.createExponentialRampToValueAutomationEvent=D,t.createLinearRampToValueAutomationEvent=I,t.createSetTargetAutomationEvent=R,t.createSetValueAutomationEvent=u,t.createSetValueCurveAutomationEvent=h,Object.defineProperty(t,"__esModule",{value:!0})}(e,_e,ve,ye)}));const xe=new WeakSet,be=new WeakMap,Te=new WeakMap,Ce=new WeakMap,Ae=new WeakMap,ke=new WeakMap,Se=new WeakMap,Oe=new WeakMap,Me=new WeakMap,Ee=new WeakMap,De={construct:()=>De},Ie=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Re=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(Ie);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(Ie)}return[n.join(";"),s]},Ne=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Pe=t=>{if(!(t=>{try{new new Proxy(t,De)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Ve=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},$e=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},qe=(t,e,n,s)=>{const i=Ve(t,e),r=$e(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},Le=t=>Ve(Se,t),Fe=t=>{if(xe.has(t))throw new Error("The AudioNode is already stored.");xe.add(t),Le(t).forEach((t=>t(!0)))},je=t=>"port"in t,Be=t=>{if(!xe.has(t))throw new Error("The AudioNode is not stored.");xe.delete(t),Le(t).forEach((t=>t(!1)))},We=(t,e)=>{!je(t)&&e.every((t=>0===t.size))&&Be(t)},Ue={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Xe=(t,e)=>t.context===e,ze=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Ge=()=>new DOMException("","IndexSizeError"),Ye=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw Ge();throw t}})},He={numberOfChannels:1},Ze=-34028234663852886e22,Qe=-Ze,Je=t=>xe.has(t),Ke={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},tn=t=>Ve(be,t),en=t=>Ve(Ce,t),nn=(t,e)=>{const{activeInputs:n}=tn(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||nn(n,[...e,t])}))));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:je(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=en(t);void 0!==n&&n.activeInputs.forEach((([t])=>nn(t,e)))}Je(t)&&Be(t)},sn=t=>{nn(t.destination,[])},rn=t=>"context"in t,on=t=>rn(t[0]),an=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},ln=(t,e,[n,s],i)=>{an(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},cn=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):an(r,[n,s],(t=>t[0]===n),i)},un=t=>"inputs"in t,hn=(t,e,n,s)=>{if(un(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},dn=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},pn=(t,e)=>{if(!Le(t).delete(e))throw new Error("Missing the expected event listener.")},fn=(t,e,n)=>{const s=Ve(t,e),i=$e(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},mn=(t,e,n,s)=>{un(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},gn=t=>Ve(Te,t),_n=t=>Ve(Ae,t),vn=t=>Oe.has(t),yn=t=>!xe.has(t),wn=t=>new Promise((e=>{const n=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(n).connect(t.destination),o.connect(s),o.disconnect(s),n.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()})),xn=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},bn=t=>"context"in t,Tn=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=en(e),{outputs:o}=tn(t),a=Le(t),l=o=>{const a=gn(t),l=_n(e);if(o){const e=fn(r,t,n);ln(i,t,e,!1),s||vn(t)||a.connect(l,n)}else{const e=((t,e,n)=>$e(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);cn(r,e,!1),s||vn(t)||a.disconnect(l,n)}};return!!an(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(l),Je(t)?ln(i,t,[n,l],!0):cn(r,[t,n,l],!0),!0)},Cn=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=tn(e),o=dn(i[s],t,n);if(null===o)return[qe(r,t,n,s)[2],!1];return[o[2],!0]})(t,n,s,i);if(null!==r&&(pn(t,r),!o||e||vn(t)||mn(gn(t),gn(n),s,i)),Je(n)){const{activeInputs:t}=tn(n);We(n,t)}},An=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=en(e),r=dn(s,t,n);if(null===r)return[fn(i,t,n)[1],!1];return[r[2],!0]})(t,n,s);null!==i&&(pn(t,i),!r||e||vn(t)||gn(t).disconnect(_n(n),s))};class kn{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const Sn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function On(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const Mn=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},En=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Dn=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,l=s.channelCount*s.numberOfInputs,c=i.reduce(((t,e)=>t+e),0),u=0===c?null:n.createBuffer(c,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=tn(t),d=await((t,e)=>{const n=Ve(Ee,t),s=gn(e);return Ve(n,s)})(n,t),p=En(s.numberOfInputs,s.channelCount),f=En(s.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let c=0;c<a;c+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)On(e,p[t],n,n,c);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{On(e,m,t,l+n,c)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=p.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(c/n.sampleRate,n.sampleRate,(()=>d.process(t,f,m)));if(null!==u)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)Mn(u,f[t],n,e+n,c);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return u},In={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Rn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Nn={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Pn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Vn={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},$n=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((s=>{n.onmessage=()=>{e.close(),n.close(),s()},e.postMessage(t,[t])}))},qn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Ln=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},Fn={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},jn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Bn=()=>new DOMException("","InvalidStateError"),Wn=()=>new DOMException("","InvalidAccessError"),Un={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Xn=(t,e,n,s,i,r,o,a,l,c,u)=>{const h=c.length;let d=a;for(let a=0;a<h;a+=1){let h=n[0]*c[a];for(let e=1;e<i;e+=1){const s=d-e&l-1;h+=n[e]*r[s],h-=t[e]*o[s]}for(let t=i;t<s;t+=1)h+=n[t]*r[d-t&l-1];for(let n=i;n<e;n+=1)h-=t[n]*o[d-n&l-1];r[d]=c[a],o[d]=h,d=d+1&l-1,u[a]=h}return d},zn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Gn=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Yn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},Hn=(t,e)=>{Yn(t,e,"channelCount"),Yn(t,e,"channelCountMode"),Yn(t,e,"channelInterpretation")},Zn=t=>"function"==typeof t.getFloatTimeDomainData,Qn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},Jn=t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})},Kn=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},ts=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),es=async(t,e)=>new t(await(t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})))(e)),ns=(t,e)=>{const n=t.createBiquadFilter();return Hn(n,e),Qn(n,e,"Q"),Qn(n,e,"detune"),Qn(n,e,"frequency"),Qn(n,e,"gain"),Yn(n,e,"type"),n},ss=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Hn(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Bn()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw Bn()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw Bn()}})})(n),n},is=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),rs=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Hn(n,e),Qn(n,e,"delayTime"),n},os=(t,e)=>{const n=t.createGain();return Hn(n,e),Qn(n,e,"gain"),n};function as(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function ls(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const cs=(t,e,n,s)=>t.createScriptProcessor(e,n,s),us=()=>new DOMException("","NotSupportedError"),hs={numberOfChannels:1},ds={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ps={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},fs={disableNormalization:!1},ms={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},gs={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},_s=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},vs=(t,e,n,s)=>{let i=Object.getPrototypeOf(t);for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},ys=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;ys(t,e,n+1e-7)}},ws=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},xs=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},bs=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Ts=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),is(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},Cs=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},As=(t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],(t=>t[0]===n&&t[1]===s),o)})(an),ks=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)})(an),Ss=(t=>(e,n,s,i)=>t(e[i],(t=>t[0]===n&&t[1]===s)))($e),Os=new WeakMap,Ms=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(Os),Es=(Ds=new Map,Is=new WeakMap,(t,e)=>{const n=Is.get(t);if(void 0!==n)return n;const s=Ds.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(Ds.set(t,n),n.catch((()=>!1)).then((e=>(Ds.delete(t),Is.set(t,e),e)))):(Is.set(t,n),n)}catch{return Is.set(t,!1),!1}});var Ds,Is;const Rs="undefined"==typeof window?null:window,Ns=((t,e)=>(n,s)=>{const i=n.createAnalyser();if(Hn(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Yn(i,s,"fftSize"),Yn(i,s,"maxDecibels"),Yn(i,s,"minDecibels"),Yn(i,s,"smoothingTimeConstant"),t(Zn,(()=>Zn(i)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(i),i})(Es,Ge),Ps=(t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(tn),Vs=((t,e,n)=>async(s,i,r,o)=>{const a=t(s),l=[...o,s];await Promise.all(a.activeInputs.map(((t,o)=>Array.from(t).filter((([t])=>!l.includes(t))).map((async([t,a])=>{const c=e(t),u=await c.render(t,i,l),h=s.context.destination;n(t)||s===h&&n(s)||u.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(tn,Ps,vn),$s=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Xe(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(Ns,gn,Vs),qs=(Ls=ke,t=>{const e=Ls.get(t);if(void 0===e)throw Bn();return e});var Ls;const Fs=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(Rs),js=(t=>e=>null!==t&&e instanceof t)(Fs),Bs=new WeakMap,Ws=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}})(Cs),Us=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(Rs),Xs=(t=>e=>null!==t&&e instanceof t)(Us),zs=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(Rs),Gs=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(Rs),Ys=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f)=>class extends c{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=u(e);h(o)&&!0!==n(wn,(()=>wn(o)))&&(t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=bn(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"==typeof s)for(const[t,n]of e){const i=n.filter((t=>t.output!==s));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,s]of e)s.forEach((e=>{bn(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})(t.disconnect)})(i),Te.set(this,i),Se.set(this,new Set),"closed"!==e.state&&s&&Fe(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=u(this._context),h=f(c);if(d(t)||p(t))throw r();if(rn(t)){const i=gn(t);try{const e=hn(this._nativeAudioNode,i,n,a),s=yn(this);(h||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&yn(t)&&Fe(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,h)){const e=l([this],t);xn(e,s(h))}return t}const m=_n(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||yn(this))&&this._nativeAudioNode.disconnect(m,n)}catch(t){if(12===t.code)throw r();throw t}if(Tn(this,t,n,h)){const e=l([this],t);xn(e,s(h))}}disconnect(t,e,n){let s;const o=u(this._context),c=f(o);if(void 0===t)s=((t,e)=>{const n=tn(t),s=[];for(const i of n.outputs)on(i)?Cn(t,e,...i):An(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=tn(t),i=[];for(const r of s.outputs)r[1]===n&&(on(r)?Cn(t,e,...r):An(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(rn(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=tn(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i))).map((n=>(on(n)?Cn(t,e,...n):An(t,e,...n),r.outputs.delete(n),n[0])))})(this,c,t,e,n),0===s.length)throw r()}for(const t of s){const e=l([this],t);xn(e,a)}}})((Hs=be,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Hs.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,l,c,u,h,d)=>{const p=new WeakMap;return(f,m,g,_,v)=>{const{activeInputs:y,passiveInputs:w}=r(m),{outputs:x}=r(f),b=a(f),T=r=>{const a=l(m),c=l(f);if(r){const e=qe(w,f,g,_);t(y,f,e,!1),v||h(f)||n(c,a,g,_),d(m)&&Fe(m)}else{const t=s(y,f,g,_);e(w,_,t,!1),v||h(f)||i(c,a,g,_);const n=o(m);if(0===n)u(m)&&We(m,y);else{const t=p.get(m);void 0!==t&&clearTimeout(t),p.set(m,setTimeout((()=>{u(m)&&We(m,y)}),1e3*n))}}};return!!c(x,[m,g,_],(t=>t[0]===m&&t[1]===g&&t[2]===_),!0)&&(b.add(T),u(f)?t(y,f,[g,_,T],!0):e(w,_,[f,g,T],!0),!0)}})(As,ks,hn,Ss,mn,tn,Ms,Le,gn,an,Je,vn,yn),Es,((t,e,n,s,i,r)=>o=>(a,l)=>{const c=t.get(a);if(void 0===c){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(on(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,l)}else t.set(a,c+l)})(Oe,mn,tn,gn,_n,Je),Ge,Wn,us,((t,e,n,s,i,r,o,a)=>(l,c)=>{const u=e.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(l.context),d=a(h);if(u===c){if(e.delete(l),!d&&o(l)){const e=s(l),{outputs:r}=n(l);for(const n of r)if(on(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(l,u-c)})(hn,Oe,tn,gn,_n,qs,Je,js),((t,e,n)=>function s(i,r){const o=rn(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(Bs,tn,Ve),Ws,qs,Xs,zs,Gs,js);var Hs;const Zs=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...Ue,...n},l=s(o,a);super(t,!1,l,r(o)?e():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ys,$s,Ge,Ns,qs,js),Qs=new WeakSet,Js=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(Rs),Ks=(ti=new Uint32Array(1),t=>(ti[0]=t,ti[0]));var ti;const ei=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=s.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)s[t]=c[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=s.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)c[t+o]=s[t]}})(Ks,Ge),ni=(t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)})(Ks),si=((t,e,n,s,i,r,o,a)=>{let l=null;return class c{constructor(c){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:d}={...He,...c};null===l&&(l=new i(1,1,44100));const p=null!==s&&e(r,r)?new s({length:u,numberOfChannels:h,sampleRate:d}):l.createBuffer(h,u,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(o(p),Ye(p)):e(ze,(()=>ze(p)))||a(p),t.add(p),p}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===c.prototype||t.has(e)}}})(Qs,Es,us,Js,Fs,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Js),ei,ni),ii=(t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(os),ri=((t,e,n)=>async(s,i,r,o)=>{const a=e(s);await Promise.all(Array.from(a.activeInputs).map((async([e,s])=>{const a=t(e),l=await a.render(e,i,o);n(e)||l.connect(r,s)})))})(Ps,en,vn),oi=(t=>(e,n,s,i)=>t(n,e,s,i))(ri),ai=((t,e,n,s,i,r,o,a,l,c,u)=>(h,d)=>{const p=h.createBufferSource();return Hn(p,d),Qn(p,d,"playbackRate"),Yn(p,d,"buffer"),Yn(p,d,"loop"),Yn(p,d,"loopEnd"),Yn(p,d,"loopStart"),e(n,(()=>n(h)))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw Bn();e.call(t,s,i,r),n=!0}})(t.start)})(p),e(s,(()=>s(h)))||l(p),e(i,(()=>i(h)))||c(p,h),e(r,(()=>r(h)))||Jn(p),e(o,(()=>o(h)))||u(p,h),e(a,(()=>a(h)))||Kn(p),t(h,p),p})(ii,Es,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),ws,xs,bs,(t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})}),(t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",(t=>()=>{const n=t.call(e);return n===s?null:n}),(t=>n=>t.call(e,null===n?s:n)))})(vs),Ts),li=((t,e)=>(n,s,i,r)=>(t(s).replay(i),e(s,n,i,r)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(en),ri),ci=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c,u){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(l,c,u)=>{let h=n(l);const d=Xe(h,c);if(!d){const t={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(c,t),null!==o&&h.start(...o),null!==a&&h.stop(a)}return r.set(c,h),d?await t(c,l.playbackRate,h.playbackRate,u):await s(c,l.playbackRate,h.playbackRate,u),await i(l,c,h,u),h})(l,c,u)}}})(oi,ai,gn,li,Vs),ui=((t,e,n,s,i,r,o,a,l,c,u,h,d)=>(p,f,m,g=null,_=null)=>{const v=new we.AutomationEventList(m.defaultValue),y=f?s(v):null,w={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,w.setValueAtTime(t,p.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===y&&v.flush(p.context.currentTime),v.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(v).pop();null===y&&v.flush(p.context.currentTime),v.add(i(t));const n=Array.from(v).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return w},cancelScheduledValues:t=>(null===y&&v.flush(p.context.currentTime),v.add(r(t)),m.cancelScheduledValues(t),w),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===y&&v.flush(p.context.currentTime),v.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),w},linearRampToValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(a(t,e)),m.linearRampToValueAtTime(t,e),w),setTargetAtTime:(t,e,n)=>(null===y&&v.flush(p.context.currentTime),v.add(l(t,e,n)),m.setTargetAtTime(t,e,n),w),setValueAtTime:(t,e)=>(null===y&&v.flush(p.context.currentTime),v.add(c(t,e)),m.setValueAtTime(t,e),w),setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,i=p.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,l=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(s.length-1)/n*((r+t)/i-e),a=Math.floor(o),c=Math.ceil(o);l[t]=a===c?s[a]:(1-(o-a))*s[a]+(1-(c-o))*s[c]}null===y&&v.flush(p.context.currentTime),v.add(u(l,e,n)),m.setValueCurveAtTime(l,e,n);const c=o/i;c<t&&d(w,l[l.length-1],c),d(w,s[s.length-1],t)}else null===y&&v.flush(p.context.currentTime),v.add(u(s,e,n)),m.setValueCurveAtTime(s,e,n);return w}};return n.set(w,m),e.set(w,p),t(w,y),w})((hi=Ce,(t,e)=>{hi.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),Bs,Ae,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}})),we.createCancelAndHoldAutomationEvent,we.createCancelScheduledValuesAutomationEvent,we.createExponentialRampToValueAutomationEvent,we.createLinearRampToValueAutomationEvent,we.createSetTargetAutomationEvent,we.createSetValueAutomationEvent,we.createSetValueCurveAutomationEvent,Us,ys);var hi;const di=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),l={...Ke,...s},c=i(a,l),u=o(a),h=u?e():null;super(t,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,u,c.playbackRate,Qe,Ze)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),Je(this)&&Be(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ys,ci,ui,Bn,ai,qs,js,Cs),pi=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),l=o(s),c=i(s,n,l);super(t,!1,c,l?e(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ys,(t=>{let e=null;return{render:(n,s,i)=>(null===e&&(e=(async(e,n,s)=>{const i=n.destination;return await t(e,n,i,s),i})(n,s,i)),e)}}),Ge,Bn,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(os,vs),qs,js,Vs),fi=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Xe(c,a);if(!u){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return r.set(a,c),u?(await t(a,o.Q,c.Q,l),await t(a,o.detune,c.detune,l),await t(a,o.frequency,c.frequency,l),await t(a,o.gain,c.gain,l)):(await s(a,o.Q,c.Q,l),await s(a,o.detune,c.detune,l),await s(a,o.frequency,c.frequency,l),await s(a,o.gain,c.gain,l)),await i(o,a,c,l),c})(o,a,l)}}})(oi,ns,gn,li,Vs),mi=(t=>(e,n)=>t.set(e,n))(Os),gi=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const l=r(t),c={...In,...s},u=i(l,c),h=o(l);super(t,!1,u,h?n():null),this._Q=e(this,h,u.Q,Qe,Ze),this._detune=e(this,h,u.detune,1200*Math.log2(Qe),-1200*Math.log2(Qe)),this._frequency=e(this,h,u.frequency,t.sampleRate/2,0),this._gain=e(this,h,u.gain,40*Math.log10(Qe),Ze),this._nativeBiquadFilterNode=u,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw s();throw t}if(t.length!==e.length||e.length!==n.length)throw s()}})(Ys,ui,fi,Wn,ns,qs,js,mi),_i=((t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,l=0)=>{const c=0===r.size;if(e(o))return i.call(n,o,a,l),t(r,[o,a,l],(t=>t[0]===o&&t[1]===a&&t[2]===l),!0),c&&s(),o;i.call(n,o,a),t(r,[o,a],(t=>t[0]===o&&t[1]===a),!0),c&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const l=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"==typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const c=0===r.size;l&&c&&i()})(n.disconnect),n})(an,zs),vi=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),Hn(i,s),i})(Us,((t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(s,(()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)}),(()=>i.disconnect(s)))})(Bn,_i)),yi=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={...Rn,...r};super(t,!1,n(o,a),i(o)?e():null)}})(Ys,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Xe(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(vi,gn,Vs),vi,qs,js),wi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l=r({...Nn,...o});super(t,!1,n(a,l),i(a)?e():null)}})(Ys,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Xe(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(ss,gn,Vs),ss,qs,js,(t=>({...t,channelCount:t.numberOfOutputs}))),xi=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),l=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(t){l.onended=t},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2]),start(t=0){l.start.call(l,t)},stop(t=0){l.stop.call(l,t)}};return t(i,l),s(is(h,c),(()=>l.connect(c)),(()=>l.disconnect(c)))})(ii,ai,os,_i),bi=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Hn(a,o),Qn(a,o,"offset"),e(s,(()=>s(r)))||Jn(a),e(i,(()=>i(r)))||Kn(a),t(r,a),a})(ii,Es,xi,ws,bs),Ti=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),l={...Pn,...o},c=s(a,l),u=r(a),h=u?n():null;super(t,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=e(this,u,c.offset,Qe,Ze),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),Je(this)&&Be(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ys,ui,((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c,u){const h=r.get(c);return void 0!==h?Promise.resolve(h):(async(l,c,u)=>{let h=n(l);const d=Xe(h,c);if(!d){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(c,t),null!==o&&h.start(o),null!==a&&h.stop(a)}return r.set(c,h),d?await t(c,l.offset,h.offset,u):await s(c,l.offset,h.offset,u),await i(l,c,h,u),h})(l,c,u)}}})(oi,bi,gn,li,Vs),bi,qs,js,Cs),Ci=((t,e)=>(n,s)=>{const i=n.createConvolver();if(Hn(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Yn(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(us,vs),Ai=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l={...Vn,...o},c=n(a,l);super(t,!1,c,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&r(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ys,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Xe(a,r)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(r,e)}return s.set(r,a),un(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(Ci,gn,Vs),Ci,qs,js,mi),ki=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const l=i(t),c={...qn,...a},u=s(l,c),h=r(l);super(t,!1,u,h?n(c.maxDelayTime):null),this._delayTime=e(this,h,u.delayTime),o(this,c.maxDelayTime)}get delayTime(){return this._delayTime}})(Ys,ui,((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,l,c){const u=o.get(l);return void 0!==u?Promise.resolve(u):(async(a,l,c)=>{let u=n(a);const h=Xe(u,l);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,t)}return o.set(l,u),h?await t(l,a.delayTime,u.delayTime,c):await s(l,a.delayTime,u.delayTime,c),await i(a,l,u,c),u})(a,l,c)}}})(oi,rs,gn,li,Vs),rs,qs,js,mi),Si=(t=>(e,n)=>{const s=e.createDynamicsCompressor();if(Hn(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return Qn(s,n,"attack"),Qn(s,n,"knee"),Qn(s,n,"ratio"),Qn(s,n,"release"),Qn(s,n,"threshold"),s})(us),Oi=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const l=r(t),c={...Fn,...i},u=s(l,c),h=o(l);super(t,!1,u,h?n():null),this._attack=e(this,h,u.attack),this._knee=e(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,h,u.ratio),this._release=e(this,h,u.release),this._threshold=e(this,h,u.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ys,ui,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Xe(c,a);if(!u){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return r.set(a,c),u?(await t(a,o.attack,c.attack,l),await t(a,o.knee,c.knee,l),await t(a,o.ratio,c.ratio,l),await t(a,o.release,c.release,l),await t(a,o.threshold,c.threshold,l)):(await s(a,o.attack,c.attack,l),await s(a,o.knee,c.knee,l),await s(a,o.ratio,c.ratio,l),await s(a,o.release,c.release,l),await s(a,o.threshold,c.threshold,l)),await i(o,a,c,l),c})(o,a,l)}}})(oi,Si,gn,li,Vs),Si,us,qs,js,mi),Mi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),l={...jn,...o},c=s(a,l),u=r(a);super(t,!1,c,u?n():null),this._gain=e(this,u,c.gain,Qe,Ze)}get gain(){return this._gain}})(Ys,ui,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Xe(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.gain,c.gain,l):await s(a,o.gain,c.gain,l),await i(o,a,c,l),c})(o,a,l)}}})(oi,os,gn,li,Vs),os,qs,js),Ei=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=ts(r,i.sampleRate),d=c instanceof Float64Array?c:new Float64Array(c),p=u instanceof Float64Array?u:new Float64Array(u),f=d.length,m=p.length,g=Math.min(f,m);if(0===f||f>20)throw s();if(0===d[0])throw e();if(0===m||m>20)throw s();if(0===p[0])throw e();if(1!==d[0]){for(let t=0;t<m;t+=1)p[t]/=d[0];for(let t=1;t<f;t+=1)d[t]/=d[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=l;const v=[],y=[],w=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),w.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);v[t]=Xn(d,f,p,m,g,y[t],w[t],v[t],32,s,i)}};const x=i.sampleRate/2;return is({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/x),r=[Math.cos(i),Math.sin(i)],o=as(ls(p,r),ls(d,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(Wn,Bn,cs,us),Di=((t,e,n,s)=>i=>t(Gn,(()=>Gn(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(Es,os,cs,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(os,Fs)),Ii=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let l=null;const c=async(c,u,h)=>{let d=null,p=e(c);const f=Xe(p,u);if(void 0===u.createIIRFilter?d=t(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=u.createIIRFilter(o,r)),a.set(u,null===d?p:d),null!==d){if(null===l){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,u.sampleRate);l=(async()=>{await s(c,t,t.destination,h);return((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,l=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const c=new Float32Array(32),u=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let e=0;e<d;e+=1){const n=t.getChannelData(e),s=h.getChannelData(e);c.fill(0),u.fill(0),Xn(i,o,r,a,l,c,u,0,32,n,s)}return h})(await i(t),u,r,o)})()}const t=await l;return d.buffer=t,d.start(0),d}return await s(c,u,p,h),p};return{render(t,e,n){const s=a.get(e);return void 0!==s?Promise.resolve(s):c(t,e,n)}}})(ai,gn,Fs,Vs,Di),Ri=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),l=i(a),c={...Un,...o},u=e(a,l?null:t.baseLatency,c);super(t,!1,u,l?n(c.feedback,c.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw Wn();return e.call(t,n,s,i)})})(u),this._nativeIIRFilterNode=u,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Ys,(t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Hn(i,s),i})(Ei),Ii,qs,js,mi),Ni=((t,e,n,s,i)=>(r,o)=>{const a=o.listener,{forwardX:l,forwardY:c,forwardZ:u,positionX:h,positionY:d,positionZ:p,upX:f,upY:m,upZ:g}=void 0===a.forwardX?(()=>{const l=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),c=i(o),u=s(o,256,9,0),h=(e,s)=>{const i=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});return i.connect(l,0,e),i.start(),Object.defineProperty(i.offset,"defaultValue",{get:()=>s}),t({context:r},c,i.offset,Qe,Ze)};let d=[0,0,-1,0,1,0],p=[0,0,0];return u.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some(((t,e)=>t!==d[e]))&&(a.setOrientation(...e),d=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some(((t,e)=>t!==p[e]))&&(a.setPosition(...n),p=n)},l.connect(u),{forwardX:h(0,0),forwardY:h(1,0),forwardZ:h(2,-1),positionX:h(6,0),positionY:h(7,0),positionZ:h(8,0),upX:h(3,0),upY:h(4,1),upZ:h(5,0)}})():a;return{get forwardX(){return l},get forwardY(){return c},get forwardZ(){return u},get positionX(){return h},get positionY(){return d},get positionZ(){return p},get upX(){return f},get upY(){return m},get upZ(){return g}}})(ui,vi,bi,cs,js),Pi=new WeakMap,Vi=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,ke.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(pi,Ni,Ws,js,Pi,Cs),$i=((t,e,n,s,i,r)=>(o,a)=>{const l=o.createOscillator();return Hn(l,a),Qn(l,a,"detune"),Qn(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):Yn(l,a,"type"),e(n,(()=>n(o)))||Jn(l),e(s,(()=>s(o)))||r(l,o),e(i,(()=>i(o)))||Kn(l),t(o,l),l})(ii,Es,ws,xs,bs,Ts),qi=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){l=t},render(c,u,h){const d=r.get(u);return void 0!==d?Promise.resolve(d):(async(c,u,h)=>{let d=n(c);const p=Xe(d,u);if(!p){const t={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:null===o?void 0:o,type:d.type};d=e(u,t),null!==a&&d.start(a),null!==l&&d.stop(l)}return r.set(u,d),p?(await t(u,c.detune,d.detune,h),await t(u,c.frequency,d.frequency,h)):(await s(u,c.detune,d.detune,h),await s(u,c.frequency,d.frequency,h)),await i(c,u,d,h),d})(c,u,h)}}})(oi,$i,gn,li,Vs),Li=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),l={...ds,...o},c=n(a,l),u=r(a),h=u?s():null,d=t.sampleRate/2;super(t,!1,c,h),this._detune=e(this,u,c.detune,153600,-153600),this._frequency=e(this,u,c.frequency,d,-d),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){Fe(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),Je(this)&&Be(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ys,ui,$i,qi,qs,js,Cs),Fi=(t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(ai),ji=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...l})=>{const c=r.createWaveShaper(),u=r.createWaveShaper();Hn(c,l),Hn(u,l);const h=n(r,{...l,gain:1}),d=n(r,{...l,gain:-1}),p=n(r,{...l,gain:1}),f=n(r,{...l,gain:-1});let m=null,g=!1,_=null;const v={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){h.channelCount=t,d.channelCount=t,c.channelCount=t,p.channelCount=t,u.channelCount=t,f.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){h.channelCountMode=t,d.channelCountMode=t,c.channelCountMode=t,p.channelCountMode=t,u.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,d.channelInterpretation=t,c.channelInterpretation=t,p.channelInterpretation=t,u.channelInterpretation=t,f.channelInterpretation=t},get context(){return c.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)c.curve=n,u.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,l=Math.floor(a),c=Math.ceil(a);e[o]=l===c?n[l]:(1-(a-l))*n[l]+(1-(c-a))*n[c],s[o]=l===c?-n[t-1-l]:-(1-(a-l))*n[t-1-l]-(1-(c-a))*n[t-1-c]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,c.curve=e,u.curve=s}_=n,g&&(s(_)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(t){c.oversample=t,u.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a);return i(is(v,p),(()=>{h.connect(c).connect(p),h.connect(d).connect(u).connect(f).connect(p),g=!0,s(_)&&(m=t(r,h))}),(()=>{h.disconnect(c),c.disconnect(p),h.disconnect(d),d.disconnect(u),u.disconnect(f),f.disconnect(p),g=!1,null!==m&&(m(),m=null)}))})(Fi,Bn,os,_s,_i),Bi=((t,e,n,s,i,r,o)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,l);Hn(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw e();Yn(c,{curve:u},"curve"),Yn(c,l,"oversample");let h=null,d=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),d&&(s(n)&&null===h?h=t(a,c):s(n)||null===h||(h(),h=null)),n)));return i(c,(()=>{d=!0,s(c.curve)&&(h=t(a,c))}),(()=>{d=!1,null!==h&&(h(),h=null)}))})(Fi,Bn,ji,_s,_i,Us,vs),Wi=(t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(Hn(s,n),Qn(s,n,"orientationX"),Qn(s,n,"orientationY"),Qn(s,n,"orientationZ"),Qn(s,n,"positionX"),Qn(s,n,"positionY"),Qn(s,n,"positionZ"),Yn(s,n,"coneInnerAngle"),Yn(s,n,"coneOuterAngle"),Yn(s,n,"coneOuterGain"),Yn(s,n,"distanceModel"),Yn(s,n,"maxDistance"),Yn(s,n,"panningModel"),Yn(s,n,"refDistance"),Yn(s,n,"rolloffFactor"),s)})(((t,e,n,s,i,r,o,a,l)=>(c,{coneInnerAngle:u,coneOuterAngle:h,coneOuterGain:d,distanceModel:p,maxDistance:f,orientationX:m,orientationY:g,orientationZ:_,panningModel:v,positionX:y,positionY:w,positionZ:x,refDistance:b,rolloffFactor:T,...C})=>{const A=c.createPanner();if(C.channelCount>2)throw o();if("max"===C.channelCountMode)throw o();Hn(A,C);const k={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},S=n(c,{...k,channelInterpretation:"speakers",numberOfInputs:6}),O=s(c,{...C,gain:1}),M=s(c,{...k,gain:1}),E=s(c,{...k,gain:0}),D=s(c,{...k,gain:0}),I=s(c,{...k,gain:0}),R=s(c,{...k,gain:0}),N=s(c,{...k,gain:0}),P=i(c,256,6,1),V=r(c,{...k,curve:new Float32Array([1,1]),oversample:"none"});let $=[m,g,_],q=[y,w,x];P.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some(((t,e)=>t!==$[e]))&&(A.setOrientation(...e),$=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some(((t,e)=>t!==q[e]))&&(A.setPosition(...n),q=n)},Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0});const L={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(t){if(t>2)throw o();O.channelCount=t,A.channelCount=t},get channelCountMode(){return A.channelCountMode},set channelCountMode(t){if("max"===t)throw o();O.channelCountMode=t,A.channelCountMode=t},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(t){O.channelInterpretation=t,A.channelInterpretation=t},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(t){A.coneInnerAngle=t},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(t){A.coneOuterAngle=t},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();A.coneOuterGain=t},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(t){A.distanceModel=t},get inputs(){return[O]},get maxDistance(){return A.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;A.maxDistance=t},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return E.gain},get orientationZ(){return D.gain},get panningModel(){return A.panningModel},set panningModel(t){A.panningModel=t},get positionX(){return I.gain},get positionY(){return R.gain},get positionZ(){return N.gain},get refDistance(){return A.refDistance},set refDistance(t){if(t<0)throw new RangeError;A.refDistance=t},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;A.rolloffFactor=t},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])};u!==L.coneInnerAngle&&(L.coneInnerAngle=u),h!==L.coneOuterAngle&&(L.coneOuterAngle=h),d!==L.coneOuterGain&&(L.coneOuterGain=d),p!==L.distanceModel&&(L.distanceModel=p),f!==L.maxDistance&&(L.maxDistance=f),m!==L.orientationX.value&&(L.orientationX.value=m),g!==L.orientationY.value&&(L.orientationY.value=g),_!==L.orientationZ.value&&(L.orientationZ.value=_),v!==L.panningModel&&(L.panningModel=v),y!==L.positionX.value&&(L.positionX.value=y),w!==L.positionY.value&&(L.positionY.value=w),x!==L.positionZ.value&&(L.positionZ.value=x),b!==L.refDistance&&(L.refDistance=b),T!==L.rolloffFactor&&(L.rolloffFactor=T),1===$[0]&&0===$[1]&&0===$[2]||A.setOrientation(...$),0===q[0]&&0===q[1]&&0===q[2]||A.setPosition(...q);return l(is(L,A),(()=>{O.connect(A),t(O,V,0,0),V.connect(M).connect(S,0,0),V.connect(E).connect(S,0,1),V.connect(D).connect(S,0,2),V.connect(I).connect(S,0,3),V.connect(R).connect(S,0,4),V.connect(N).connect(S,0,5),S.connect(P).connect(c.destination)}),(()=>{O.disconnect(A),a(O,V,0,0),V.disconnect(M),M.disconnect(S),V.disconnect(E),E.disconnect(S),V.disconnect(D),D.disconnect(S),V.disconnect(I),I.disconnect(S),V.disconnect(R),R.disconnect(S),V.disconnect(N),N.disconnect(S),S.disconnect(P),P.disconnect(c.destination)}))})(hn,Bn,vi,os,cs,Bi,us,mn,_i)),Ui=((t,e,n,s,i,r,o,a,l,c)=>()=>{const u=new WeakMap;let h=null;return{render(d,p,f){const m=u.get(p);return void 0!==m?Promise.resolve(m):(async(d,p,f)=>{let m=null,g=r(d);const _={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},v={..._,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=Xe(g,p);if("bufferSize"in g)m=s(p,{..._,gain:1});else if(!y){const t={...v,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,t)}if(u.set(p,null===m?g:m),null!==m){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,d.context.length,p.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),h=(async()=>{const e=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset,f),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return c(t)})()}const t=await h,r=s(p,{..._,gain:1});await l(d,p,r,f);const u=[];for(let e=0;e<t.numberOfChannels;e+=1)u.push(t.getChannelData(e));let g=[u[0][0],u[1][0],u[2][0]],y=[u[3][0],u[4][0],u[5][0]],w=s(p,{..._,gain:1}),x=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]});r.connect(w).connect(x.inputs[0]),x.connect(m);for(let e=128;e<t.length;e+=128){const t=[u[0][e],u[1][e],u[2][e]],n=[u[3][e],u[4][e],u[5][e]];if(t.some(((t,e)=>t!==g[e]))||n.some(((t,e)=>t!==y[e]))){g=t,y=n;const o=e/p.sampleRate;w.gain.setValueAtTime(0,o),w=s(p,{..._,gain:0}),x=i(p,{...v,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),w.gain.setValueAtTime(1,o),r.connect(w).connect(x.inputs[0]),x.connect(m)}}return m}return y?(await t(p,d.orientationX,g.orientationX,f),await t(p,d.orientationY,g.orientationY,f),await t(p,d.orientationZ,g.orientationZ,f),await t(p,d.positionX,g.positionX,f),await t(p,d.positionY,g.positionY,f),await t(p,d.positionZ,g.positionZ,f)):(await a(p,d.orientationX,g.orientationX,f),await a(p,d.orientationY,g.orientationY,f),await a(p,d.orientationZ,g.orientationZ,f),await a(p,d.positionX,g.positionX,f),await a(p,d.positionY,g.positionY,f),await a(p,d.positionZ,g.positionZ,f)),un(g)?await l(d,p,g.inputs[0],f):await l(d,p,g,f),g})(d,p,f)}}})(oi,vi,bi,os,Wi,gn,Fs,li,Vs,Di),Xi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const l=i(t),c={...ps,...a},u=n(l,c),h=r(l);super(t,!1,u,h?s():null),this._nativePannerNode=u,this._orientationX=e(this,h,u.orientationX,Qe,Ze),this._orientationY=e(this,h,u.orientationY,Qe,Ze),this._orientationZ=e(this,h,u.orientationZ,Qe,Ze),this._positionX=e(this,h,u.positionX,Qe,Ze),this._positionY=e(this,h,u.positionY,Qe,Ze),this._positionZ=e(this,h,u.positionZ,Qe,Ze),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ys,ui,Wi,Ui,qs,js,mi),zi=((t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...fs,...r}),l=t(o,a);return n.add(l),l}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(Ge),qs,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),Gi=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return Hn(r,s),Qn(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(((t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},h=(t,r,h,d,p)=>{if(1===r)return((t,e,i,r)=>{const h=new Float32Array(o),d=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*l;h[t]=Math.cos(e),d[t]=Math.sin(e)}const p=n(t,{...c,gain:0}),f=s(t,{...u,curve:h}),m=s(t,{...u,curve:a}),g=n(t,{...c,gain:0}),_=s(t,{...u,curve:d});return{connectGraph(){e.connect(p),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(g),m.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===_.inputs?_:_.inputs[0]),f.connect(p.gain),_.connect(g.gain),p.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){e.disconnect(p),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(g),m.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===_.inputs?_:_.inputs[0]),f.disconnect(p.gain),_.disconnect(g.gain),p.disconnect(r,0,0),g.disconnect(r,0,1)}}})(t,h,d,p);if(2===r)return((t,i,r,h)=>{const d=new Float32Array(o),p=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),g=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>g){const e=(t-g)/(16384-g)*l;d[t]=Math.cos(e),p[t]=Math.sin(e),f[t]=0,m[t]=1}else{const e=t/(16384-g)*l;d[t]=1,p[t]=0,f[t]=Math.cos(e),m[t]=Math.sin(e)}const _=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(t,{...c,gain:0}),y=s(t,{...u,curve:d}),w=n(t,{...c,gain:0}),x=s(t,{...u,curve:p}),b=s(t,{...u,curve:a}),T=n(t,{...c,gain:0}),C=s(t,{...u,curve:f}),A=n(t,{...c,gain:0}),k=s(t,{...u,curve:m});return{connectGraph(){i.connect(_),i.connect(void 0===b.inputs?b:b.inputs[0]),_.connect(v,0),_.connect(w,0),_.connect(T,1),_.connect(A,1),b.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===x.inputs?x:x.inputs[0]),r.connect(void 0===C.inputs?C:C.inputs[0]),r.connect(void 0===k.inputs?k:k.inputs[0]),y.connect(v.gain),x.connect(w.gain),C.connect(T.gain),k.connect(A.gain),v.connect(h,0,0),T.connect(h,0,0),w.connect(h,0,1),A.connect(h,0,1)},disconnectGraph(){i.disconnect(_),i.disconnect(void 0===b.inputs?b:b.inputs[0]),_.disconnect(v,0),_.disconnect(w,0),_.disconnect(T,1),_.disconnect(A,1),b.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===x.inputs?x:x.inputs[0]),r.disconnect(void 0===C.inputs?C:C.inputs[0]),r.disconnect(void 0===k.inputs?k:k.inputs[0]),y.disconnect(v.gain),x.disconnect(w.gain),C.disconnect(T.gain),k.disconnect(A.gain),v.disconnect(h,0,0),T.disconnect(h,0,0),w.disconnect(h,0,1),A.disconnect(h,0,1)}}})(t,h,d,p);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...l})=>{if("max"===o)throw i();const c=t(e,{...l,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=n(e,{...l,channelCount:s,channelCountMode:o,gain:1}),d=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:f}=h(e,s,u,d,c);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount!==t&&(g&&f(),({connectGraph:p,disconnectGraph:f}=h(e,t,u,d,c)),g&&p()),u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return d.gain},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};let g=!1;return r(is(m,c),(()=>{p(),g=!0}),(()=>{f(),g=!1}))}})(vi,ss,os,Bi,us,_i),us),Yi=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a,l)=>{let c=n(o);const u=Xe(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.pan,c.pan,l):await s(a,o.pan,c.pan,l),un(c)?await i(o,a,c.inputs[0],l):await i(o,a,c,l),c})(o,a,l)}}})(oi,Gi,gn,li,Vs),Hi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),l={...ms,...o},c=n(a,l),u=r(a);super(t,!1,c,u?s():null),this._pan=e(this,u,c.pan)}get pan(){return this._pan}})(Ys,ui,Gi,Yi,qs,js),Zi=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!Xe(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(r,e)}return s.set(r,a),un(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(Bi,gn,Vs),Qi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),l={...gs,...e},c=n(a,l);super(t,!0,c,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ys,Bn,Bi,Zi,qs,js,mi),Ji=(t=>null!==t&&t.isSecureContext)(Rs),Ki=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(Rs),tr=new WeakMap,er=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),t.set(n,s),s})(tr,Fs),nr=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(Rs),sr=Ji?((t,e,n,s,i,r,o,a,l,c,u,h)=>(d,p,f={credentials:"omit"})=>{const m=r(d);if(void 0!==m.audioWorklet)return Promise.all([i(p),Promise.resolve(t(u,u))]).then((([[t,e],n])=>{const[s,i]=Re(t,e),r=new Blob([`${s};((AudioWorkletProcessor,registerProcessor)=>{${i}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(r);return m.audioWorklet.addModule(l,f).then((()=>{if(a(m))return m;const t=o(m);return t.audioWorklet.addModule(l,f).then((()=>t))})).then((t=>{try{new AudioWorkletNode(t,"__sac")}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));const g=c.get(d);if(void 0!==g&&g.has(p))return Promise.resolve();const _=l.get(d);if(void 0!==_){const t=_.get(p);if(void 0!==t)return t}const v=i(p).then((([t,e])=>{const[s,i]=Re(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=h._AWGS.pop();if(void 0===t)throw new SyntaxError;s(m.currentTime,m.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=Me.get(m);if(void 0!==s){if(s.has(t))throw e();Pe(n),Ne(n.parameterDescriptors),s.set(t,n)}else Pe(n),Ne(n.parameterDescriptors),Me.set(m,new Map([[t,n]]))}),m.sampleRate,void 0,void 0)))}));return void 0===_?l.set(d,new Map([[p,v]])):_.set(p,v),v.then((()=>{const t=c.get(d);void 0===t?c.set(d,new Set([p])):t.add(p)})).finally((()=>{const t=l.get(d);void 0!==t&&t.delete(p)})),v})(Es,us,(t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=t.onerror,c=()=>{t.onerror=l,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(c(),s(o),!1):null!==l?l(e,n,i,r,o):void 0,r.onerror=()=>{c(),s(new SyntaxError)},r.onload=()=>{c(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(Rs),Ki,(t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()})((()=>new DOMException("","AbortError"))),qs,er,js,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(nr,Fs),Rs):void 0,ir=((t,e)=>n=>t(n)||e(n))(Xs,js),rr=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f,m,g,_,v,y)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(t=1){return new u(this,{maxDelayTime:t})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(t,e){return new p(this,{feedback:e,feedforward:t})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new _(this,{...n,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return c(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}})(sr,Zs,si,di,gi,yi,wi,Ti,Ai,((t,e,n,s,i,r,o,a,l,c,u)=>(h,d)=>{const p=o(h)?h:r(h);if(i.has(d)){const t=n();return Promise.reject(t)}try{i.add(d)}catch{}return e(l,(()=>l(p)))?p.decodeAudioData(d).then((n=>($n(d).catch((()=>{})),e(a,(()=>a(n)))||u(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await $n(d)}catch{}},r=t=>{n(t),i()};try{p.decodeAudioData(d,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),Ye(n)),t.add(n),i().then((()=>e(n)))}),(t=>{r(null===t?s():t)}))}catch(t){r(t)}}))})(Qs,Es,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,qs,ir,ze,Gn,ei,ni),ki,Oi,Mi,Ri,Vi,Li,Xi,zi,Hi,Qi),or=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ys,((t,e)=>t.createMediaElementSource(e.mediaElement)),qs,js),ar=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...zn,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ys,((t,e)=>{const n=t.createMediaStreamDestination();return Hn(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),qs,js),lr=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ys,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i}),qs,js),cr=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(Ys,((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(Bn,js),qs),ur=((t,e,n,s,i,r,o,a,l)=>class extends t{constructor(t={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new l(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw n();throw t}if(null===e)throw s();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===l.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),sn(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(rr,Bn,us,(()=>new DOMException("","UnknownError")),or,ar,lr,cr,Us),hr=(t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(Pi),dr=(t=>(e,n)=>{t(e).add(n)})(hr),pr=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return bn(n)?r.connect(n,0,i):r.connect(n,0)})(Ge),fr=(t=>(e,n)=>{t(e).delete(n)})(hr),mr=(t=>(e,n,s,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?Ln(t,e,n).disconnect():bn(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?Ln(t,e,s).disconnect(n,0):Ln(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):Ln(t,e,s).disconnect(n,0))(Ge),gr=new WeakMap,_r=((t,e)=>n=>e(t,n))(gr,Ve),vr=((t,e,n,s,i,r,o,a,l,c,u,h,d)=>(p,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw l();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some((t=>t<1)))throw l();if(_.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw l();const v=g.channelCount*g.numberOfInputs,y=_.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(v+w>6||y>6)throw l();const x=new MessageChannel,b=[],T=[];for(let t=0;t<g.numberOfInputs;t+=1)b.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(i(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const C=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of m.parameterDescriptors){const i=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?Qe:e},minValue:{get:()=>void 0===n?Ze:n}}),C.push(i)}const A=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+w)}),k=ts(f,p.sampleRate),S=a(p,k,v+w,Math.max(1,y)),O=i(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),M=[];for(let t=0;t<g.numberOfOutputs;t+=1)M.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[t]}));for(let t=0;t<g.numberOfInputs;t+=1){b[t].connect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[t].connect(A,e,t*g.channelCount+e)}const E=new kn(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=C[e];return n.connect(A,0,v+e),n.start(0),[t,n.offset]})));A.connect(S);let D=g.channelInterpretation,I=null;const R=0===g.numberOfOutputs?[S]:M,N={get bufferSize(){return k},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of b)e.channelInterpretation=t;D=t},get context(){return S.context},get inputs(){return b},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return I},set onprocessorerror(t){"function"==typeof I&&N.removeEventListener("processorerror",I),I="function"==typeof t?t:null,"function"==typeof I&&N.addEventListener("processorerror",I)},get parameters(){return E},get port(){return x.port2},addEventListener:(...t)=>S.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,R),disconnect:c.bind(null,R),dispatchEvent:(...t)=>S.dispatchEvent(t[0]),removeEventListener:(...t)=>S.removeEventListener(t[0],t[1],t[2])},P=new Map;var V,$;x.port1.addEventListener=(V=x.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=P.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(p.currentTime,p.sampleRate,(()=>e(t)))},P.set(e,t[1]))}}return V.call(x.port1,t[0],t[1],t[2])}),x.port1.removeEventListener=($=x.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=P.get(t[1]);void 0!==e&&(P.delete(t[1]),t[1]=e)}return $.call(x.port1,t[0],t[1],t[2])});let q=null;Object.defineProperty(x.port1,"onmessage",{get:()=>q,set:t=>{"function"==typeof q&&x.port1.removeEventListener("message",q),q="function"==typeof t?t:null,"function"==typeof q&&(x.port1.addEventListener("message",q),x.port1.start())}}),m.prototype.port=x.port1;let L=null;((t,e,n,s)=>{let i=Ee.get(t);void 0===i&&(i=new WeakMap,Ee.set(t,i));const r=es(n,s);return i.set(e,r),r})(p,N,m,g).then((t=>L=t));const F=En(g.numberOfInputs,g.channelCount),j=En(g.numberOfOutputs,_),B=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let W=!0;const U=()=>{g.numberOfOutputs>0&&S.disconnect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.disconnect(n,e+s,s);e+=_[t]}},X=new Map;S.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==L){const n=h(N);for(let s=0;s<k;s+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)On(t,F[e],n,n,s);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{On(t,B,e,v+n,s)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<_[t];e+=1)0===j[t][e].byteLength&&(j[t][e]=new Float32Array(128));try{const t=F.map(((t,e)=>{if(n[e].size>0)return X.set(e,k/128),t;const s=X.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?X.delete(e):X.set(e,s-1)),t)})),i=u(p.currentTime+s/p.sampleRate,p.sampleRate,(()=>L.process(t,j,B)));W=i;for(let t=0,n=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<_[t];i+=1)Mn(e,j[t],i,n+i,s);n+=_[t]}}catch(t){W=!1,N.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!W){for(let t=0;t<g.numberOfInputs;t+=1){b[t].disconnect(T[t]);for(let e=0;e<g.channelCount;e+=1)T[s].disconnect(A,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=C[e];t.disconnect(A,0,v+e),t.stop()}}A.disconnect(S),S.onaudioprocess=null,z?U():H();break}}}};let z=!1;const G=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Y=()=>S.connect(G).connect(p.destination),H=()=>{S.disconnect(G),G.disconnect()};return Y(),d(N,(()=>{if(W){H(),g.numberOfOutputs>0&&S.connect(O);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<_[t];s+=1)O.connect(n,e+s,s);e+=_[t]}}z=!0}),(()=>{W&&(Y(),U()),z=!1}))})(pr,Ge,Bn,vi,ss,bi,os,cs,us,mr,Ki,_r,_i),yr=((t,e,n,s,i)=>(r,o,a,l,c,u)=>{if(null!==a)try{const e=new a(r,l,u),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(d=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return d.call(e,"error",t[1],t[2]),d.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==u.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return i(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw s();throw t}var h,d;if(void 0===c)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(u),e(r,o,c,u)})(Bn,vr,os,us,_i),wr=((t,e,n,s,i,r,o,a,l,c,u,h,d,p,f,m)=>(g,_,v)=>{const y=new WeakMap;let w=null;return{render(x,b,T){a(b,x);const C=y.get(b);return void 0!==C?Promise.resolve(C):(async(a,x,b)=>{let T=u(a),C=null;const A=Xe(T,x),k=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=k.reduce(((t,e)=>t+e),0),n=i(x,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[t]}));const c=o(x,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=e.bind(null,r),c.disconnect=l.bind(null,r),C=[n,r,c]}else A||(T=new h(x,g));if(y.set(x,null===C?T:C[2]),null!==C){if(null===w){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,l=async()=>{const l=new d(n,128*Math.ceil(a.context.length/128),x.sampleRate),c=[],u=[];for(let t=0;t<_.numberOfInputs;t+=1)c.push(o(l,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(i(l,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await p(l,t,e.offset,b),e}))),g=s(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){c[t].connect(u[t]);for(let e=0;e<_.channelCount;e+=1)u[t].connect(g,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(l.destination),await Promise.all(c.map((t=>f(a,l,t,b)))),m(l)};w=Dn(a,0===n?null:await l(),x,_,k,v,c)}const t=await w,e=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,h]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(l);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=u[t];for(let s=0;s<k[t];s+=1)l.connect(n,e+s,s);e+=k[t]}return h}if(A)for(const[e,n]of a.parameters.entries())await t(x,n,T.parameters.get(e),b);else for(const[t,e]of a.parameters.entries())await p(x,e,T.parameters.get(t),b);return await f(a,x,T,b),T})(x,b,T)}}})(oi,pr,ai,vi,ss,bi,os,fr,mr,Ki,gn,nr,Fs,li,Vs,Di),xr=(t=>e=>t.get(e))(tr),br=(t=>(e,n)=>{t.set(e,n)})(gr),Tr=Ji?((t,e,n,s,i,r,o,a,l,c,u,h,d,p)=>class extends e{constructor(e,p,f){var m;const g=a(e),_=l(g),v=u({...Sn,...f});d(v);const y=Me.get(g),w=null==y?void 0:y.get(p),x=_||"closed"!==g.state?g:null!==(m=o(g))&&void 0!==m?m:g,b=i(x,_?null:e.baseLatency,c,p,w,v);super(e,!0,b,_?s(p,v,w):null);const T=[];b.parameters.forEach(((t,e)=>{const s=n(this,_,t);T.push([e,s])})),this._nativeAudioWorkletNode=b,this._onprocessorerror=null,this._parameters=new kn(T),_&&t(g,this);const{activeInputs:C}=r(this);h(b,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?p(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(dr,Ys,ui,wr,yr,tn,xr,qs,js,nr,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),br,(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}}),Cs):void 0,Cr=((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(us,Fs),Ar=((t,e,n,s,i,r,o,a)=>{const l=[];return(c,u)=>n(c).render(c,u,l).then((()=>Promise.all(Array.from(s(u)).map((t=>n(t).render(t,u,l)))))).then((()=>i(u))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),Ye(n)):e(r,(()=>r(n)))||a(n),t.add(n),n)))})(Qs,Es,Ps,hr,Di,ze,ei,ni),kr=((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:l}={...hs,...r},c=s(a,o,l);e(Gn,(()=>Gn(c)))||c.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(c.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(c,a),this._length=o,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,sn(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(rr,Es,Bn,Cr,Ar),Sr=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(ke,Xs),Or=((t,e)=>n=>t.has(n)||e(n))(Te,zs),Mr=((t,e)=>n=>t.has(n)||e(n))(Ae,Gs),Er=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(ke,js);function Dr(t,e){if(!t)throw new Error(e)}function Ir(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Rr(t){t.isOffline||"running"===t.state||Pr('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Nr=console;function Pr(...t){Nr.warn(...t)}function Vr(t){return void 0===t}function $r(t){return!Vr(t)}function qr(t){return"number"==typeof t}function Lr(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Fr(t){return Array.isArray(t)}function jr(t){return"string"==typeof t}function Br(t){return jr(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Wr="object"==typeof self?self:null,Ur=Wr&&(Wr.hasOwnProperty("AudioContext")||Wr.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function Xr(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function zr(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))}class Gr{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Yr(t){return Mr(t)}function Hr(t){return Or(t)}function Zr(t){return Er(t)}function Qr(t){return Sr(t)}function Jr(t){return t instanceof AudioBuffer}function Kr(t,e){return"value"===t||Yr(e)||Hr(e)||Jr(e)}function to(t,...e){if(!e.length)return t;const n=e.shift();if(Lr(t)&&Lr(n))for(const e in n)Kr(e,n[e])?t[e]=n[e]:Lr(n[e])?(t[e]||Object.assign(t,{[e]:{}}),to(t[e],n[e])):Object.assign(t,{[e]:n[e]});return to(t,...e)}function eo(t,e,n=[],s){const i={},r=Array.from(e);if(Lr(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(to(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&Lr(r[0]))to(i,r[0]);else for(let t=0;t<n.length;t++)$r(r[t])&&(i[n[t]]=r[t]);return to(t,i)}function no(t,e){return Vr(t)?e:t}function so(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}
/**
     * Tone.js
     * @author Yotam Mann
     * @license http://opensource.org/licenses/MIT MIT License
     * @copyright 2014-2019 Yotam Mann
     */class io{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Wr&&this.toString()===Wr.TONE_DEBUG_CLASS)&&function(...t){Nr.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}io.version=he;const ro=1e-6;function oo(t,e){return t>e+ro}function ao(t,e){return oo(t,e)||co(t,e)}function lo(t,e){return t+ro<e}function co(t,e){return Math.abs(t-e)<ro}class uo extends io{constructor(){super(),this.name="Timeline",this._timeline=[];const t=eo(uo.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Dr(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Dr(ao(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(co(this._timeline[e].time,t)){for(let n=e;n>=0&&co(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&ao(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(co(r[e],t)){for(let n=s;n<this._timeline.length;n++){if(!co(this._timeline[n][e],t))break;s=n}return s}if(lo(r[e],t)&&oo(o[e],t))return s;oo(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&co(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&co(this._timeline[e].time,t);e--)s=e;this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const ho=[];function po(t){ho.push(t)}const fo=[];function mo(t){fo.push(t)}class go extends io{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Vr(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Vr(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Vr(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(go.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class _o extends go{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class vo extends _o{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new uo,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=eo(vo.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new ur(t)}({latencyHint:t.latencyHint}),this._ticker=new Gr(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,ho.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){Dr(Qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){Dr(Qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){Dr(Qr(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Dr(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Dr(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Dr(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Dr(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Dr($r(Tr),"This node only works in a secure context (https or localhost)"),new Tr(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return zr(this,void 0,void 0,(function*(){Dr($r(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return zr(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,jr(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return Qr(this._context)?this._context.resume():Promise.resolve()}close(){return zr(this,void 0,void 0,(function*(){var t;Qr(this._context)&&(yield this._context.close()),this._initialized&&(t=this,fo.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function yo(t,e){Fr(e)?e.forEach((e=>yo(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function wo(t,e){Fr(e)?e.forEach((e=>wo(t,e))):Object.defineProperty(t,e,{writable:!0})}const xo=()=>{};class bo extends io{constructor(){super(),this.name="ToneAudioBuffer",this.onload=xo;const t=eo(bo.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Jr(t.url)||t.url instanceof bo?this.set(t.url):jr(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:xo,onload:xo,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:ko().sampleRate}set(t){return t instanceof bo?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return zr(this,void 0,void 0,(function*(){const e=bo.load(t).then((t=>{this.set(t),this.onload(this)}));bo.downloads.push(e);try{yield e}finally{const t=bo.downloads.indexOf(e);bo.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Fr(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=ko(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(qr(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(qr(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);Dr(n<s,"The start time must be less than the end time");const i=s-n,r=ko().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new bo(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new bo).fromArray(t)}static fromUrl(t){return zr(this,void 0,void 0,(function*(){const e=new bo;return yield e.load(t)}))}static load(t){return zr(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(bo.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===bo.baseUrl||bo.baseUrl.endsWith("/")?bo.baseUrl:bo.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const i=yield s.arrayBuffer();return yield ko().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return zr(this,void 0,void 0,(function*(){for(yield Promise.resolve();bo.downloads.length;)yield bo.downloads[0]}))}}bo.baseUrl="",bo.downloads=[];class To extends vo{constructor(){var t,e,n;super({clockSource:"offline",context:Zr(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new kr(t,e,n)),lookAhead:0,updateInterval:Zr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Zr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return zr(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return zr(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new bo(e)}))}close(){return Promise.resolve()}}const Co=new class extends _o{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return zr(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let Ao=Co;function ko(){return Ao===Co&&Ur&&So(new vo),Ao}function So(t){Ao=Qr(t)?new vo(t):Zr(t)?new To(t):t}if(Wr&&!Wr.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Oo(t){return Math.pow(2,t/12)}let Mo=440;function Eo(t){return Math.round(Do(t))}function Do(t){return 69+12*Math.log2(t/Mo)}class Io extends io{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Io&&this.fromType(this._val),Vr(this._val))return this._noArg();if(jr(this._val)&&Vr(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Lr(this._val)){let t=0;for(const e in this._val)if($r(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if($r(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return jr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Ro extends Io{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Ro(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new Ro(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Ro(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Eo(this.toFrequency())}_now(){return this.context.now()}}class No extends Ro{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Mo}static set A4(t){!function(t){Mo=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:No.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Po[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:No.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new No(this.context,this.valueOf()*Oo(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Eo(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/No.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return Vo[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return function(t){return Mo*Math.pow(2,(t-69)/12)}(t)}static ftom(t){return Eo(t)}}const Po={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Vo=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class $o extends Ro{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class qo extends io{constructor(){super();const t=eo(qo.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:ko()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Ro(this.context,t).toSeconds()}toFrequency(t){return new No(this.context,t).toFrequency()}toTicks(t){return new $o(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Vr(t[n])&&delete e[n]})),e}get(){const t=function(t){return t.constructor.getDefaults()}(this);return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];$r(n)&&$r(n.value)&&$r(n.setValueAtTime)?t[e]=n.value:n instanceof qo?t[e]=n._getPartialProperties(t[e]):Fr(n)||qr(n)||jr(n)||"boolean"==typeof n?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&$r(this[e])&&(this[e]&&$r(this[e].value)&&$r(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof qo?this[e].set(t[e]):this[e]=t[e])})),this}}class Lo extends uo{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return Ir(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class Fo extends qo{constructor(){super(eo(Fo.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=eo(Fo.getDefaults(),arguments,["param","units","convert"]);for(Dr($r(t.param)&&(Yr(t.param)||t.param instanceof Fo),"param must be an AudioParam");!Yr(t.param);)t.param=t.param._param;this._swappable=!!$r(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new uo(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,$r(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(qo.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return $r(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return $r(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return $r(this.maxValue)&&$r(this.minValue)&&Ir(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return Dr(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return Dr(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=co(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return Dr(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);Dr(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),Dr(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Dr(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Dr(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&co(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Dr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class jo extends qo{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return $r(this.input)?Yr(this.input)||this.input instanceof Fo?1:this.input.numberOfInputs:0}get numberOfOutputs(){return $r(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return $r(t)&&(t instanceof jo||Hr(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Dr(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Wo(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Pr("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return function(t,e,n=0,s=0){if($r(e))for(;e instanceof jo;)e=e.input;for(;!Hr(t);)$r(t.output)&&(t=t.output);Yr(e)?t.disconnect(e,n):Hr(e)?t.disconnect(e,n,s):t.disconnect()}(this,t,e,n),this}chain(...t){return Bo(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),$r(this.input)&&(this.input instanceof jo?this.input.dispose():Hr(this.input)&&this.input.disconnect()),$r(this.output)&&(this.output instanceof jo?this.output.dispose():Hr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Bo(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof jo?t.connect(e):Hr(t)&&Wo(t,e),e)),e)}function Wo(t,e,n=0,s=0){for(Dr($r(t),"Cannot connect from undefined node"),Dr($r(e),"Cannot connect to undefined node"),(e instanceof jo||Hr(e))&&Dr(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Dr(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof jo||e instanceof Fo;)$r(e.input)&&(e=e.input);for(;t instanceof jo;)$r(t.output)&&(t=t.output);Yr(e)?t.connect(e,n):t.connect(e,n,s)}class Uo extends jo{constructor(){super(eo(Uo.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=eo(Uo.getDefaults(),arguments,["gain","units"]);this.gain=new Fo({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),yo(this,"gain")}static getDefaults(){return Object.assign(jo.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Xo extends jo{constructor(t){super(t),this.onended=xo,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Uo({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(jo.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:xo})}_startGain(t,e=1){Dr(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Dr(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==xo&&(this.onended(this),this.onended=xo,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Dr(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class zo extends Xo{constructor(){super(eo(zo.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=eo(zo.getDefaults(),arguments,["offset"]);Wo(this._source,this._gainNode),this.offset=new Fo({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Xo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Go extends jo{constructor(){super(eo(Go.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=eo(Go.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new zo({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(jo.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Yo(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Yo(t,e,n,s){(e instanceof Fo||Yr(e)||e instanceof Go&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Go&&(e.overridden=!0)),Wo(t,e,n,s)}class Ho extends Fo{constructor(){super(eo(Ho.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new uo(1/0),this._multiplier=1;const t=eo(Ho.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Fo.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Vr(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Zo extends Go{constructor(){super(eo(Zo.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=eo(Zo.getDefaults(),arguments,["value"]);this.input=this._param=new Ho({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Go.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Qo extends qo{constructor(){super(eo(Qo.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Lo,this._tickOffset=new uo;const t=eo(Qo.getDefaults(),arguments,["frequency"]);this.frequency=new Zo({context:this.context,units:t.units,value:t.frequency}),yo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},qo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),$r(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let l=Math.ceil(a)-a;l=co(l,1)?0:l;let c=this.frequency.getTimeOfTick(o+l);for(;c<e;){try{n(c,Math.round(this.getTicksAtTime(c)))}catch(t){i=t;break}c+=this.frequency.getDurationOfTicks(1,c)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Jo extends qo{constructor(){super(eo(Jo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=xo,this._lastUpdate=0,this._state=new Lo("stopped"),this._boundLoop=this._loop.bind(this);const t=eo(Jo.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Qo({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,yo(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(qo.getDefaults(),{callback:xo,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Rr(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}go.mixin(Jo);class Ko extends io{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=eo(Ko.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:xo,onload:xo,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Dr(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=xo,s=xo){return jr(e)?this._buffers.set(t.toString(),new bo(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new bo(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class ta extends $o{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class ea extends qo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new uo,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}po((t=>{t.draw=new ea({context:t})})),mo((t=>{t.draw.dispose()}));class na extends io{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Dr($r(t.time),"Events must have a time property"),Dr($r(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new sa(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class sa{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class ia extends jo{constructor(){super(eo(ia.getDefaults(),arguments,["volume"])),this.name="Volume";const t=eo(ia.getDefaults(),arguments,["volume"]);this.input=this.output=new Uo({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,yo(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(jo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class ra extends jo{constructor(){super(eo(ra.getDefaults(),arguments)),this.name="Destination",this.input=new ia({context:this.context}),this.output=new Uo({context:this.context}),this.volume=this.input.volume;const t=eo(ra.getDefaults(),arguments);Bo(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(jo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Bo(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}po((t=>{t.destination=new ra({context:t})})),mo((t=>{t.destination.dispose()}));class oa extends io{constructor(t){super(),this.name="TimelineValue",this._timeline=new uo({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class aa{constructor(t,e){this.id=aa._eventId++;const n=Object.assign(aa.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:xo,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}aa._eventId=0;class la extends aa{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(la.getDefaults(),e);this.duration=new ta(t.context,n.duration).valueOf(),this._interval=new ta(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},aa.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ta(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new ta(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ta(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class ca extends qo{constructor(){super(eo(ca.getDefaults(),arguments)),this.name="Transport",this._loop=new oa(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new uo,this._repeatedEvents=new na,this._syncedSignals=[],this._swingAmount=0;const t=eo(ca.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Jo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),yo(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(qo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new ta(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new aa(this,{callback:t,time:new $o(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new la(this,{callback:t,duration:new Ro(this.context,s).toTicks(),interval:new Ro(this.context,e).toTicks(),time:new $o(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new aa(this,{callback:t,once:!0,time:new $o(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new ta(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return $r(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Fr(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Ro(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Ro(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new ta(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new ta(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/s}else e=0}const n=new Uo(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),wo(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}go.mixin(ca),po((t=>{t.transport=new ca({context:t})})),mo((t=>{t.transport.dispose()}));class ua extends jo{constructor(t){super(t),this.input=void 0,this._state=new Lo("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=xo,this._syncedStop=xo,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ia({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,yo(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(jo.getDefaults(),{mute:!1,onstop:xo,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Vr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(no(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else Rr(this.context),this._start(s,e,n);else Dr(oo(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Vr(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||$r(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=xo,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ha extends Xo{constructor(){super(eo(ha.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=eo(ha.getDefaults(),arguments,["url","onload"]);Wo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Fo({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new bo(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Xo.getDefaults(),{url:new bo,loop:!1,loopEnd:0,loopStart:0,onload:xo,onerror:xo,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){Dr(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?no(e,this.loopStart):no(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;ao(r,t)&&(r=(r-e)%n+e),co(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,lo(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),$r(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function da(t,e){return zr(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new To(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class pa extends Xo{constructor(){super(eo(pa.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=eo(pa.getDefaults(),arguments,["frequency","type"]);Wo(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Fo({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Fo({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),yo(this,["frequency","detune"])}static getDefaults(){return Object.assign(Xo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class fa extends ua{constructor(){super(eo(fa.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=eo(fa.getDefaults(),arguments,["frequency","type"]);this.frequency=new Go({context:this.context,units:"frequency",value:t.frequency}),yo(this,"frequency"),this.detune=new Go({context:this.context,units:"cents",value:t.detune}),yo(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(ua.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new pa({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return fa._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=fa._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if($r(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),fa._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),fa._periodicWaveCache.length>100&&fa._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Ir(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return i=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}fa._periodicWaveCache=[];class ma extends jo{constructor(){super(Object.assign(eo(ma.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Yo(this,t,e,n),this}}class ga extends ma{constructor(){super(Object.assign(eo(ga.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=eo(ga.getDefaults(),arguments,["mapping","length"]);Fr(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Go.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Dr(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class _a extends ma{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ga({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class va extends Go{constructor(){super(Object.assign(eo(va.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=eo(va.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Uo({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Go.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class ya extends ua{constructor(){super(eo(ya.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new _a({context:this.context}),this._modulationNode=new Uo({context:this.context});const t=eo(ya.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new fa({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new fa({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new va({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),yo(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(fa.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class wa extends ua{constructor(){super(eo(wa.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Uo({context:this.context,gain:0});const t=eo(wa.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new fa({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Go({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new fa({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new va({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new va({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),yo(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(fa.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class xa extends ua{constructor(){super(eo(xa.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Uo({context:this.context,gain:0}),this._thresh=new ga({context:this.context,mapping:t=>t<=0?-1:1});const t=eo(xa.getDefaults(),arguments,["frequency","width"]);this.width=new Go({context:this.context,units:"audioRange",value:t.width}),this._triangle=new fa({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),yo(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ua.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ba extends ua{constructor(){super(eo(ba.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=eo(ba.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Go({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Go({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,yo(this,["frequency","detune"])}static getDefaults(){return Object.assign(fa.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(Ir(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new fa({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):xo});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class Ta extends ua{constructor(){super(eo(Ta.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new va({context:this.context,value:2});const t=eo(Ta.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new xa({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new fa({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),yo(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ua.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ca={am:ya,fat:ba,fm:wa,oscillator:fa,pulse:xa,pwm:Ta};class Aa extends ua{constructor(){super(eo(Aa.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=eo(Aa.getDefaults(),arguments,["frequency","type"]);this.frequency=new Go({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Go({context:this.context,units:"cents",value:t.detune}),yo(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(fa.getDefaults(),wa.getDefaults(),ya.getDefaults(),ba.getDefaults(),xa.getDefaults(),Ta.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Ca[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Ca[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&qr(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&qr(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&jr(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return zr(this,void 0,void 0,(function*(){return da(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function ka(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Ir(s,t,e),n.set(this,s)}})}}function Sa(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Ir(this.toSeconds(s),t,e),n.set(this,s)}})}}class Oa extends ua{constructor(){super(eo(Oa.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=eo(Oa.getDefaults(),arguments,["url","onload"]);this._buffer=new bo({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(ua.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:xo,onerror:xo,playbackRate:1,reverse:!1})}load(t){return zr(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=xo){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?no(e,this._loopStart):no(e,0);const s=this.toSeconds(e),i=n;n=no(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new ha({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Vr(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Ir(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Ir(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Xr([Sa(0)],Oa.prototype,"fadeIn",void 0),Xr([Sa(0)],Oa.prototype,"fadeOut",void 0);class Ma extends jo{constructor(){super(eo(Ma.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Go({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=eo(Ma.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(jo.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(jr(t))return t;{let n;for(n in Ea)if(Ea[n][e]===t)return n;return t}}_setCurve(t,e,n){if(jr(n)&&Reflect.has(Ea,n)){const s=Ea[n];Lr(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!Fr(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Dr(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Dr(Fr(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Yo(this,t,e,n),this}asArray(t=1024){return zr(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new To(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Xr([Sa(0)],Ma.prototype,"attack",void 0),Xr([Sa(0)],Ma.prototype,"decay",void 0),Xr([ka(0,1)],Ma.prototype,"sustain",void 0),Xr([Sa(0)],Ma.prototype,"release",void 0);const Ea=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,s=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(s*(1-n))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:l(a),Out:a},cosine:{In:s,Out:(c=s,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:l(i)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var c})();class Da extends jo{constructor(){super(eo(Da.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=eo(Da.getDefaults(),arguments);this._volume=this.output=new ia({context:this.context,volume:t.volume}),this.volume=this._volume.volume,yo(this,"volume")}static getDefaults(){return Object.assign(jo.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Ia extends Da{constructor(){super(eo(Ia.getDefaults(),arguments));const t=eo(Ia.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Da.getDefaults(),{detune:0,onsilence:xo,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof No?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Xr([Sa(0)],Ia.prototype,"portamento",void 0);class Ra extends Ma{constructor(){super(eo(Ra.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Uo({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Na extends Ia{constructor(){super(eo(Na.getDefaults(),arguments)),this.name="Synth";const t=eo(Na.getDefaults(),arguments);this.oscillator=new Aa(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ra(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),yo(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Ia.getDefaults(),{envelope:Object.assign(so(Ma.getDefaults(),Object.keys(jo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(so(Aa.getDefaults(),[...Object.keys(ua.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Pa extends Na{constructor(){super(eo(Pa.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=eo(Pa.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,yo(this,["oscillator","envelope"])}static getDefaults(){return to(Ia.getDefaults(),Na.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof No?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Xr([ka(0)],Pa.prototype,"octaves",void 0),Xr([Sa(0)],Pa.prototype,"pitchDecay",void 0);const Va=new Set;function $a(t){Va.add(t)}function qa(t,e){const n=`registerProcessor("${t}", ${e})`;Va.add(n)}$a('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');$a("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");$a("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");qa("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class La extends Da{constructor(){super(eo(La.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=eo(La.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(Dr(Br(n)||qr(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),Br(n)){const s=new No(this.context,n).toMidi();e[s]=t.urls[n]}else qr(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new Ko({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Da.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:xo,onerror:xo,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=Do(new No(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,l=this._buffers.get(a),c=Oo(o+r),u=new ha({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);u.start(e,0,l.duration/c,n),Fr(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(u);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new No(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),Fr(e)?(Dr(Fr(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(Dr(Br(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Br(t)){const s=new No(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Xr([Sa(0)],La.prototype,"attack",void 0),Xr([Sa(0)],La.prototype,"release",void 0);qa("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Fa extends jo{constructor(){super(...arguments),this.name="Listener",this.positionX=new Fo({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Fo({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Fo({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Fo({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Fo({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Fo({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Fo({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Fo({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Fo({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(jo.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}po((t=>{t.listener=new Fa({context:t})})),mo((t=>{t.listener.dispose()})),ko().transport,ko().destination,ko().destination,ko().listener,ko().draw,ko();const ja=new Oa("../images/drop_board.wav").toDestination(),Ba=new Oa("../images/drop_rack.wav").toDestination();ja.volume.value=-15,Ba.volume.value=-25,So(new vo({latencyHint:"playback"}));const Wa=()=>{bo.loaded(),document.removeEventListener("mouseover",Wa),document.removeEventListener("scroll",Wa),document.removeEventListener("keydown",Wa)};document.addEventListener("mouseover",Wa),document.addEventListener("scroll",Wa),document.addEventListener("keydown",Wa);function Ua(t){let e,n;return e=new ue({props:{letter:t[1]?t[0].joker:t[0].letter,value:dt[t[0].letter].pts,id:t[0].id,classes:t[2],styles:t[4],self:t[5],on_mousedown:t[3]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,[n]){const s={};3&n&&(s.letter=t[1]?t[0].joker:t[0].letter),1&n&&(s.value=dt[t[0].letter].pts),1&n&&(s.id=t[0].id),4&n&&(s.classes=t[2]),16&n&&(s.styles=t[4]),8&n&&(s.on_mousedown=t[3]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Xa(t,e,n){let s,i,r,o,a,c,u,h;l(t,Z,(t=>n(12,h=t)));let d,{game:p}=e,{letter:f}=e,m={x:null,y:null};const g=t=>t.touches?(t.preventDefault(),document.body.style.overflow="hidden",t.touches[0]):t,_=t=>{let e=g(t);window.addEventListener("mousemove",v),window.addEventListener("touchmove",v,{passive:!1}),window.addEventListener("mouseup",y),window.addEventListener("touchend",y),n(10,r=!0),n(7,m=p.getXY(e)),d=p.getLocation(e),ie(h.letters.filter((t=>!t.board)),h.letters.filter((t=>t.id===f.id))[0]),Q.setHoverLocation(d)},v=t=>{if(r){let e=g(t);n(7,m=p.getXY(e)),d=p.getLocation(e),d.board||void 0===d.index?oe():re(d.index),Q.setHoverLocation(d)}},y=t=>{if(document.body.style.overflow="auto",t.preventDefault(),window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",v),window.removeEventListener("mouseup",y),window.removeEventListener("touchend",y),!d.board&&void 0!==d.index){ae().map((t=>{Z.moveLetter(t.id,!1,t.index)}))}void 0!==d.index&&(o&&(d.board&&""===h.letters.filter((t=>t.id===f.id))[0].joker?Z.setJokerPicker(f,!0):d.board||Z.setJoker(f.id,"")),Z.moveLetter(f.id,d.board,d.index),zt(),d.board?ja.start("-0.1"):Ba.start("-0.1")),n(10,r=!1),Q.setHoverLocation(null)};return t.$$set=t=>{"game"in t&&n(6,p=t.game),"letter"in t&&n(0,f=t.letter)},t.$$.update=()=>{1&t.$$.dirty&&n(8,s=f.free),1&t.$$.dirty&&n(9,i=f.board),1&t.$$.dirty&&n(1,o="_"===f.letter),1794&t.$$.dirty&&n(2,a=(r?" grab":"")+(i?" board":" rack")+(s?" free":"")+(o?" isjoker":"")),1280&t.$$.dirty&&n(3,c=s&&!r?_:null),128&t.$$.dirty&&n(4,u=`--x:${m.x}px; --y:${m.y}px;`),1729&t.$$.dirty&&n(4,u=r?`--x:${m.x}px; --y:${m.y}px;`:i?`--x:${p.getBoardXY(f.index).x}; --y:${p.getBoardXY(f.index).y};`:`--pos:${p.getRackPos(f.index)};`)},n(10,r=!1),[f,o,a,c,u,undefined,p,m,s,i,r]}class za extends G{constructor(t){super(),z(this,t,Xa,Ua,r,{game:6,letter:0})}}function Ga(t,e,n){const s=t.slice();return s[8]=e[n],s[10]=n,s}function Ya(t){let e,n;return e=new ue({props:{letter:t[8],value:"",id:t[10],classes:t[2][t[10]]?"joker selected":"joker",on_click:function(){return t[5](t[10])}}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(n,s){t=n;const i={};4&s&&(i.classes=t[2][t[10]]?"joker selected":"joker"),e.$set(i)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Ha(t){let e,n,r,o,a,l,c,_,w,x,b,T,C,A,k,S,O=t[3],M=[];for(let e=0;e<O.length;e+=1)M[e]=Ya(Ga(t,O,e));const E=t=>j(M[t],1,1,(()=>{M[t]=null}));return{c(){e=f("div"),n=g(),r=f("div"),o=f("div"),o.textContent="Selectionne la lettre que tu souhaites attribuer à ton joker:",a=g(),l=f("div");for(let t=0;t<M.length;t+=1)M[t].c();c=g(),_=f("div"),w=f("button"),w.textContent="Annuler",x=g(),b=f("button"),T=m("Valider"),y(e,"class","overlay svelte-f5oka9"),y(o,"class","description svelte-f5oka9"),y(l,"class","letters svelte-f5oka9"),y(w,"class","svelte-f5oka9"),b.disabled=C=-1===t[2].indexOf(!0),y(b,"class","svelte-f5oka9"),y(_,"class","actions svelte-f5oka9"),y(r,"class","container svelte-f5oka9")},m(s,d){h(s,e,d),h(s,n,d),h(s,r,d),u(r,o),u(r,a),u(r,l);for(let t=0;t<M.length;t+=1)M[t].m(l,null);u(r,c),u(r,_),u(_,w),u(_,x),u(_,b),u(b,T),A=!0,k||(S=[v(w,"click",(function(){i(t[0])&&t[0].apply(this,arguments)})),v(b,"click",t[6])],k=!0)},p(e,[n]){if(t=e,28&n){let e;for(O=t[3],e=0;e<O.length;e+=1){const s=Ga(t,O,e);M[e]?(M[e].p(s,n),F(M[e],1)):(M[e]=Ya(s),M[e].c(),F(M[e],1),M[e].m(l,null))}for(q(),e=O.length;e<M.length;e+=1)E(e);L()}(!A||4&n&&C!==(C=-1===t[2].indexOf(!0)))&&(b.disabled=C)},i(t){if(!A){for(let t=0;t<O.length;t+=1)F(M[t]);A=!0}},o(t){M=M.filter(Boolean);for(let t=0;t<M.length;t+=1)j(M[t]);A=!1},d(t){t&&d(e),t&&d(n),t&&d(r),p(M,t),k=!1,s(S)}}}function Za(t,e,n){let s,{cancel:i}=e,{validate:r}=e;const o=Object.keys(dt).filter((t=>"_"!==t)),a=t=>{n(2,s=Array(o.length).fill(!1)),n(2,s[t]=!0,s)};return t.$$set=t=>{"cancel"in t&&n(0,i=t.cancel),"validate"in t&&n(1,r=t.validate)},n(2,s=Array(o.length).fill(!1)),[i,r,s,o,a,t=>a(t),()=>r(o[s.indexOf(!0)])]}class Qa extends G{constructor(t){super(),z(this,t,Za,Ha,r,{cancel:0,validate:1})}}function Ja(t,e,n){const s=t.slice();return s[13]=e[n],s[15]=n,s}function Ka(t,e,n){const s=t.slice();return s[16]=e[n],s[15]=n,s}function tl(t,e,n){const s=t.slice();return s[18]=e[n],s[15]=n,s}function el(t){let e,n,s,i,r,o=t[1].score+"";return{c(){e=f("div"),n=f("span"),s=m(o),y(e,"class",i=c(t[1].vertical?"score vertical":"score")+" svelte-d4fgom"),y(e,"style",r=`--x:${t[1].score_location.x}; --y:${t[1].score_location.y}`)},m(t,i){h(t,e,i),u(e,n),u(n,s)},p(t,n){2&n&&o!==(o=t[1].score+"")&&w(s,o),2&n&&i!==(i=c(t[1].vertical?"score vertical":"score")+" svelte-d4fgom")&&y(e,"class",i),2&n&&r!==(r=`--x:${t[1].score_location.x}; --y:${t[1].score_location.y}`)&&y(e,"style",r)},d(t){t&&d(e)}}}function nl(t){let e;return{c(){e=f("div"),e.textContent="Partie terminée!",y(e,"class","gameover svelte-d4fgom")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function sl(t){let e,n,s,i,r;return{c(){e=f("div"),s=g(),i=f("div"),y(e,"class","highlight-row svelte-d4fgom"),y(e,"style",n=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`),y(i,"class","highlight-col svelte-d4fgom"),y(i,"style",r=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)},m(t,n){h(t,e,n),h(t,s,n),h(t,i,n)},p(t,s){9&s&&n!==(n=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)&&y(e,"style",n),9&s&&r!==(r=`--x:${t[0].getBoardXY(t[3].index).x}; --y:${t[0].getBoardXY(t[3].index).y};`)&&y(i,"style",r)},d(t){t&&d(e),t&&d(s),t&&d(i)}}}function il(e){let n,s;return n=new Qa({props:{cancel:e[6],validate:e[7]}}),{c(){B(n.$$.fragment)},m(t,e){W(n,t,e),s=!0},p:t,i(t){s||(F(n.$$.fragment,t),s=!0)},o(t){j(n.$$.fragment,t),s=!1},d(t){U(n,t)}}}function rl(t){let e,n;return e=new ue({props:{letter:t[18].letter,value:"",id:t[15],classes:"board temp",styles:`--x:${t[0].getBoardXY(t[18].index).x}; --y:${t[0].getBoardXY(t[18].index).y};`}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};4&n&&(s.letter=t[18].letter),5&n&&(s.styles=`--x:${t[0].getBoardXY(t[18].index).x}; --y:${t[0].getBoardXY(t[18].index).y};`),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function ol(e){let n,s,i=e[16]+"";return{c(){n=f("div"),s=m(i),y(n,"class","row-col-name svelte-d4fgom"),y(n,"style",`--x:-1.125; --y:${e[15]+.25};text-align: right;`)},m(t,e){h(t,n,e),u(n,s)},p:t,d(t){t&&d(n)}}}function al(e){let n,s,i,r=e[13]+"";return{c(){n=f("div"),s=m(r),i=g(),y(n,"class","row-col-name svelte-d4fgom"),y(n,"style",`--x:${e[15]}; --y:-0.5;text-align: center;`)},m(t,e){h(t,n,e),u(n,s),u(n,i)},p:t,d(t){t&&d(n)}}}function ll(t){let e,n,s,i,r,o,a,l,c,m=t[1].valid&&el(t),v=t[4]&&nl(),w=t[3]&&t[3].board&&void 0!==t[3].index&&sl(t),x=t[5]&&il(t),b=t[2],T=[];for(let e=0;e<b.length;e+=1)T[e]=rl(tl(t,b,e));const C=t=>j(T[t],1,1,(()=>{T[t]=null}));let A=t[8],k=[];for(let e=0;e<A.length;e+=1)k[e]=ol(Ka(t,A,e));let S=t[9],O=[];for(let e=0;e<S.length;e+=1)O[e]=al(Ja(t,S,e));return{c(){e=f("div"),m&&m.c(),n=g(),v&&v.c(),s=g(),w&&w.c(),i=g(),x&&x.c(),r=g();for(let t=0;t<T.length;t+=1)T[t].c();o=g();for(let t=0;t<k.length;t+=1)k[t].c();a=g();for(let t=0;t<O.length;t+=1)O[t].c();l=_(),y(e,"class","overlay svelte-d4fgom")},m(t,d){h(t,e,d),m&&m.m(e,null),u(e,n),v&&v.m(e,null),h(t,s,d),w&&w.m(t,d),h(t,i,d),x&&x.m(t,d),h(t,r,d);for(let e=0;e<T.length;e+=1)T[e].m(t,d);h(t,o,d);for(let e=0;e<k.length;e+=1)k[e].m(t,d);h(t,a,d);for(let e=0;e<O.length;e+=1)O[e].m(t,d);h(t,l,d),c=!0},p(t,[s]){if(t[1].valid?m?m.p(t,s):(m=el(t),m.c(),m.m(e,n)):m&&(m.d(1),m=null),t[4]?v||(v=nl(),v.c(),v.m(e,null)):v&&(v.d(1),v=null),t[3]&&t[3].board&&void 0!==t[3].index?w?w.p(t,s):(w=sl(t),w.c(),w.m(i.parentNode,i)):w&&(w.d(1),w=null),t[5]?x?(x.p(t,s),32&s&&F(x,1)):(x=il(t),x.c(),F(x,1),x.m(r.parentNode,r)):x&&(q(),j(x,1,1,(()=>{x=null})),L()),5&s){let e;for(b=t[2],e=0;e<b.length;e+=1){const n=tl(t,b,e);T[e]?(T[e].p(n,s),F(T[e],1)):(T[e]=rl(n),T[e].c(),F(T[e],1),T[e].m(o.parentNode,o))}for(q(),e=b.length;e<T.length;e+=1)C(e);L()}if(256&s){let e;for(A=t[8],e=0;e<A.length;e+=1){const n=Ka(t,A,e);k[e]?k[e].p(n,s):(k[e]=ol(n),k[e].c(),k[e].m(a.parentNode,a))}for(;e<k.length;e+=1)k[e].d(1);k.length=A.length}if(512&s){let e;for(S=t[9],e=0;e<S.length;e+=1){const n=Ja(t,S,e);O[e]?O[e].p(n,s):(O[e]=al(n),O[e].c(),O[e].m(l.parentNode,l))}for(;e<O.length;e+=1)O[e].d(1);O.length=S.length}},i(t){if(!c){F(x);for(let t=0;t<b.length;t+=1)F(T[t]);c=!0}},o(t){j(x),T=T.filter(Boolean);for(let t=0;t<T.length;t+=1)j(T[t]);c=!1},d(t){t&&d(e),m&&m.d(),v&&v.d(),t&&d(s),w&&w.d(t),t&&d(i),x&&x.d(t),t&&d(r),p(T,t),t&&d(o),p(k,t),t&&d(a),p(O,t),t&&d(l)}}}function cl(t,e,n){let s,i,r,o,a,c,u;l(t,Z,(t=>n(10,c=t))),l(t,Q,(t=>n(11,u=t)));let{game:h}=e;const d={valid:!1,score:0,vertical:!1},p=Array(15).fill(0).map(((t,e)=>e+1)),f=Object.keys(dt).filter((t=>"_"!==t)).filter(((t,e)=>e<15));return t.$$set=t=>{"game"in t&&n(0,h=t.game)},t.$$.update=()=>{if(3073&t.$$.dirty){if(c){let t=c.evaluation;n(1,s=t?{valid:t.is_word_valid,score:t.total_score,score_location:h.getBoardXY(t.last_letter_index),vertical:t.full_words[t.main_word_index].vertical}:{...d}),n(5,a=c.jocker_picker),n(4,o=c.game_over)}u&&(n(2,i=u.temp_letters),n(3,r=u.hover_location))}},n(1,s={...d}),n(2,i=[]),n(3,r=[]),n(4,o=!1),n(5,a=!1),[h,s,i,r,o,a,()=>{let t=c.jocker_picker_letter;Z.moveLetter(t.id,t.board,t.index),Z.setJokerPicker({},!1),zt()},t=>{let e=c.jocker_picker_letter;Z.setJoker(e.id,t),Z.setJokerPicker({},!1),zt()},p,f,c,u]}class ul extends G{constructor(t){super(),z(this,t,cl,ll,r,{game:0})}}function hl(t,e,n){const s=t.slice();return s[19]=e[n],s}function dl(t,e,n){const s=t.slice();return s[19]=e[n],s}function pl(t,e,n){const s=t.slice();return s[19]=e[n],s}function fl(t,e,n){const s=t.slice();return s[26]=e[n],s[27]=e,s[28]=n,s}function ml(t,e,n){const s=t.slice();return s[26]=e[n],s[29]=e,s[28]=n,s}function gl(t){let e,n=t[29],s=t[28];const i=()=>t[10](e,n,s),r=()=>t[10](null,n,s);return{c(){e=f("div"),y(e,"class","board-cell svelte-1ln5f1s"),y(e,"style",`--x:${t[7](t[28]).x};--y:${t[7](t[28]).y};`),y(e,"cid",t[28])},m(t,n){h(t,e,n),i()},p(e,o){n===(t=e)[29]&&s===t[28]||(r(),n=t[29],s=t[28],i())},d(t){t&&d(e),r()}}}function _l(t){let e,n,s,i=t[27],r=t[28];const o=()=>t[11](e,i,r),a=()=>t[11](null,i,r);return{c(){e=f("div"),n=f("div"),s=g(),y(n,"class","rack-decoration svelte-1ln5f1s"),y(e,"class","rack-cell svelte-1ln5f1s"),y(e,"style",`--pos:${t[8](t[28])};`),y(e,"cid",t[28])},m(t,i){h(t,e,i),u(e,n),u(e,s),o()},p(e,n){i===(t=e)[27]&&r===t[28]||(a(),i=t[27],r=t[28],o())},d(t){t&&d(e),a()}}}function vl(t){let e,n,s,i,r,o,a=t[6].letters.filter(Tl),l=[];for(let e=0;e<a.length;e+=1)l[e]=yl(pl(t,a,e));const c=t=>j(l[t],1,1,(()=>{l[t]=null}));let u=t[6].letters.filter(Cl),m=[];for(let e=0;e<u.length;e+=1)m[e]=wl(dl(t,u,e));const _=t=>j(m[t],1,1,(()=>{m[t]=null}));let v=t[6].letters.filter(Al),w=[];for(let e=0;e<v.length;e+=1)w[e]=xl(hl(t,v,e));const x=t=>j(w[t],1,1,(()=>{w[t]=null}));return{c(){e=f("div");for(let t=0;t<l.length;t+=1)l[t].c();n=g(),s=f("div");for(let t=0;t<m.length;t+=1)m[t].c();i=g(),r=f("div");for(let t=0;t<w.length;t+=1)w[t].c();y(e,"class","board-letters-free"),y(s,"class","board-letters-fixed"),y(r,"class","rack-letters")},m(t,a){h(t,e,a);for(let t=0;t<l.length;t+=1)l[t].m(e,null);h(t,n,a),h(t,s,a);for(let t=0;t<m.length;t+=1)m[t].m(s,null);h(t,i,a),h(t,r,a);for(let t=0;t<w.length;t+=1)w[t].m(r,null);o=!0},p(t,n){if(576&n){let s;for(a=t[6].letters.filter(Tl),s=0;s<a.length;s+=1){const i=pl(t,a,s);l[s]?(l[s].p(i,n),F(l[s],1)):(l[s]=yl(i),l[s].c(),F(l[s],1),l[s].m(e,null))}for(q(),s=a.length;s<l.length;s+=1)c(s);L()}if(576&n){let e;for(u=t[6].letters.filter(Cl),e=0;e<u.length;e+=1){const i=dl(t,u,e);m[e]?(m[e].p(i,n),F(m[e],1)):(m[e]=wl(i),m[e].c(),F(m[e],1),m[e].m(s,null))}for(q(),e=u.length;e<m.length;e+=1)_(e);L()}if(576&n){let e;for(v=t[6].letters.filter(Al),e=0;e<v.length;e+=1){const s=hl(t,v,e);w[e]?(w[e].p(s,n),F(w[e],1)):(w[e]=xl(s),w[e].c(),F(w[e],1),w[e].m(r,null))}for(q(),e=v.length;e<w.length;e+=1)x(e);L()}},i(t){if(!o){for(let t=0;t<a.length;t+=1)F(l[t]);for(let t=0;t<u.length;t+=1)F(m[t]);for(let t=0;t<v.length;t+=1)F(w[t]);o=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)j(l[t]);m=m.filter(Boolean);for(let t=0;t<m.length;t+=1)j(m[t]);w=w.filter(Boolean);for(let t=0;t<w.length;t+=1)j(w[t]);o=!1},d(t){t&&d(e),p(l,t),t&&d(n),t&&d(s),p(m,t),t&&d(i),t&&d(r),p(w,t)}}}function yl(t){let e,n;return e=new za({props:{game:t[9],letter:t[19]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[19]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function wl(t){let e,n;return e=new za({props:{game:t[9],letter:t[19]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[19]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function xl(t){let e,n;return e=new za({props:{game:t[9],letter:t[19]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};64&n&&(s.letter=t[19]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function bl(t){let e,n,s,i,r,o,a,l,c,m;i=new ul({props:{game:t[9]}});let _=t[4],v=[];for(let e=0;e<_.length;e+=1)v[e]=gl(ml(t,_,e));let w=t[5],x=[];for(let e=0;e<w.length;e+=1)x[e]=_l(fl(t,w,e));let b=t[6]&&vl(t);return{c(){e=f("div"),n=f("div"),s=f("div"),B(i.$$.fragment),r=g();for(let t=0;t<v.length;t+=1)v[t].c();o=g(),a=f("div");for(let t=0;t<x.length;t+=1)x[t].c();l=g(),b&&b.c(),y(s,"class","board svelte-1ln5f1s"),y(a,"class","rack svelte-1ln5f1s"),y(a,"id","rack"),y(n,"class","game svelte-1ln5f1s"),y(e,"class","container svelte-1ln5f1s"),y(e,"style",c=`--REF-SIZE: ${15*t[0]/16}px;--S: ${t[0]/16}px;`)},m(c,d){h(c,e,d),u(e,n),u(n,s),W(i,s,null),u(s,r);for(let t=0;t<v.length;t+=1)v[t].m(s,null);u(n,o),u(n,a);for(let t=0;t<x.length;t+=1)x[t].m(a,null);t[12](a),u(n,l),b&&b.m(n,null),t[13](n),t[14](e),m=!0},p(t,[i]){if(144&i){let e;for(_=t[4],e=0;e<_.length;e+=1){const n=ml(t,_,e);v[e]?v[e].p(n,i):(v[e]=gl(n),v[e].c(),v[e].m(s,null))}for(;e<v.length;e+=1)v[e].d(1);v.length=_.length}if(288&i){let e;for(w=t[5],e=0;e<w.length;e+=1){const n=fl(t,w,e);x[e]?x[e].p(n,i):(x[e]=_l(n),x[e].c(),x[e].m(a,null))}for(;e<x.length;e+=1)x[e].d(1);x.length=w.length}t[6]?b?(b.p(t,i),64&i&&F(b,1)):(b=vl(t),b.c(),F(b,1),b.m(n,null)):b&&(q(),j(b,1,1,(()=>{b=null})),L()),(!m||1&i&&c!==(c=`--REF-SIZE: ${15*t[0]/16}px;--S: ${t[0]/16}px;`))&&y(e,"style",c)},i(t){m||(F(i.$$.fragment,t),F(b),m=!0)},o(t){j(i.$$.fragment,t),j(b),m=!1},d(n){n&&d(e),U(i),p(v,n),p(x,n),t[12](null),b&&b.d(),t[13](null),t[14](null)}}}const Tl=t=>t.board&&t.free,Cl=t=>t.board&&!t.free,Al=t=>!t.board;function kl(t,e,n){let s;l(t,Z,(t=>n(6,s=t)));let i,r,o,{width:a}=e;var c;c=()=>{s&&s.image_preview_needed&&(Z.setNeedForNewImagePreview(!1),console.time("dom-to-image"),Qt.toPng(r,{filter:t=>!0}).then((t=>{console.log(t),console.timeEnd("dom-to-image"),Yt(s.id,t),console.log("done")})))},C().$$.after_update.push(c);let u=Array(225).fill(0),h=Array(7).fill(0);const d=t=>{const e=Math.floor(t/15);return{x:e,y:t-15*e}},p=t=>t,f=t=>{const e=t.clientX,n=t.clientY,s=i.getBoundingClientRect();return{x:e-s.x,y:n-s.y}},m=(t,e)=>!(e.x<t.x||e.x>t.x+t.width||e.y<t.y||e.y>t.y+t.height),g={getLocation:t=>{const e=i.getBoundingClientRect(),n=f(t),s=t=>{const s=t.filter((t=>{const s=(i=t.getBoundingClientRect(),r=e,i.x=i.x-r.x,i.y=i.y-r.y,i);var i,r;return m(s,n)}))[0];if(s)return parseInt(s.getAttribute("cid"))},r=s(u),o=s(h);return{board:void 0!==r,index:void 0!==r?r:o}},getBoardXY:d,getRackPos:p,getXY:f,isWithinRect:m,isWithinGame:t=>m(i.getBoundingClientRect(),t)};return t.$$set=t=>{"width"in t&&n(0,a=t.width)},[a,i,r,o,u,h,s,d,p,g,function(t,e,s){k[t?"unshift":"push"]((()=>{e[s]=t,n(4,u)}))},function(t,e,s){k[t?"unshift":"push"]((()=>{e[s]=t,n(5,h)}))},function(t){k[t?"unshift":"push"]((()=>{o=t,n(3,o)}))},function(t){k[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},function(t){k[t?"unshift":"push"]((()=>{r=t,n(2,r)}))}]}class Sl extends G{constructor(t){super(),z(this,t,kl,bl,r,{width:0})}}function Ol(t,e,n){const s=t.slice();return s[10]=e[n],s[12]=n,s}function Ml(t){let e,n,s,i,r=`Maître MoLangeur avait trouvé ${t[0].length} mots et positions valides: `,o=t[0],a=[];for(let e=0;e<o.length;e+=1)a[e]=Il(Ol(t,o,e));return{c(){e=f("div"),n=m(r),s=g(),i=f("div");for(let t=0;t<a.length;t+=1)a[t].c();y(e,"class","title"),y(i,"class","best-words-list svelte-vhdfrg")},m(t,r){h(t,e,r),u(e,n),h(t,s,r),h(t,i,r);for(let t=0;t<a.length;t+=1)a[t].m(i,null)},p(t,e){if(1&e&&r!==(r=`Maître MoLangeur avait trouvé ${t[0].length} mots et positions valides: `)&&w(n,r),59&e){let n;for(o=t[0],n=0;n<o.length;n+=1){const s=Ol(t,o,n);a[n]?a[n].p(s,e):(a[n]=Il(s),a[n].c(),a[n].m(i,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}},d(t){t&&d(e),t&&d(s),t&&d(i),p(a,t)}}}function El(t){let e;return{c(){e=f("div"),y(e,"class","pos-h svelte-vhdfrg")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function Dl(t){let e;return{c(){e=f("div"),y(e,"class","pos-v svelte-vhdfrg")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function Il(t){let e,n,i,r,o,a,l,c,p,_,x,b,T,C,A=t[3](t[10].index)+"",k=t[10].word+"",S=t[10].pts+" points";function O(t,e){return"V"===t[10].dir?Dl:El}let M=O(t),E=M(t);function D(){return t[7](t[12])}function I(){return t[8](t[12])}return{c(){e=f("div"),E.c(),n=g(),i=f("span"),r=m(A),o=g(),a=f("span"),l=m(k),c=g(),p=f("span"),_=m(S),x=g(),y(i,"class","crd"),y(a,"class","wrd svelte-vhdfrg"),y(p,"class","pts svelte-vhdfrg"),y(e,"class","word svelte-vhdfrg"),y(e,"tabindex","0"),y(e,"selected",b=t[12]===t[1]?"true":"false")},m(s,d){h(s,e,d),E.m(e,null),u(e,n),u(e,i),u(i,r),u(e,o),u(e,a),u(a,l),u(e,c),u(e,p),u(p,_),u(e,x),T||(C=[v(e,"mouseover",D),v(e,"mouseout",t[5]),v(e,"focus",I),v(e,"blur",t[5])],T=!0)},p(s,i){M!==(M=O(t=s))&&(E.d(1),E=M(t),E&&(E.c(),E.m(e,n))),1&i&&A!==(A=t[3](t[10].index)+"")&&w(r,A),1&i&&k!==(k=t[10].word+"")&&w(l,k),1&i&&S!==(S=t[10].pts+" points")&&w(_,S),2&i&&b!==(b=t[12]===t[1]?"true":"false")&&y(e,"selected",b)},d(t){t&&d(e),E.d(),T=!1,s(C)}}}function Rl(e){let n,s=e[2]&&Ml(e);return{c(){n=f("div"),s&&s.c(),y(n,"class","container svelte-vhdfrg")},m(t,e){h(t,n,e),s&&s.m(n,null)},p(t,[e]){t[2]?s?s.p(t,e):(s=Ml(t),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:t,o:t,d(t){t&&d(n),s&&s.d()}}}function Nl(t,e,n){let s,i,r,o;l(t,Z,(t=>n(6,o=t)));const a=t=>{const e=s[t],r=e.word.split(""),o=((t,e,n=!0)=>{let s=K(t),i=n?1:0,r=n?0:1;return Array(e).fill(t).map(((t,e)=>nt(s.row+e*i,s.col+e*r)))})(e.index,r.length,"V"===e.dir);Q.setTempLetters(r.map(((t,e)=>({index:o[e],letter:t})))),n(1,i=t)};return t.$$.update=()=>{64&t.$$.dirty&&o&&(n(0,s=o.molangeur.current_words),console.log(o.molangeur.next_words),n(2,r=null!==o.molangeur.current_words))},n(0,s=[]),n(1,i=-1),n(2,r=!0),[s,i,r,t=>{const e=Array(15).fill(0).map(((t,e)=>e+1)),n=Object.keys(dt).filter((t=>"_"!==t)).filter(((t,e)=>e<15)),s=K(t);return e[s.row]+n[s.col]},a,()=>{Q.setTempLetters([]),n(1,i=-1)},o,t=>a(t),t=>a(t)]}class Pl extends G{constructor(t){super(),z(this,t,Nl,Rl,r,{})}}function Vl(t){let e;return{c(){e=f("div"),e.textContent="Mot non valide",y(e,"class","result invalid svelte-75wsvt")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function $l(t){let e;return{c(){e=f("div"),e.textContent="Mot valide",y(e,"class","result valid svelte-75wsvt")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function ql(t){let e;return{c(){e=m("")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function Ll(e){let n,i,r,o,a;function l(t,e){return null===t[0]?ql:t[0]?$l:Vl}let c=l(e),p=c(e);return{c(){n=f("div"),i=f("input"),r=g(),p.c(),y(i,"type","text"),y(i,"placeholder","Dictionnaire"),y(i,"onkeypress","return (event.key.length === 1 && /[A-Za-zéèëêîïûôâàç]/.test(event.key))"),y(i,"class","svelte-75wsvt"),y(n,"class","container")},m(t,s){h(t,n,s),u(n,i),x(i,e[1]),u(n,r),p.m(n,null),o||(a=[v(i,"input",e[3]),v(i,"keyup",e[2])],o=!0)},p(t,[e]){2&e&&i.value!==t[1]&&x(i,t[1]),c!==(c=l(t))&&(p.d(1),p=c(t),p&&(p.c(),p.m(n,null)))},i:t,o:t,d(t){t&&d(n),p.d(),o=!1,s(a)}}}function Fl(t,e,n){let s=null,i="";return[s,i,()=>{let t;i.length>1?(t=i.normalize("NFD").replace(/\p{Diacritic}/gu,"").toUpperCase(),n(0,s=Ct(t))):n(0,s=null)},function(){i=this.value,n(1,i)}]}class jl extends G{constructor(t){super(),z(this,t,Fl,Ll,r,{})}}function Bl(e){let n,s,i;return{c(){n=f("button"),n.textContent="Soumettre",n.disabled=!0,y(n,"class","svelte-3uomgo")},m(t,r){h(t,n,r),s||(i=v(n,"click",e[1]),s=!0)},p:t,d(t){t&&d(n),s=!1,i()}}}function Wl(e){let n,s,i;return{c(){n=f("button"),n.textContent="Soumettre",y(n,"class","svelte-3uomgo")},m(t,r){h(t,n,r),s||(i=v(n,"click",e[1]),s=!0)},p:t,d(t){t&&d(n),s=!1,i()}}}function Ul(t){let e,n,s,i,r,o,a,l;function c(t,e){return t[0]?Wl:Bl}n=new jl({});let p=c(t),m=p(t);return{c(){e=f("div"),B(n.$$.fragment),s=g(),i=f("button"),i.textContent="Ramener les lettres",r=g(),m.c(),y(i,"class","svelte-3uomgo"),y(e,"class","action svelte-3uomgo")},m(t,c){h(t,e,c),W(n,e,null),u(e,s),u(e,i),u(e,r),m.m(e,null),o=!0,a||(l=v(i,"click",jt),a=!0)},p(t,[n]){p===(p=c(t))&&m?m.p(t,n):(m.d(1),m=p(t),m&&(m.c(),m.m(e,null)))},i(t){o||(F(n.$$.fragment,t),o=!0)},o(t){j(n.$$.fragment,t),o=!1},d(t){t&&d(e),U(n),m.d(),a=!1,l()}}}function Xl(t,e,n){let s;l(t,Z,(t=>n(2,s=t)));let i=!1;return t.$$.update=()=>{4&t.$$.dirty&&s&&(s.evaluation&&s.evaluation.is_position_valid&&s.evaluation.is_word_valid?n(0,i=!0):n(0,i=!1))},[i,()=>{Gt(s.id,s.player_id)},s]}class zl extends G{constructor(t){super(),z(this,t,Xl,Ul,r,{})}}function Gl(e){let n,s,i,r,o,a,l,c,p,_,v,x,b,T,C,A,k,S,O,M,E,D,I,R,N;return{c(){n=f("div"),s=f("div"),i=m("Score: "),r=f("span"),o=m(e[0]),a=g(),l=f("div"),c=m("Score de maître MoLangeur: "),p=f("span"),_=m(e[1]),v=g(),x=f("div"),b=m("Différence avec maître MoLangeur: "),T=f("span"),C=m(e[2]),A=g(),k=f("div"),S=m("Meilleur score possible: "),O=f("span"),M=m(e[3]),E=g(),D=f("div"),I=m("Nombre de lettres restantes: "),R=f("span"),N=m(e[4]),y(r,"class","value svelte-3utdym"),y(p,"class","value svelte-3utdym"),y(T,"class","value svelte-3utdym"),y(O,"class","value svelte-3utdym"),y(R,"class","value svelte-3utdym"),y(n,"class","score svelte-3utdym")},m(t,e){h(t,n,e),u(n,s),u(s,i),u(s,r),u(r,o),u(n,a),u(n,l),u(l,c),u(l,p),u(p,_),u(n,v),u(n,x),u(x,b),u(x,T),u(T,C),u(n,A),u(n,k),u(k,S),u(k,O),u(O,M),u(n,E),u(n,D),u(D,I),u(D,R),u(R,N)},p(t,[e]){1&e&&w(o,t[0]),2&e&&w(_,t[1]),4&e&&w(C,t[2]),8&e&&w(M,t[3]),16&e&&w(N,t[4])},i:t,o:t,d(t){t&&d(n)}}}function Yl(t,e,n){let s,i,r,o,a,c,u;return l(t,Z,(t=>n(6,u=t))),t.$$.update=()=>{if(99&t.$$.dirty&&u){n(5,s=u.player_id);let t=u.players.filter((t=>t.id===s))[0],e=u.molangeur;n(0,i=t?t.score:0),n(1,r=t?t.molangeur:0),n(3,a=e&&e.next_score?e.next_score:"..."),n(2,o=r-i),n(4,c=u.letters_left)}},n(5,s=null),n(0,i=0),n(1,r=0),n(2,o=0),n(3,a=""),n(4,c=0),[i,r,o,a,c,s,u]}class Hl extends G{constructor(t){super(),z(this,t,Yl,Gl,r,{})}}function Zl(t){let e,n,s,i,r,o,a,l,c,p,m,_,v,w;return s=new Hl({}),o=new Sl({props:{width:t[0]}}),c=new zl({}),_=new Pl({}),{c(){e=f("div"),n=f("div"),B(s.$$.fragment),i=g(),r=f("div"),B(o.$$.fragment),a=g(),l=f("div"),B(c.$$.fragment),p=g(),m=f("div"),B(_.$$.fragment),y(n,"class","info extra svelte-wpuk4j"),y(r,"class","game svelte-wpuk4j"),y(l,"class","extra btns svelte-wpuk4j"),y(m,"class","mstm extra svelte-wpuk4j"),y(e,"class","container svelte-wpuk4j"),y(e,"style",v=`--padd: ${t[2]}px;`)},m(d,f){h(d,e,f),u(e,n),W(s,n,null),u(e,i),u(e,r),W(o,r,null),t[4](r),u(e,a),u(e,l),W(c,l,null),u(e,p),u(e,m),W(_,m,null),w=!0},p(t,[n]){const s={};1&n&&(s.width=t[0]),o.$set(s),(!w||4&n&&v!==(v=`--padd: ${t[2]}px;`))&&y(e,"style",v)},i(t){w||(F(s.$$.fragment,t),F(o.$$.fragment,t),F(c.$$.fragment,t),F(_.$$.fragment,t),w=!0)},o(t){j(s.$$.fragment,t),j(o.$$.fragment,t),j(c.$$.fragment,t),j(_.$$.fragment,t),w=!1},d(n){n&&d(e),U(s),U(o),t[4](null),U(c),U(_)}}}function Ql(t,e,n){let s,i,{id:r}=e,o=500;const a=()=>{let t=i.getBoundingClientRect();n(0,o=t.width)};var l;return l=()=>{window.addEventListener("resize",a),a()},C().$$.on_mount.push(l),function(t){C().$$.on_destroy.push(t)}((()=>{window.removeEventListener("resize",a)})),Xt(r),t.$$set=t=>{"id"in t&&n(3,r=t.id)},t.$$.update=()=>{1&t.$$.dirty&&n(2,s=o/15/2)},[o,i,s,r,function(t){k[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}class Jl extends G{constructor(t){super(),z(this,t,Ql,Zl,r,{id:3})}}function Kl(e){let n,i,r,o,a,l,c,p,_,x,b,T,C,A,k,S,O,M,E,D,I,R,N,P,V,$,q=e[3](e[0].create_date)+"",L=e[4](e[0].create_date)+"",F=e[3](e[0].update_date)+"",j=e[4](e[0].update_date)+"";return{c(){n=f("div"),i=f("div"),r=f("div"),o=m("Partie créée le "),a=f("span"),l=m(q),c=m("\r\n           à "),p=f("span"),_=m(L),x=g(),b=f("div"),T=f("button"),T.textContent="Supprimer",C=g(),A=f("div"),k=m("Dernière modification le "),S=f("span"),O=m(F),M=m("\r\n        à "),E=f("span"),D=m(j),I=g(),R=f("div"),N=f("img"),y(a,"class","date svelte-1wddf0c"),y(p,"class","date svelte-1wddf0c"),y(r,"class","main"),y(T,"class","simple"),y(b,"class","secondary"),y(i,"class","title svelte-1wddf0c"),y(S,"class","date svelte-1wddf0c"),y(E,"class","date svelte-1wddf0c"),N.src!==(P=e[0].img)&&y(N,"src",P),y(N,"alt",""),y(N,"class","svelte-1wddf0c"),y(R,"class","img svelte-1wddf0c"),y(n,"class","game svelte-1wddf0c")},m(t,s){h(t,n,s),u(n,i),u(i,r),u(r,o),u(r,a),u(a,l),u(r,c),u(r,p),u(p,_),u(i,x),u(i,b),u(b,T),u(n,C),u(n,A),u(A,k),u(A,S),u(S,O),u(A,M),u(A,E),u(E,D),u(n,I),u(n,R),u(R,N),V||($=[v(T,"click",e[2]),v(n,"click",e[6])],V=!0)},p(t,[e]){1&e&&q!==(q=t[3](t[0].create_date)+"")&&w(l,q),1&e&&L!==(L=t[4](t[0].create_date)+"")&&w(_,L),1&e&&F!==(F=t[3](t[0].update_date)+"")&&w(O,F),1&e&&j!==(j=t[4](t[0].update_date)+"")&&w(D,j),1&e&&N.src!==(P=t[0].img)&&y(N,"src",P)},i:t,o:t,d(t){t&&d(n),V=!1,s($)}}}function tc(t,e,n){let{game:s}=e,{onclick:i}=e,{ondelete:r}=e;return t.$$set=t=>{"game"in t&&n(0,s=t.game),"onclick"in t&&n(1,i=t.onclick),"ondelete"in t&&n(5,r=t.ondelete)},[s,i,t=>{t.preventDefault(),t.stopPropagation(),r(s.id)},t=>new Date(t).toLocaleDateString(),t=>new Date(t).toLocaleTimeString(),r,()=>i(s.id)]}class ec extends G{constructor(t){super(),z(this,t,tc,Kl,r,{game:0,onclick:1,ondelete:5})}}function nc(t,e,n){const s=t.slice();return s[4]=e[n],s}function sc(t){let e;return{c(){e=f("span"),e.textContent="Aucune partie... Crée une partie ci-dessus pour commencer à jouer.\r\n         ",y(e,"class","nogame svelte-1hos7t9")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function ic(t){let e,n;return e=new ec({props:{game:t[4],onclick:t[0],ondelete:t[2]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.game=t[4]),1&n&&(s.onclick=t[0]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function rc(t){let e,n,s,r,o,a,l,c,m,_,w,x,b,T,C=t[1],A=[];for(let e=0;e<C.length;e+=1)A[e]=ic(nc(t,C,e));const k=t=>j(A[t],1,1,(()=>{A[t]=null}));let S=null;return C.length||(S=sc()),{c(){e=f("div"),n=f("div"),n.innerHTML='<p class="bold svelte-1hos7t9">Bienvenue dans MoLangeur!</p> \n        <p>Commence une nouvelle partie ou continue une partie déjà commencée (s&#39;il y en a).\n            Tu peux à tout moment revenir à ce menu en cliquant sur le logo MoLangeur en haut à gauche de l&#39;écran.\n            Bon jeu!</p>',s=g(),r=f("div"),o=f("button"),o.textContent="Nouvelle Partie Solo (Duplicate)",a=g(),l=f("button"),l.textContent="Nouvelle Partie Solo (Classique)",c=g(),m=f("div"),m.textContent="Parties existantes (clique sur un partie pour continuer à jouer):",_=g(),w=f("div");for(let t=0;t<A.length;t+=1)A[t].c();S&&S.c(),y(n,"class","intro svelte-1hos7t9"),y(o,"class","svelte-1hos7t9"),l.disabled=!0,y(l,"class","svelte-1hos7t9"),y(r,"class","new-games svelte-1hos7t9"),y(m,"class","game-list-header svelte-1hos7t9"),y(w,"class","game-list svelte-1hos7t9"),y(e,"class","container svelte-1hos7t9")},m(d,p){h(d,e,p),u(e,n),u(e,s),u(e,r),u(r,o),u(r,a),u(r,l),u(e,c),u(e,m),u(e,_),u(e,w);for(let t=0;t<A.length;t+=1)A[t].m(w,null);S&&S.m(w,null),x=!0,b||(T=v(o,"click",(function(){i(t[0](null))&&t[0](null).apply(this,arguments)})),b=!0)},p(e,[n]){if(t=e,7&n){let e;for(C=t[1],e=0;e<C.length;e+=1){const s=nc(t,C,e);A[e]?(A[e].p(s,n),F(A[e],1)):(A[e]=ic(s),A[e].c(),F(A[e],1),A[e].m(w,null))}for(q(),e=C.length;e<A.length;e+=1)k(e);L(),C.length?S&&(S.d(1),S=null):S||(S=sc(),S.c(),S.m(w,null))}},i(t){if(!x){for(let t=0;t<C.length;t+=1)F(A[t]);x=!0}},o(t){A=A.filter(Boolean);for(let t=0;t<A.length;t+=1)j(A[t]);x=!1},d(t){t&&d(e),p(A,t),S&&S.d(),b=!1,T()}}}function oc(t,e,n){let s,{launchGame:i}=e;const r=()=>{(t=>{let e=Et.transaction("games","readonly").objectStore("games").getAll();e.addEventListener("success",(()=>{console.log("DB games retrieved"),t(e.result)}))})((t=>{n(1,s=[...t.sort(((t,e)=>e.update_date-t.update_date))])}))};return r(),t.$$set=t=>{"launchGame"in t&&n(0,i=t.launchGame)},n(1,s=[]),[i,s,t=>{((t,e)=>{let n=Et.transaction("games","readwrite").objectStore("games").delete(t);n.addEventListener("success",(()=>{console.log("DB game deleted"),e()})),n.addEventListener("error",(()=>{console.error("DB Error: ",n.error)}))})(t,(()=>{r()}))}]}class ac extends G{constructor(t){super(),z(this,t,oc,rc,r,{launchGame:0})}}function lc(t){let e,n,s,i,r,o,a,l,c,p,m,_,w;const x=[hc,uc],b=[];function T(t,e){return"welcom"===t[0]?0:"game"===t[0]?1:-1}return~(c=T(t))&&(p=b[c]=x[c](t)),{c(){e=f("div"),n=f("div"),s=f("div"),i=g(),r=f("img"),a=g(),l=f("div"),p&&p.c(),y(s,"class","navigation-toggle svelte-1pg155l"),r.src!==(o="../images/molangeur_logo.png")&&y(r,"src","../images/molangeur_logo.png"),y(r,"alt",""),y(r,"class","svelte-1pg155l"),y(n,"class","header-navigation svelte-1pg155l"),y(l,"class","content svelte-1pg155l"),y(e,"class","container svelte-1pg155l")},m(o,d){h(o,e,d),u(e,n),u(n,s),u(n,i),u(n,r),u(e,a),u(e,l),~c&&b[c].m(l,null),m=!0,_||(w=v(r,"click",t[4]),_=!0)},p(t,e){let n=c;c=T(t),c===n?~c&&b[c].p(t,e):(p&&(q(),j(b[n],1,1,(()=>{b[n]=null})),L()),~c?(p=b[c],p?p.p(t,e):(p=b[c]=x[c](t),p.c()),F(p,1),p.m(l,null)):p=null)},i(t){m||(F(p),m=!0)},o(t){j(p),m=!1},d(t){t&&d(e),~c&&b[c].d(),_=!1,w()}}}function cc(e){let n;return{c(){n=f("div"),n.innerHTML='<div class="svelte-1pg155l"><p>Molangeur se prépare.</p> \n            <p>Veuillez patienter quelques instants...</p></div>',y(n,"class","loading svelte-1pg155l")},m(t,e){h(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function uc(t){let e,n;return e=new Jl({props:{id:t[1]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.id=t[1]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function hc(t){let e,n;return e=new ac({props:{launchGame:t[5]}}),{c(){B(e.$$.fragment)},m(t,s){W(e,t,s),n=!0},p(t,n){const s={};3&n&&(s.launchGame=t[5]),e.$set(s)},i(t){n||(F(e.$$.fragment,t),n=!0)},o(t){j(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function dc(t){let e,n,s,i;const r=[cc,lc],o=[];function a(t,e){return t[2]?1:0}return e=a(t),n=o[e]=r[e](t),{c(){n.c(),s=_()},m(t,n){o[e].m(t,n),h(t,s,n),i=!0},p(t,[i]){let l=e;e=a(t),e===l?o[e].p(t,i):(q(),j(o[l],1,1,(()=>{o[l]=null})),L(),n=o[e],n?n.p(t,i):(n=o[e]=r[e](t),n.c()),F(n,1),n.m(s.parentNode,s))},i(t){i||(F(n),i=!0)},o(t){j(n),i=!1},d(t){o[e].d(t),t&&d(s)}}}function pc(t,e,n){let s,i="welcom",r=null,o={dico:!0,db:!1};(t=>{let e=indexedDB.open("db",1);e.addEventListener("upgradeneeded",(()=>{Et=e.result,Et.objectStoreNames.contains("games")||Et.createObjectStore("games",{keyPath:"id"})})),e.addEventListener("error",(()=>{console.error("DB Error: ",e.error)})),e.addEventListener("success",(()=>{console.log("DB opened"),Et=e.result,t()}))})((()=>{n(3,o.db=!0,o)}));return t.$$.update=()=>{8&t.$$.dirty&&n(2,s=Object.keys(o).map((t=>o[t])).reduce(((t,e)=>t&&e)))},[i,r,s,o,()=>{n(0,i="welcom")},t=>{n(0,i="game"),n(1,r=t)}]}(t=>{let e=xt();bt[e]=t,fetch("./ALL_WORDS.txt").then((t=>t.text())).then((t=>{let n=t.split("\r\n");Tt={};const s=(t,e,n=0)=>(t[n]?(void 0===e[t[n]]&&(e[t[n]]={}),e[t[n]]=s(t,e[t[n]],n+1)):e.$=t,e);n.map((t=>{Tt=s(t,Tt)})),wt.postMessage({code:"init",id:e,content:{LETTERS:dt,LTRS:pt,POINTS:mt,MAPPING:yt,WORD_POSITIONS:vt,DICO:Tt}})}))})((()=>console.log("molangeur was initialized")));const fc=new class extends G{constructor(t){super(),z(this,t,pc,dc,r,{})}}({target:document.body,props:{}});return window.console.log=()=>{},fc}();
//# sourceMappingURL=bundle.js.map
